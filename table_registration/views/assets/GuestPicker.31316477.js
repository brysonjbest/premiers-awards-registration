import{f as h}from"./settings.services.6c8adf5e.js";import{_ as N,r as n,a as R,g as A,b as c,o as _,c as D,i as S,w as a,e as o,t as g,d as i,k as r,n as B,l as U,s as O,O as M,Q as E,y as Q}from"./index.f1d2400a.js";import{u as j,a as I}from"./guests.6f99e238.js";const q={props:{tableID:String},setup(m){const u=j(),v=n(),t=n(h.get("guestSelection")||[]),G=n(h.get("organizations")||[]),L=n(),l=n(!1);let p=n(!1);const f=n({severity:null,text:""});R();const d=I(),y=async function(){l.value=!0;try{v.value=await(await Q.getAllGuests()).data,v.value.map(s=>{s.assignedTable=!!s.table})}catch(s){l.value=!1,console.warn(s),p.value=!0,f.value={severity:"error",text:"Could not fetch guests."}}finally{l.value=!1,setTimeout(()=>p.value=!1,1500)}},k=()=>{y()};A(()=>{k()});const T=n(h.get("guestFilters")||{}),x=function(s,w){return h.lookup(s,w)},e=n({});return{columns:t,tableStore:d,dt:L,filters:T,loading:l,message:p,messageText:f,organizations:G,guests:v,guest:e,lookup:x,loadLazyData:k,onAdd:async function(s){await d.fillOnlyTable(m.tableID);const{table:w}=O(I()),C=w.value,V=C._id,z=s._id;try{l.value=!0,s.table!=null&&await u.removeGuestFromTable(z,{table:null},{_id:s.table}),await u.addGuestToTable(z,{table:V,organization:s.organization},C)}catch(F){l.value=!1,console.warn(F),p.value=!0,f.value={severity:"error",text:"Guest and table could not be updated."}}finally{l.value=!1,setTimeout(()=>p.value=!1,1500),y()}}}}},b=m=>(M("data-v-1e9f42ea"),m=m(),E(),m),H={key:2},J={style:{"text-align":"left"}},K={class:"p-input-icon-left"},W=b(()=>r("i",{class:"pi pi-search"},null,-1)),X=o(" No guests found. "),Y=o(" Loading guest data. Please wait. "),Z=b(()=>r("br",null,null,-1)),$=b(()=>r("br",null,null,-1)),ee=b(()=>r("br",null,null,-1)),te=o(" Registration: "),ae=b(()=>r("div",null,null,-1));function se(m,u,v,t,G,L){const l=c("ProgressSpinner"),p=c("PrimeMessage"),f=c("InputText"),d=c("PrimeColumn"),y=c("TriStateCheckbox"),k=c("router-link"),T=c("PrimeButton"),x=c("DataTable");return _(),D("div",null,[t.loading?(_(),S(l,{key:0})):t.message?(_(),S(p,{key:1,severity:t.messageText.severity,closable:!1},{default:a(()=>[o(g(t.messageText.text),1)]),_:1},8,["severity"])):(_(),D("div",H,[i(x,{class:"p-datatable-sm",value:t.guests,paginator:!0,responsiveLayout:"stack",breakpoint:"450px",rows:10,ref:"dt",stripedRows:"",filters:t.filters,"onUpdate:filters":u[1]||(u[1]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["firstname","lastname"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},{header:a(()=>[r("div",J,[r("span",K,[W,i(f,{title:"Search Guest List.",modelValue:t.filters.global.value,"onUpdate:modelValue":u[0]||(u[0]=e=>t.filters.global.value=e),placeholder:"Search Guest List"},null,8,["modelValue"])])])]),empty:a(()=>[X]),loading:a(()=>[Y]),default:a(()=>[i(d,{field:"firstname",header:"First Name",key:"firstname"},{body:a(({data:e})=>[o(g(e.firstname),1)]),_:1}),i(d,{field:"lastname",header:"Last Name",key:"lastname"},{body:a(({data:e})=>[o(g(e.lastname),1)]),_:1}),i(d,{field:"assignedTable",header:"Table",key:"assignedTable",dataType:"boolean"},{body:a(({data:e})=>[r("span",null,[r("i",{class:B(["pi pi-check-circle",{"true-icon pi-check-circle":e.assignedTable,"false-icon pi-times-circle":!e.assignedTable}]),style:{"font-size":"2rem"}},null,2),Z,o(g(e.assignedTable?" Assigned":" Pending"),1)])]),filter:a(({filterModel:e})=>[i(y,{modelValue:e.value,"onUpdate:modelValue":P=>e.value=P},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(d,{field:"details",header:"Guest Details",key:"registration"},{body:a(({data:e})=>[o(g(t.lookup("attendancetypes",e.attendancetype))+" ",1),$,o(" Organization: "+g(t.lookup("organizations",e.organization))+" ",1),ee,te,i(k,{to:`/admin/edit/${e.registration}`,class:"registration-link"},{default:a(()=>[o(g(e.registration),1)]),_:2},1032,["to"])]),_:1}),i(d,{exportable:!1,style:{"min-width":"8rem"},header:"Add:"},{body:a(e=>[t.tableStore.getIsFull?U("",!0):(_(),S(T,{key:0,icon:"pi pi-pencil",label:"Add Guest to Table",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:P=>t.onAdd(e.data)},null,8,["onClick"]))]),_:1})]),_:1},8,["value","filters","loading"])])),ae])}var ie=N(q,[["render",se],["__scopeId","data-v-1e9f42ea"]]);export{ie as G};
