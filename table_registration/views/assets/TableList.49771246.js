import{f as C}from"./settings.services.6c8adf5e.js";import{u as K,r as q}from"./index.esm.afb5d8fb.js";import{_ as G,u as j,r as f,s as H,b as u,o as p,c as T,i as S,w as a,e as c,t as m,k as s,d as l,n as O,l as z,a as Q,g as Y,j as J,h as W,O as X,Q as Z}from"./index.f1d2400a.js";import{a as A}from"./guests.6f99e238.js";const M={props:{tableID:String,adminView:Boolean,detailsView:Boolean},setup(v){const o=j(),d=A(),t=f(C.get("tabletypes")||[]),{table:x}=H(A()),k=K({tabletype:{required:q},tablecapacity:{required:q}},x);let g=f(!1),b=f(!1);const y=f({severity:null,text:""}),h=async function(V){if(V.preventDefault(),!!await this.v$.$validate())try{g.value=!0,d.registerTableHandler(this.table).then(_=>{this.$forceUpdate,g.value=!1,b.value=!0,y.value={severity:"success",text:"Table Updated!"}}).then(()=>{d.addTable})}catch(_){g.value=!1,console.warn(_),b.value=!0,y.value={severity:"error",text:"Table could not be updated."}}finally{setTimeout(()=>b.value=!1,1500)}};return async function(){const V=o.getUser;return d.$reset,v.tableID?await d.fillOnlyTable(v.tableID):v.adminView?await d.fillTables():await d.fillTable(V.guid)?d.fillTable(V.guid):[]}(),{loading:g,message:b,messageText:y,table:x,v$:k,tabletypes:t,onSubmit:h}}},$={class:"text-field"},ee=s("label",{for:"tablename"},"Name of Table:",-1),te={class:"dropdown"},ae=s("label",{for:"tabletype"},"Type of Table:",-1),le={key:0,class:"p-error",id:"tabletype-help"},oe={class:"number-field"},ne=s("label",{for:"tablecapacity"},"Table Capacity:",-1),ie={key:0,class:"p-error",id:"tablecapacity-help"},se=c("Submit");function re(v,o,d,t,x,U){const k=u("ProgressSpinner"),g=u("PrimeMessage"),b=u("InputText"),y=u("DropDown"),h=u("PrimeButton");return p(),T("div",null,[t.loading?(p(),S(k,{key:0})):t.message?(p(),S(g,{key:1,severity:t.messageText.severity,closable:!1},{default:a(()=>[c(m(t.messageText.text),1)]),_:1},8,["severity"])):(p(),T("form",{key:2,onSubmit:o[3]||(o[3]=(...r)=>t.onSubmit&&t.onSubmit(...r))},[s("div",$,[ee,l(b,{id:"tablename",type:"tablename","aria-describedby":"tablename-help",modelValue:t.table.tablename,"onUpdate:modelValue":o[0]||(o[0]=r=>t.table.tablename=r),placeholder:"Enter Table Name (Leave Blank for Default Next Available Table)"},null,8,["modelValue"])]),s("div",te,[ae,l(y,{class:O({"p-invalid":t.v$.tabletype.$error}),id:"tabletype",modelValue:t.table.tabletype,"onUpdate:modelValue":o[1]||(o[1]=r=>t.table.tabletype=r),options:t.tabletypes,optionLabel:"text",optionValue:"value",placeholder:"Select the type of table."},null,8,["class","modelValue","options"]),t.v$.tabletype.$error?(p(),T("small",le,"Please select the type of table.")):z("",!0)]),s("div",oe,[ne,l(b,{class:O({"p-invalid":t.v$.tablecapacity.$error}),id:"tablecapacity",type:"tablecapacity","aria-describedby":"tablecapacity-help",modelValue:t.table.tablecapacity,"onUpdate:modelValue":o[2]||(o[2]=r=>t.table.tablecapacity=r),min:1,max:99,"aria-placeholder":"1-2 digit number",placeholder:"Required Table Capacity",useGrouping:!1},null,8,["class","modelValue"]),t.v$.tablecapacity.$error?(p(),T("small",ie,"Please enter the required table capacity.")):z("",!0)]),l(h,{type:"submit",label:"primary",class:"p-button-raised"},{default:a(()=>[se]),_:1})],32))])}var de=G(M,[["render",re]]);const ue={props:{data:Array,detailsView:Boolean,tableID:String},setup(v){const o=Q(),d=A(),{tables:t}=H(A()),x=f(C.get("tableSelection")||[]),U=f((C.get("organizations")||[]).map(i=>i.value)),k=f(0),g=j(),b=f();let y=f(!1);const h=f({severity:null,text:""}),r=f(C.get("tableFilters")||{}),V=()=>{P()},P=()=>{r.value=C.get("tableFilters")||{}},_=f(!1),D=async function(){g.getUser,o.$reset,_.value=!0;try{return v.tableID?await d.fillTable(v.tableID):await d.fillTables()}catch(i){_.value=!1,console.warn(i),y.value=!0,h.value={severity:"error",text:"Could not fetch tables."}}finally{_.value=!1,setTimeout(()=>y.value=!1,1500)}},I=()=>{D().then(()=>{t.value.forEach(i=>{i.createdAt=new Date(i.createdAt),i.updatedAt=new Date(i.updatedAt),i.guestCount=Number(i.guests.length),i.tableStatus=i.guests.length<i.tablecapacity})})};Y(()=>{I()});const N=function(i,E){return C.lookup(i,E)},B=()=>{b.value.exportCSV()},e=i=>new Date(i).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),n=i=>new Date(i).toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),L=f({}),F=f(!1),R=f(!1);return{columns:x,organizations:U,table:L,tableDialog:F,deleteTableDialog:R,dataTableRender:k,filters:r,loading:_,message:y,messageText:h,dt:b,clearFilters:V,exportCSV:B,formatDate:e,formatTime:n,lookup:N,editTable:i=>{L.value={...i},F.value=!0},confirmDeleteTable:i=>{L.value=i,R.value=!0},deleteTable:async function(){_.value=!0;try{d.deleteTable(L.value._id).then(D()).then(()=>{_.value=!1,y.value=!0,h.value={severity:"success",text:"Successfully deleted table and reset all connected guests."}})}catch(i){_.value=!1,console.warn(i),y.value=!0,h.value={severity:"error",text:"Could not delete table."}}finally{R.value=!1,await new Promise(i=>setTimeout(i,1500)).then(()=>{y.value=!1,v.detailsView?W.push("/admin/tables"):D()})}},hideDialog:()=>{F.value=!1},loadLazyData:I,tables:t}},components:{InputTable:de}},w=v=>(X("data-v-2636551e"),v=v(),Z(),v),ce={key:2},be={style:{"text-align":"left"}},me={class:"p-input-icon-left"},pe=w(()=>s("i",{class:"pi pi-search"},null,-1)),ye=c(" No tables found. "),fe=c(" Loading table data. Please wait. "),ve={key:1},_e={key:0},ge={key:1},he={class:"item"},Te=w(()=>s("br",null,null,-1)),Ve=w(()=>s("br",null,null,-1)),we=w(()=>s("br",null,null,-1)),ke={class:"confirmation-content"},Se=w(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),xe={key:0},De=c("Are you sure you want to delete table # "),Ce=c("?"),Pe=w(()=>s("br",null,null,-1)),Ue=c(" This will reset all associated guests."),Ie=w(()=>s("br",null,null,-1)),Be=w(()=>s("b",null,"This action cannot be undone.",-1));function Le(v,o,d,t,x,U){const k=u("ProgressSpinner"),g=u("PrimeMessage"),b=u("PrimeButton"),y=u("InputText"),h=u("router-link"),r=u("PrimeColumn"),V=u("DropDown"),P=u("InputNumber"),_=u("TriStateCheckbox"),D=u("PrimeCalendar"),I=u("DataTable"),N=u("InputTable"),B=u("PrimeDialog");return p(),T("div",null,[t.loading?(p(),S(k,{key:0})):t.message?(p(),S(g,{key:1,severity:t.messageText.severity,closable:!1},{default:a(()=>[c(m(t.messageText.text),1)]),_:1},8,["severity"])):(p(),T("div",ce,[(p(),S(I,{class:"p-datatable-sm table-data-view",value:t.tables,responsiveLayout:"stack",key:t.dataTableRender,paginator:!d.detailsView,rows:10,ref:"dt",stripedRows:"",filters:t.filters,"onUpdate:filters":o[3]||(o[3]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["tablename","tabletype","tablecapacity","tableguestcount","tablefull","organizations"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},J({empty:a(()=>[ye]),loading:a(()=>[fe]),default:a(()=>[l(r,{field:"tablename",header:"Table Name",key:"tablename",class:"tablename"},{body:a(({data:e})=>[d.detailsView?(p(),T("span",ve,m(e.tablename),1)):(p(),S(h,{key:0,to:`/admin/table/${e.guid}`},{default:a(()=>[c(m(e.tablename),1)]),_:2},1032,["to"]))]),filter:a(({filterModel:e})=>[l(y,{type:"text",modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,class:"p-column-filter",placeholder:"Search by Table Name"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{field:"tabletype",header:"Type of Table",key:"tabletype",class:"tabletype"},{body:a(({data:e})=>[c(m(e.tabletype),1)]),filter:a(({filterModel:e})=>[l(V,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,options:["Standard","Reserved"],optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:a(n=>[n.value?(p(),T("div",_e,[s("div",null,m(n.value),1)])):(p(),T("span",ge,m(n.placeholder),1))]),option:a(n=>[s("div",he,[s("div",null,m(n.option),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{field:"tablecapacity",header:"Table Capacity",key:"tablecapacity",class:"tablecapacity"},{body:a(({data:e})=>[c(m(e.tablecapacity),1)]),filter:a(({filterModel:e})=>[l(P,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,showButtons:"",buttonLayout:"horizontal",step:1,decrementButtonClass:"p-button-danger",incrementButtonClass:"p-button-success",incrementButtonIcon:"pi pi-plus",decrementButtonIcon:"pi pi-minus"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),d.detailsView?z("",!0):(p(),S(r,{field:"guestCount",header:"Number of Guests",key:"guestCount",class:"guestCount"},{body:a(({data:e})=>[c(m(e.guestCount||0),1)]),filter:a(({filterModel:e})=>[l(P,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,showButtons:"",buttonLayout:"horizontal",step:1,decrementButtonClass:"p-button-danger",incrementButtonClass:"p-button-success",incrementButtonIcon:"pi pi-plus",decrementButtonIcon:"pi pi-minus"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})),l(r,{field:"tableStatus",header:"Table Status",key:"guests",class:"tableStatus",datatype:"boolean"},{body:a(({data:e})=>[s("span",null,[s("i",{class:O(["pi",{"true-icon pi-plus-circle":e.tableStatus,"false-icon pi-ban":!e.tableStatus}]),style:{"font-size":"2rem"}},null,2),Te,c(m(e.tableStatus?" Space Available":" Full"),1)])]),filter:a(({filterModel:e})=>[l(_,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{field:"organizations",header:"Organizations",key:"organizations",class:"organizations"},{body:a(({data:e})=>[c(m([...new Set(e.organizations.map(n=>n=t.lookup("organizations",n.organization)))].join(`\r
`)),1)]),filter:a(({filterModel:e})=>[l(y,{type:"text",modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,class:"p-column-filter",placeholder:"Search by Organization"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{field:"createdAt",header:"Created:",key:"createdAt",sortable:!0,dataType:"date"},{body:a(({data:e})=>[c(m(t.formatDate(e.createdAt))+",",1),Ve,c(m(t.formatTime(e.createdAt)),1)]),filter:a(({filterModel:e})=>[l(D,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{field:"updatedAt",header:"Updated:",key:"updatedAt",sortable:!0,dataType:"date"},{body:a(({data:e})=>[c(m(t.formatDate(e.updatedAt))+",",1),we,c(" "+m(t.formatTime(e.updatedAt)),1)]),filter:a(({filterModel:e})=>[l(D,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{exportable:!1,style:{"min-width":"8rem"}},{body:a(e=>[l(b,{label:"Edit",icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:n=>t.editTable(e.data)},null,8,["onClick"]),l(b,{icon:"pi pi-trash",label:"Delete",class:"p-button-rounded p-button-warning delete-button",onClick:n=>t.confirmDeleteTable(e.data)},null,8,["onClick"])]),_:1})]),_:2},[d.detailsView?void 0:{name:"header",fn:a(()=>[s("div",be,[l(b,{icon:"pi pi-external-link",label:"Export",onClick:o[0]||(o[0]=e=>t.exportCSV(e))}),l(b,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:o[1]||(o[1]=e=>t.clearFilters())}),s("span",me,[pe,l(y,{modelValue:t.filters.global.value,"onUpdate:modelValue":o[2]||(o[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])])])}]),1032,["value","paginator","filters","loading"]))])),s("div",null,[l(B,{visible:t.tableDialog,"onUpdate:visible":o[4]||(o[4]=e=>t.tableDialog=e),style:{width:"450px"},header:"Table Details",modal:!0,class:"p-fluid",onHide:o[5]||(o[5]=()=>t.loadLazyData())},{default:a(()=>[l(N,{tableID:t.table.guid,detailsView:d.detailsView},null,8,["tableID","detailsView"])]),_:1},8,["visible"]),l(B,{visible:t.deleteTableDialog,"onUpdate:visible":o[7]||(o[7]=e=>t.deleteTableDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:a(()=>[l(b,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o[6]||(o[6]=e=>t.deleteTableDialog=!1)}),l(b,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t.deleteTable},null,8,["onClick"])]),default:a(()=>[s("div",ke,[Se,t.table?(p(),T("span",xe,[De,s("b",null,m(t.table.tablename),1),Ce,Pe,Ue,Ie,Be])):z("",!0)])]),_:1},8,["visible"])])])}var Ge=G(ue,[["render",Le],["__scopeId","data-v-2636551e"]]);export{de as I,Ge as T};
