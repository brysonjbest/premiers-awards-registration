import{f as V}from"./settings.services.952672c3.js";import{_ as Y,u as I,s as j,r as k,P as q,b as f,o as s,c as _,d as l,i as b,w as o,l as p,k as d,e as c,t as g,n as J,O as W,Q as X}from"./index.2f0c1db2.js";const Z={setup(){const u=I(),{users:r}=j(I()),F=u.isAdmin,t=u.isSuperAdmin,D=k(),z=k(V.get("roles")||[]),R=(V.get("roles")||[]).filter(n=>n.value!=="nominator"),A=(V.get("roles")||[]).filter(n=>n.value!=="super-administrator").filter(n=>n.value!=="nominator"),m="https://premiersawards.gww.gov.bc.ca/nominations/admin/user/list",P=n=>{const h=u.getUser;return n===h.guid};let U=k(!1);const i=async function(){try{U.value=!0,u.$reset,await u.getUsers(),U.value=!1}catch(n){U.value=!1,console.warn(n)}},v=function(n,h){return V.lookup(n,h)},L=n=>new Date(n).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),T=n=>new Date(n).toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),w=k(V.get("userFilters")||{}),x=()=>{C()},C=()=>{w.value=V.get("userFilters")||{}},e=()=>{D.value.exportCSV()},a=k({}),N=k(!1),S=k(!1),B=k(!1),G=n=>{a.value={...n},S.value=!0},H=()=>{S.value=!1,N.value=!1},O=async function(n){a.value=n;let h=!n.eventregistrar;u.updateUser(a.value.guid,{eventregistrar:h}).then(()=>{a.value={}}).then(i()).catch(E=>{console.log(E)}).finally(()=>{i()})},K=async function(n){n.preventDefault(),N.value=!0;let h=!1;a.value.role!=="inactive"&&a.value.role!==void 0&&(h=!0),await u.updateUser(a.value.guid,a.value).then(async()=>{await u.updateUser(a.value.guid,{eventregistrar:h})}).then(()=>{S.value=!1,a.value={}}).then(i()).catch(E=>{console.log(E)}).finally(()=>{i()})},Q=async function(){u.removeUser(a.value.guid).then(()=>{S.value=!1,a.value={}}).then(i()).catch(n=>{console.log(n)}).finally(()=>{i()})};return i(),{users:r,dt:D,userStore:u,loading:U,isAdmin:F,isSuperAdmin:t,selfAssignment:P,lookup:v,formatDate:L,formatTime:T,filters:w,clearFilters:x,exportCSV:e,userDialog:S,editUser:G,saveUser:K,deleteUser:Q,user:a,roles:z,dropdownRoles:R,adminRoles:A,submitted:N,hideDialog:H,deleteUserDialog:B,adminURL:m,toggleRegistrar:O}},components:{PageHeader:q}},y=u=>(W("data-v-75562ada"),u=u(),X(),u),M={key:0},$=["href"],ee={style:{"text-align":"left"}},te={class:"p-input-icon-left"},ae=y(()=>d("i",{class:"pi pi-search"},null,-1)),le=c(" No users found. "),oe=c(" Loading guest data. Please wait. "),ne={key:0},re=y(()=>d("i",{class:"true-icon pi pi-check-circle",style:{"font-size":"2rem"}},null,-1)),ie=y(()=>d("br",null,null,-1)),se=y(()=>d("div",null,"Eligible as Admin",-1)),de=[re,ie,se],ue={key:1},ce=y(()=>d("br",null,null,-1)),me={key:0},pe={key:1},ge=y(()=>d("br",null,null,-1)),fe=y(()=>d("br",null,null,-1)),ve=c("Edit"),_e={key:1},he=["href"],ye={key:1,class:"dropdown"},be=y(()=>d("label",{for:"organization"},"Role:",-1)),ke={key:0},Ue=y(()=>d("p",{class:"p-error"}," Nominators cannot have their role changed here. Please navigate to Advanced User Management to modify nominator roles. ",-1)),Ve=[Ue],Se={class:"confirmation-content"},we=y(()=>d("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),xe={key:0},Ce=c("Are you sure you want to delete user ");function De(u,r,F,t,D,z){const R=f("PageHeader"),A=f("ProgressSpinner"),m=f("PrimeColumn"),P=f("PrimeRow"),U=f("PrimeCard"),i=f("PrimeButton"),v=f("InputText"),L=f("TriStateCheckbox"),T=f("router-link"),w=f("DataTable"),x=f("DropDown"),C=f("PrimeDialog");return s(),_("main",null,[t.isAdmin?(s(),_("div",M,[l(R,{title:"Manage Users",subtitle:"Manage user access and account types for the event registration application"}),t.loading?(s(),b(U,{key:0},{default:o(()=>[l(P,{class:"vh-50 text-center","align-v":"center"},{default:o(()=>[l(m,{id:"spinner"},{default:o(()=>[l(A,{label:"Loading..."})]),_:1})]),_:1})]),_:1})):p("",!0),d("a",{href:t.adminURL},[l(i,{class:"m2 p-button-success",type:"button",id:"user-management-button",icon:"pi pi-sign-in",label:"Go to Premier's Awards Advanced User Management",href:t.adminURL},null,8,["href"])],8,$),l(w,{class:"p-datatable-sm",value:t.users,responsiveLayout:"stack",rows:10,ref:"dt",stripedRows:"",filters:t.filters,"onUpdate:filters":r[3]||(r[3]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["guid","username","firstname","lastname","email","role"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},{header:o(()=>[d("div",ee,[l(i,{icon:"pi pi-external-link",label:"Export",onClick:r[0]||(r[0]=e=>t.exportCSV(e))}),l(i,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:r[1]||(r[1]=e=>t.clearFilters())}),d("span",te,[ae,l(v,{title:"Search all by keyword",modelValue:t.filters.global.value,"onUpdate:modelValue":r[2]||(r[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])])]),empty:o(()=>[le]),loading:o(()=>[oe]),default:o(()=>[t.userStore.getUser.role==="super-administrator"?(s(),b(m,{field:"guid",header:"guid",key:"guid",class:"guid"},{body:o(({data:e})=>[c(g(e.guid),1)]),filter:o(({filterModel:e})=>[l(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by ID#"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):p("",!0),l(m,{field:"username",header:"Username",key:"username"},{body:o(({data:e})=>[c(g(e.username),1)]),filter:o(({filterModel:e})=>[l(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by Username"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{field:"firstname",header:"First Name",key:"firstname"},{body:o(({data:e})=>[c(g(e.firstname),1)]),filter:o(({filterModel:e})=>[l(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by First Name"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{field:"lastname",header:"Last Name",key:"lastname"},{body:o(({data:e})=>[c(g(e.lastname),1)]),filter:o(({filterModel:e})=>[l(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by Last Name"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{field:"email",header:"Email",key:"email"},{body:o(({data:e})=>[c(g(e.email),1)]),filter:o(({filterModel:e})=>[l(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by Email"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{field:"role",header:"Role",key:"role"},{body:o(({data:e})=>[c(g(t.lookup("roles",e.role)),1)]),filter:o(({filterModel:e})=>[l(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by role"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{field:"eventregistrar",header:"Eligible to Register?",key:"eventregistrar",dataType:"boolean",filterField:"eventregistrar",sortable:""},{body:o(({data:e})=>[e.role==="administrator"||e.role==="super-administrator"?(s(),_("span",ne,de)):(s(),_("span",ue,[d("i",{class:J({"true-icon pi pi-check-circle":e.eventregistrar,"false-icon pi pi-times-circle":!e.eventregistrar}),style:{"font-size":"2rem"}},null,2),ce,e.eventregistrar?(s(),_("div",me,"Eligible Event Registrar")):(s(),_("div",pe,"Pending"))]))]),filter:o(({filterModel:e})=>[l(L,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{field:"createdAt",header:"Created:",key:"createdAt",sortable:!0},{body:o(({data:e})=>[c(g(t.formatDate(e.createdAt))+",",1),ge,c(g(t.formatTime(e.createdAt)),1)]),filter:o(({filterModel:e})=>[l(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by Date Created"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{field:"updatedAt",header:"Updated:",key:"updatedAt",sortable:!0},{body:o(({data:e})=>[c(g(t.formatDate(e.updatedAt))+",",1),fe,c(" "+g(t.formatTime(e.updatedAt)),1)]),filter:o(({filterModel:e})=>[l(v,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by Date Updated"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{exportable:!1,style:{"min-width":"8rem"},header:"Edit User:"},{body:o(e=>[e.data.role!=="super-administrator"&&e.data.role!==t.userStore.getUser.role?(s(),b(i,{key:0,icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:a=>t.editUser(e.data)},{default:o(()=>[ve]),_:2},1032,["onClick"])):p("",!0),e.data.role!=="super-administrator"&&e.data.role!=="administrator"&&e.data.role!=="inactive"&&e.data.role!==t.userStore.getUser.role?(s(),_("div",_e,[e.data.eventregistrar?e.data.eventregistrar?(s(),b(i,{key:1,label:"Deactivate",class:"p-button-danger",onClick:a=>t.toggleRegistrar(e.data)},null,8,["onClick"])):p("",!0):(s(),b(i,{key:0,label:"Activate",class:"p-button-primary",onClick:a=>t.toggleRegistrar(e.data)},null,8,["onClick"]))])):p("",!0),d("div",null,[l(T,{to:"/user/update"},{default:o(()=>[t.selfAssignment(e.data.guid)?(s(),b(i,{key:0,icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2"})):p("",!0)]),_:2},1024)])]),_:1})]),_:1},8,["value","filters","loading"]),l(C,{visible:t.userDialog,"onUpdate:visible":r[6]||(r[6]=e=>t.userDialog=e),style:{width:"450px"},header:"Edit User Role",modal:!0,class:"p-fluid"},{footer:o(()=>[t.user.role==="nominator"?(s(),_("small",ke,Ve)):p("",!0),l(i,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:t.hideDialog},null,8,["onClick"]),!t.selfAssignment(t.user.guid)&&t.user.role!=="nominator"?(s(),b(i,{key:1,label:"Save",icon:"pi pi-check",class:"p-button-text",onClick:t.saveUser},null,8,["onClick"])):p("",!0)]),default:o(()=>[t.user.role==="nominator"?(s(),_("a",{key:0,href:t.adminURL},[l(i,{class:"m2 p-button-success",type:"button",id:"user-management-button",icon:"pi pi-sign-in",label:"Go to Premier's Awards Advanced User Management",href:t.adminURL},null,8,["href"])],8,he)):p("",!0),t.user.role!=="nominator"?(s(),_("div",ye,[be,t.isSuperAdmin?(s(),b(x,{key:0,id:"organization",modelValue:t.user.role,"onUpdate:modelValue":r[4]||(r[4]=e=>t.user.role=e),options:t.dropdownRoles,optionLabel:"text",optionValue:"value",placeholder:"Select a Role"},null,8,["modelValue","options"])):t.isAdmin?(s(),b(x,{key:1,id:"organization",modelValue:t.user.role,"onUpdate:modelValue":r[5]||(r[5]=e=>t.user.role=e),options:t.adminRoles,optionLabel:"text",optionValue:"value",placeholder:"Select a Role"},null,8,["modelValue","options"])):p("",!0)])):p("",!0)]),_:1},8,["visible"]),l(C,{visible:t.deleteUserDialog,"onUpdate:visible":r[8]||(r[8]=e=>t.deleteUserDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:o(()=>[l(i,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:r[7]||(r[7]=e=>t.deleteUserDialog=!1)}),l(i,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t.deleteUser},null,8,["onClick"])]),default:o(()=>[d("div",Se,[we,u.registration?(s(),_("span",xe,[Ce,d("b",null,g(t.user.username),1),c(" for contact "+g(t.user.firstname)+" "+g(t.user.lastname)+"?",1)])):p("",!0)])]),_:1},8,["visible"])])):p("",!0)])}var Pe=Y(Z,[["render",De],["__scopeId","data-v-75562ada"]]);export{Pe as default};
