import{_ as q,z as Q,o as r,c as _,k as u,n as $,b as v,R as de,F as ce,m as be,S as pe,d as l,w as n,e as k,t as d,a as M,s as N,r as i,g as ae,i as P,l as J,O as me,Q as ge,u as fe,P as ve}from"./index.f1d2400a.js";import{a as O,u as te}from"./guests.6f99e238.js";import{f as A}from"./settings.services.6c8adf5e.js";/* empty css                                                       *//* empty css                                                         */import{N as _e}from"./NavMenu.00bae0f8.js";import{G as le}from"./GuestPicker.31316477.js";import{u as ye,r as he}from"./index.esm.afb5d8fb.js";const ke={props:{table:Object},setup(T){const s="pi pi-circle-fill full-table",g="pi pi-circle-fill half-table",t="pi pi-circle empty-table",V="pi pi-circle-fill default-table";return{tableClass:Q(()=>T.table.status==="full-table"?s:T.table.status==="half-table"?g:T.table.status==="empty-table"?t:V)}}},Te={class:"table-icon"};function xe(T,s,g,t,V,w){return r(),_("div",Te,[u("i",{class:$(t.tableClass)},null,2)])}var X=q(ke,[["render",xe]]);const we={props:{tables:Array},components:{TableIcon:X}},Se={class:"table-display"},Ve={class:"table-name"},ze={class:"table-seats-taken"},Ce={class:"table-free-seats"};function De(T,s,g,t,V,w){const f=v("TableIcon"),x=v("router-link"),c=de("tooltip");return r(),_("div",Se,[(r(!0),_(ce,null,be(g.tables,p=>(r(),_("div",{class:"table-details",key:p},[pe(l(f,{table:p},null,8,["table"]),[[c,`${p.registrationOrganizations?p.registrationOrganizations:"No Guests"}`,void 0,{top:!0,hover:!0}]]),u("div",Ve,[l(x,{to:`/admin/table/${p.guid}`},{default:n(()=>[k(d(p.tablename),1)]),_:2},1032,["to"])]),u("div",ze,d(p.guests.length)+" / "+d(p.tablecapacity)+" Seats Taken ",1),u("div",Ce,d(p.tablecapacity-p.guests.length)+" Seats Free ",1)]))),128))])}var se=q(we,[["render",De],["__scopeId","data-v-4fda7c33"]]);const Pe={props:{key:Number},emits:["loadedTables"],setup(T,{emit:s}){const g=M(),{registrations:t}=N(M());i({});const V=function(e,a){return A.lookup(e,a)},w=O(),{tables:f}=N(O()),x=i([]),c=i([]),p=Q(()=>f.value.sort((e,a)=>e.tablename-a.tablename)),m=i(A.get("tableSelection")||[]),L=i((A.get("organizations")||[]).map(e=>e.value));let b=i(!1);const z=i({severity:null,text:""}),y=i(!1),D=async function(){g.$reset,w.$reset,y.value=!0;try{return await w.fillTables().then(()=>{g.fillAllRegistrations()})}catch(e){y.value=!1,console.warn(e),b.value=!0,z.value={severity:"error",text:"Could not fetch tables and/or registrations."}}finally{await new Promise(e=>setTimeout(e,1)).then(()=>{y.value=!1,b.value=!1,s("loadedTables")})}},R=()=>{D().then(()=>{f.value.forEach(e=>{e.status=Q(()=>e.guests.length>=e.tablecapacity?"full-table":e.guests.length>0?"half-table":"empty-table"),e.registrationOrganizations=Q(()=>{const a=e.organizations.map(I=>I.organization),G=new Set(a);return Array.from(G).map(I=>I?V("organizations",I):"").join(`\r
`)})})}).then(()=>{f.value.sort((e,a)=>{const G=e.tablename[0],E=e.tablename[1],U=a.tablename[0],I=a.tablename[1];return E===I&&G>=U?1:G>U&&E<I?-1:0}),f.value.forEach((e,a,G)=>{e.tablename.length>2?x.value.push(e):c.value.push(e)})})};return ae(()=>{R()}),{fillList:D,loadLazyData:R,tables:f,specialTables:x,standardTables:c,registrations:t,organizations:L,message:b,loading:y,messageText:z,tableStore:w,columns:m,computedTables:p}},components:{TableIcon:X,TableDisplay:se,GuestPicker:le}},oe=T=>(me("data-v-61e21701"),T=T(),ge(),T),Le={key:2,id:"visual-table-list"},Ie={key:0,id:"special-tables-section"},Ae=oe(()=>u("h4",null,"Named/Specialty Tables",-1)),Re={id:"standard-tables-section"},Ge=oe(()=>u("h4",null,"Standard Table Layout",-1));function Fe(T,s,g,t,V,w){const f=v("ProgressSpinner"),x=v("PrimeMessage"),c=v("TableDisplay");return r(),_("div",null,[t.loading?(r(),P(f,{key:0})):t.message?(r(),P(x,{key:1,severity:t.messageText.severity,closable:!1},{default:n(()=>[k(d(t.messageText.text),1)]),_:1},8,["severity"])):(r(),_("div",Le,[t.specialTables.length>0?(r(),_("div",Ie,[Ae,(r(),P(c,{tables:t.specialTables,key:g.key},null,8,["tables"]))])):J("",!0),u("div",Re,[Ge,(r(),P(c,{tables:t.standardTables,key:g.key},null,8,["tables"]))])]))])}var Be=q(Pe,[["render",Fe],["__scopeId","data-v-61e21701"]]);const Ue={emits:["addGuest"],setup(T,{emit:s}){const g=M(),t=te();O();const{registrations:V}=N(M()),{guests:w}=N(te()),{tables:f}=N(O());i({});const x=i(),c=i(0),p=i([]),m=i(A.get("tableSelection")||[]),L=i((A.get("organizations")||[]).map(o=>o.value));let b=i(!1);const z=i({severity:null,text:""}),y=i(!1),D=i(!1),R=async function(){g.$reset,t.$reset,y.value=!0;try{await t.fillGuests().then(async()=>{await g.fillAllRegistrations().then(()=>{V.value.forEach(o=>{o.details={},o.status=0,o.guests.forEach(h=>{o.details[h]=w.value.filter(S=>S._id===h)[0],o.details[h].tabledetails=f.value.filter(S=>S._id===o.details[h].table)[0],o.details[h].table&&(o.status+=1)}),o.allAssigned=o.status>=o.guests.length,o.guestList=o.guests.length})})})}catch(o){y.value=!1,console.warn(o),b.value=!0,z.value={severity:"error",text:"Could not fetch registrations."}}finally{y.value=!1,setTimeout(()=>b.value=!1,1500)}},e=async function(){await R()};ae(()=>{e()});const a=function(o,h){return A.lookup(o,h)},G=function(o,h){let S="";for(let B of h)S.length>0?S+=`, ${a(o,B)}`:S=a(o,B);return S},E=()=>{x.value.value.map(o=>o.organization=a("organizations",o.organization)),x.value.exportCSV()},U=i(A.get("registrationFilters")||{}),I=()=>{Y()},Y=()=>{U.value=A.get("registrationFilters")||{}},K=i(!1),H=i(!1),C=i({}),W=i({}),ne=o=>{C.value={...o},K.value=!0},ie=o=>{W.value={...o},H.value=!0},re=()=>{K.value=!1,H.value=!1};N(O());const Z=ye({table:{required:he}},C),ee=async()=>{if(!await Z.value.$validate())return;const h=C.value.table,S=C.value._id,B={_id:h};try{y.value=!0,C.value.tabledetails!=null&&await t.removeGuestFromTable(S,{table:null,organization:C.value.organization},{_id:C.value.tabledetails._id}),await t.addGuestToTable(S,{table:h,organization:C.value.organization},B).then(()=>{y.value=!1,b.value=!0,z.value={severity:"success",text:"Successfully updated guest and table."}})}catch(j){y.value=!1,console.warn(j),b.value=!0,z.value={severity:"error",text:"Guest and table could not be updated."}}finally{await new Promise(j=>setTimeout(j,1500)).then(()=>{b.value=!1,K.value=!1,s("addGuest")}).then(()=>{e()})}};return{fillList:R,dt:x,dataTableRender:c,expandedRows:p,lookup:a,lookupLoop:G,exportCSV:E,filters:U,clearFilters:I,initFilters:Y,loadLazyData:e,registrations:V,guests:w,tables:f,organizations:L,message:b,loading:y,messageText:z,columns:m,tableDetailsDialog:K,guest:C,editGuestTable:ne,hideDialog:re,v$:Z,editTable:ee,multiTableDialog:H,editRegistrationTable:ie,registration:W,multiSeat:async o=>{const h=W.value.details,S=Object.keys(h),B=f.value.filter(F=>F._id===o)[0],j=B.tablecapacity-B.guests.length;try{D.value=!0;let F=0;for(let ue of S)F<j&&(C.value=h[ue],C.value.table=o,await ee(),F++);D.value=!1,b.value=!0,z.value={severity:"success",text:"Successfully updated guests and table."}}catch(F){D.value=!1,console.warn(F),b.value=!0,z.value={severity:"error",text:"Bulk guests and table could not be updated."}}finally{await new Promise(F=>setTimeout(F,1500)).then(()=>{b.value=!1,H.value=!1,s("addGuest")}).then(()=>{e()})}},multiloading:D}},components:{TableIcon:X,TableDisplay:se,GuestPicker:le}},Ne={key:2,class:"registrations-visual"},Oe={style:{"text-align":"left"}},Ee={class:"p-input-icon-left"},je=u("i",{class:"pi pi-search"},null,-1),$e=k(" No registrations found. "),Me=k(" Loading registration data. Please wait. "),qe={key:0},Ke={key:1},He={class:"item"},Qe=u("br",null,null,-1),Je=u("br",null,null,-1),We={class:"orders-subtable"},Xe={key:1},Ye={key:0},Ze={key:1},et={class:"dropdown"},tt=u("label",{for:"table"},"Table",-1),at={key:0,class:"p-error",id:"table-help"},lt={class:"dropdown"},st=u("label",{for:"table"},"Table",-1),ot={key:0,class:"p-error",id:"table-help"};function nt(T,s,g,t,V,w){const f=v("ProgressSpinner"),x=v("PrimeMessage"),c=v("PrimeButton"),p=v("InputText"),m=v("PrimeColumn"),L=v("router-link"),b=v("DropDown"),z=v("InputNumber"),y=v("TriStateCheckbox"),D=v("PrimeDialog"),R=v("DataTable");return r(),_("div",null,[t.loading||t.multiloading?(r(),P(f,{key:0})):t.message?(r(),P(x,{key:1,severity:t.messageText.severity,closable:!1},{default:n(()=>[k(d(t.messageText.text),1)]),_:1},8,["severity"])):(r(),_("div",Ne,[(r(),P(R,{class:"p-datatable-sm",exportFilename:"Event List",value:t.registrations,responsiveLayout:"stack",breakpoint:"780px",key:t.dataTableRender,expandedRows:t.expandedRows,"onUpdate:expandedRows":s[10]||(s[10]=e=>t.expandedRows=e),rows:10,paginator:!0,ref:"dt",stripedRows:"",sortField:"organization",sortOrder:1,filters:t.filters,"onUpdate:filters":s[11]||(s[11]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["organization","guid"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},{header:n(()=>[u("div",Oe,[l(c,{icon:"pi pi-external-link",label:"Export",onClick:s[0]||(s[0]=e=>t.exportCSV(e))}),l(c,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:s[1]||(s[1]=e=>t.clearFilters())}),u("span",Ee,[je,l(p,{title:"Search all by keyword",modelValue:t.filters.global.value,"onUpdate:modelValue":s[2]||(s[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])])]),empty:n(()=>[$e]),loading:n(()=>[Me]),expansion:n(e=>[u("div",We,[u("h5",null,"Guests for "+d(e.data.registrar),1),l(R,{value:Object.values(e.data.details),responsiveLayout:"scroll"},{default:n(()=>[l(m,{field:"organization",header:"Organization",sortable:""},{body:n(({data:a})=>[k(d(t.lookup("organizations",a.organization)),1)]),_:1}),l(m,{field:"name",header:"Name"},{body:n(({data:a})=>[k(d(a.firstname)+" "+d(a.lastname),1)]),_:1}),l(m,{field:"attendancetype",header:"Attendee Type",sortable:""},{body:n(({data:a})=>[k(d(t.lookup("attendancetypes",a.attendancetype)),1)]),_:1}),l(m,{field:"accessibility",header:"Accessibility Accomodations Required",sortable:""},{body:n(({data:a})=>[k(d(t.lookupLoop("accessibilityoptions",a.accessibility)),1)]),_:1}),l(m,{field:"tabledetails.tablename",header:"Seated?",sortable:""},{body:n(({data:a})=>[a.table?(r(),P(L,{key:0,to:`/admin/table/${a.table}`},{default:n(()=>[k(d(a.tabledetails.tablename),1)]),_:2},1032,["to"])):(r(),_("span",Xe,"Pending"))]),_:1}),l(m,{field:"table",header:"Edit Table"},{body:n(({data:a})=>[e.data.submitted===!1?(r(),_("span",Ye,"Must Submit Registration")):(r(),_("span",Ze,[l(c,{icon:"pi pi-pencil",label:a.tabledetails?"Edit Table":"Add Table",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:G=>t.editGuestTable(a)},null,8,["label","onClick"])]))]),_:2},1024),l(D,{visible:t.tableDetailsDialog,"onUpdate:visible":s[5]||(s[5]=a=>t.tableDetailsDialog=a),style:{width:"50rem",margin:"5rem"},header:"Table Details",modal:!0,class:"p-fluid registration-dialog"},{footer:n(()=>[l(c,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:s[4]||(s[4]=a=>t.tableDetailsDialog=!1)}),l(c,{label:"Confirm Table",icon:"pi pi-check",class:"p-button-text",onClick:t.editTable},null,8,["onClick"])]),default:n(()=>[u("div",et,[tt,l(b,{class:$({"p-invalid":t.v$.table.$error}),id:"table",modelValue:t.guest.table,"onUpdate:modelValue":s[3]||(s[3]=a=>t.guest.table=a),options:t.tables.filter(a=>a.tablecapacity>a.guests.length),name:"table",optionLabel:"tablename",optionValue:"_id",placeholder:"Select the table."},null,8,["class","modelValue","options"]),t.v$.table.$error?(r(),_("small",at,"Please select the table.")):J("",!0)])]),_:1},8,["visible"])]),_:2},1032,["value"])])]),default:n(()=>[l(m,{header:"Guests",expander:!0,headerStyle:"width: 3rem"}),l(m,{field:"guid",header:"ID#",key:"guid",class:"guid"},{body:n(({data:e})=>[l(L,{to:`/admin/edit/${e.guid}`},{default:n(()=>[k(d(e.registrar),1)]),_:2},1032,["to"])]),_:1}),l(m,{field:"organization",filterField:"organization",header:"Organization",key:"organization",sortable:!0},{body:n(({data:e})=>[k(d(t.lookup("organizations",e.organization)),1)]),filter:n(({filterModel:e})=>[l(b,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.organizations,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:n(a=>[a.value?(r(),_("div",qe,[u("div",null,d(t.lookup("organizations",a.value)),1)])):(r(),_("span",Ke,d(a.placeholder),1))]),option:n(a=>[u("div",He,[u("div",null,d(t.lookup("organizations",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),l(m,{field:"guestList",header:"Guest List",key:"guestList",filterField:"guestList",sortable:""},{body:n(({data:e})=>[k(d(e.guests.length),1)]),filter:n(({filterModel:e})=>[l(z,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,showButtons:"",buttonLayout:"horizontal",step:1,decrementButtonClass:"p-button-danger",incrementButtonClass:"p-button-success",incrementButtonIcon:"pi pi-plus",decrementButtonIcon:"pi pi-minus"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{field:"submitted",header:"Submitted?",key:"submitted",dataType:"boolean"},{body:n(({data:e})=>[u("span",null,[u("i",{class:$(["pi pi-check-circle",{"true-icon pi-check-circle":e.submitted,"false-icon pi-times-circle":!e.submitted}]),style:{"font-size":"2rem"}},null,2),Qe,k(d(e.submitted?" Submitted":" Pending"),1)])]),filter:n(({filterModel:e})=>[l(y,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{field:"seated",header:"All Guests Seated?",key:"seated",filterField:"allAssigned",dataType:"boolean"},{body:n(({data:e})=>[u("span",null,[u("i",{class:$(["pi pi-check-circle",{"true-icon pi-check-circle":e.status===e.guests.length,"false-icon pi-times-circle":e.status!==e.guests.length}]),style:{"font-size":"2rem"}},null,2),Je,k(" "+d(e.status)+" of "+d(e.guests.length)+" Guests Seated",1)])]),filter:n(({filterModel:e})=>[l(y,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{header:"Options"},{body:n(({data:e})=>[l(c,{icon:"pi pi-pencil",label:"Bulk Seat Registration",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:a=>t.editRegistrationTable(e)},null,8,["onClick"])]),_:1}),l(D,{visible:t.multiTableDialog,"onUpdate:visible":s[9]||(s[9]=e=>t.multiTableDialog=e),style:{width:"50rem",margin:"5rem"},header:"Table Details",modal:!0,class:"p-fluid registration-dialog"},{footer:n(()=>[l(c,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:s[7]||(s[7]=e=>t.multiTableDialog=!1)}),l(c,{label:"Confirm Table",icon:"pi pi-check",class:"p-button-text",onClick:s[8]||(s[8]=e=>t.multiSeat(t.registration.table))})]),default:n(()=>[u("div",lt,[st,l(b,{class:$({"p-invalid":t.v$.table.$error}),id:"table",modelValue:t.registration.table,"onUpdate:modelValue":s[6]||(s[6]=e=>t.registration.table=e),options:t.tables.filter(e=>e.tablecapacity>e.guests.length),name:"table",optionLabel:"tablename",optionValue:"_id",placeholder:"Select the table."},null,8,["class","modelValue","options"]),t.v$.table.$error?(r(),_("small",ot,"Please select the table.")):J("",!0)])]),_:1},8,["visible"])]),_:1},8,["value","expandedRows","filters","loading"]))]))])}var it=q(Ue,[["render",nt]]);const rt={__name:"AdminVisualTableView",setup(T){const s=fe();M();const g=i(!1),t=()=>g.value=!0,V=i(A.get("navItems")||[]),w=()=>String(O().getTablesCount),f=i(!1),x=()=>{f.value=!0},c=i(0),p=()=>c.value++;return s.login(),(m,L)=>{const b=v("PrimeButton");return r(),_("main",null,[l(ve,{title:"Event Planning",subtitle:"Visually Organize PA Event"}),l(b,{label:"Table Count: ",type:"button",icon:"pi pi-ticket",class:"p-button-warning",badge:w(),onClick:L[0]||(L[0]=z=>x()),badgeClass:"p-badge-danger"},null,8,["badge"]),l(_e,{title:"",menuitems:V.value},null,8,["menuitems"]),(r(),P(Be,{onLoadedTables:t,key:c.value})),g.value?(r(),P(it,{key:0,onAddGuest:p,class:"registrations-visual-box"})):J("",!0)])}}};var yt=q(rt,[["__scopeId","data-v-54bf7b12"]]);export{yt as default};
