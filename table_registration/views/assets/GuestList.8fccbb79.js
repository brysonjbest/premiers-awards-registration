import{L as le,M as A,a as B,_ as ie,s as se,r as m,f as v,u as ne,g as re,b as f,o as d,c,h as U,w as l,e as p,t as r,d as s,j as n,k as h,n as I,F as Q,l as W,I as de,J as ue}from"./index.c149f29a.js";import{u as ce,r as N}from"./index.esm.2a9f5eed.js";const X=le({id:"guestsStore",state:()=>({guest:{registration:"",firstname:"",lastname:"",attendancetype:"",organization:"",accessibility:[],dietary:[]},guests:[]}),getters:{getGuestsCount(){return this.guests.length}},actions:{async fillGuestsRegistration(u){const o=await(await A.getGuestsByRegistration(u)).data[0];this.guests=o.guests||[]},async fillGuests(){this.guests=await(await A.getAllGuests()).data},async addRegistrationData(){console.log("registrationdata add");const u=B();this.guest.registration=await u.getId},async addGuestList(){const{registration:u="",guid:o="",firstname:g="",lastname:t="",attendancetype:P="",organization:T="",accessibility:z=[],dietary:L=[]}=this.guest||{};await this.guests.push({registration:u,guid:o,firstname:g,lastname:t,attendancetype:P,organization:T,accessibility:z,dietary:L})},async updateGuest(u,o){await A.updateGuest(u,o)},async deleteGuest(u,o){const g=B();await A.deleteGuest(u).then(()=>{g.registerFinancialInformation({$pull:{guests:u}},o)})},async registerGuest(u){const o=B(),g=await A.createGuest(u),t=g.data._id;return await o.registerFinancialInformation({$push:{guests:t}}),this.guest.guid=g.data.guid,this.guest},async registerAllGuests(){for(let u of this.guests)this.registerGuest(u)}}});const me={props:{adminView:Boolean,registrationID:String},setup(u){const o=X(),{guests:g}=se(X()),t=m(v.get("guestSelection")||[]),P=m((v.get("organizations")||[]).map(i=>i.value)),T=m((v.get("attendancetypes")||[]).map(i=>i.value)),z=m((v.get("accessibilityoptions")||[]).map(i=>i.value)),L=m((v.get("dietaryoptions")||[]).map(i=>i.value)),_=m(v.get("organizations")||[]),x=m(v.get("attendancetypes")||[]),q=m(v.get("accessibilityoptions")||[]),y=m(v.get("dietaryoptions")||[]),D=ne(),F=m(),k=m(!1);let V=m(!1);const C=m({severity:null,text:""}),e=B(),a=async function(){const i=D.getUser;o.$reset,k.value=!0;try{return u.adminView?await o.fillGuests():u.registrationID?await o.fillGuestsRegistration(u.registrationID):await o.fillGuestsRegistration(i.guid)?o.fillGuestsRegistration(i.guid):[]}catch(G){k.value=!1,console.warn(G),V.value=!0,C.value={severity:"error",text:"Could not fetch registrations."}}finally{k.value=!1,setTimeout(()=>V.value=!1,1500)}},E=()=>{a().then(()=>{g.value.forEach(i=>{i.createdAt=new Date(i.createdAt),i.updatedAt=new Date(i.updatedAt)})})};re(()=>{E()});const Z=function(){return e.getRegistration.submitted},K=m(v.get("guestFilters")||{}),M=()=>{$()},$=()=>{K.value=v.get("guestFilters")||{}},ee=()=>{F.value.exportCSV()},O=function(i,G){return v.lookup(i,G)},te=i=>new Date(i).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),ae=i=>new Date(i).toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),oe=function(i,G){let S="";for(let H of G)S.length>0?S+=`, ${O(i,H)}`:S=O(i,H);return S},w=m({}),Y=ce({organization:{required:N},firstname:{required:N},lastname:{required:N},attendancetype:{required:N}},w),j=m(!1),R=m(!1),J=m(!1);return{columns:t,v$:Y,dt:F,filters:K,loading:k,message:V,messageText:C,isSubmitted:Z,exportCSV:ee,clearFilters:M,organizationsFilter:P,attendancetypesFilter:T,accessibilityFilter:z,dietaryFilter:L,organizations:_,attendancetypes:x,accessibility:q,dietary:y,guests:g,guest:w,submitted:j,guestDialog:R,deleteGuestDialog:J,formatDate:te,formatTime:ae,lookup:O,lookupLoop:oe,editGuest:i=>{w.value={...i},R.value=!0},confirmDeleteGuest:i=>{w.value=i,J.value=!0},deleteGuest:async function(){k.value=!0;try{o.deleteGuest(w.value._id,w.value.registration).then(a()).then(()=>{k.value=!1,V.value=!0,C.value={severity:"success",text:"Successfully deleted guest."}})}catch(i){console.log(i),k.value=!1,console.warn(i),V.value=!0,C.value={severity:"error",text:"Could not delete guest."}}finally{J.value=!1,await new Promise(i=>setTimeout(i,1500)).then(()=>{V.value=!1,a()})}},hideDialog:()=>{R.value=!1,j.value=!1},saveGuest:async function(i){i.preventDefault(),j.value=!0,await Y.value.$validate()&&o.updateGuest(w.value._id,w.value).then(()=>{R.value=!1,w.value={}}).then(a()).catch(S=>{console.log(S)}).finally(()=>{E()})},loadLazyData:E}}},b=u=>(de("data-v-6101a834"),u=u(),ue(),u),ge={key:2},pe={style:{"text-align":"left"}},ye={key:0,class:"p-input-icon-left"},ve=b(()=>n("i",{class:"pi pi-search"},null,-1)),fe=p(" No guests found. "),_e=p(" Loading guest data. Please wait. "),he={key:0},be={key:1},ke={class:"item"},Ve={key:0},we={key:1},xe={class:"item"},De={key:0},Ge={key:1},Ce={class:"item"},Se={key:0},Ue={key:1},ze={class:"item"},Le=b(()=>n("br",null,null,-1)),Fe=b(()=>n("br",null,null,-1)),Ae={class:"dropdown"},Pe=b(()=>n("label",{for:"organization"},"Organization:",-1)),Te={key:0,class:"p-error",id:"organization-help"},Re={class:"field-text"},Ie=b(()=>n("label",{for:"firstname"},"First Name",-1)),Ne={key:0,class:"p-error",id:"firstname-help"},Be={class:"field-text"},qe=b(()=>n("label",{for:"lastname"},"Last Name",-1)),Ee={key:0,class:"p-error",id:"lastname-help"},Oe={class:"dropdown"},je=b(()=>n("label",{for:"attendancetype"},"Attendance Type:",-1)),Je={key:0,class:"p-error",id:"attendancetype-help"},Ke={class:"checkbox-group"},Ye=b(()=>n("label",{for:"accessibility"},"Accessibility Requirements:",-1)),He=["for"],Qe={class:"checkbox-group"},We=b(()=>n("label",{for:"dietary"},"Dietary Requirements:",-1)),Xe=["for"],Ze={class:"confirmation-content"},Me=b(()=>n("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),$e={key:0},et=p("Are you sure you want to delete "),tt=p("?");function at(u,o,g,t,P,T){const z=f("ProgressSpinner"),L=f("PrimeMessage"),_=f("PrimeButton"),x=f("InputText"),q=f("router-link"),y=f("PrimeColumn"),D=f("DropDown"),F=f("PrimeCalendar"),k=f("DataTable"),V=f("CheckBox"),C=f("PrimeDialog");return d(),c("div",null,[t.loading?(d(),U(z,{key:0})):t.message?(d(),U(L,{key:1,severity:t.messageText.severity,closable:!1},{default:l(()=>[p(r(t.messageText.text),1)]),_:1},8,["severity"])):(d(),c("div",ge,[s(k,{class:"p-datatable-sm",value:t.guests,responsiveLayout:"stack",paginator:g.adminView,rows:10,ref:"dt",stripedRows:"",filters:t.filters,"onUpdate:filters":o[3]||(o[3]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["firstname","lastname","attendancetype","accessibility","dietary","registration"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},{header:l(()=>[n("div",pe,[s(_,{icon:"pi pi-external-link",label:"Export",onClick:o[0]||(o[0]=e=>t.exportCSV(e))}),s(_,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:o[1]||(o[1]=e=>t.clearFilters())}),g.adminView?(d(),c("span",ye,[ve,s(x,{modelValue:t.filters.global.value,"onUpdate:modelValue":o[2]||(o[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])):h("",!0)])]),empty:l(()=>[fe]),loading:l(()=>[_e]),default:l(()=>[g.adminView?(d(),U(y,{field:"registration",header:"Registration",key:"registration",class:"guid"},{body:l(({data:e})=>[s(q,{to:`/admin/edit/${e.registration}`,class:"registration-link"},{default:l(()=>[p(r(e.registration),1)]),_:2},1032,["to"])]),filter:l(({filterModel:e})=>[s(x,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by registration"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):h("",!0),s(y,{field:"organization",header:"Organization",key:"organization"},{body:l(({data:e})=>[p(r(t.lookup("organizations",e.organization)),1)]),filter:l(({filterModel:e})=>[s(D,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.organizationsFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(d(),c("div",he,[n("div",null,r(t.lookup("organizations",a.value)),1)])):(d(),c("span",be,r(a.placeholder),1))]),option:l(a=>[n("div",ke,[n("div",null,r(t.lookup("organizations",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),s(y,{field:"firstname",header:"First Name",key:"firstname"},{body:l(({data:e})=>[p(r(e.firstname),1)]),filter:l(({filterModel:e})=>[s(x,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by First Name"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(y,{field:"lastname",header:"Last Name",key:"lastname"},{body:l(({data:e})=>[p(r(e.lastname),1)]),filter:l(({filterModel:e})=>[s(x,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by Last Name"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(y,{field:"attendancetype",header:"Attendance Type",key:"attendancetype"},{body:l(({data:e})=>[p(r(t.lookup("attendancetypes",e.attendancetype)),1)]),filter:l(({filterModel:e})=>[s(D,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.attendancetypesFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(d(),c("div",Ve,[n("div",null,r(t.lookup("attendancetypes",a.value)),1)])):(d(),c("span",we,r(a.placeholder),1))]),option:l(a=>[n("div",xe,[n("div",null,r(t.lookup("attendancetypes",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),s(y,{field:"accessibility",header:"Accessibility Requirements",key:"accessibility"},{body:l(({data:e})=>[p(r(t.lookupLoop("accessibilityoptions",e.accessibility)),1)]),filter:l(({filterModel:e})=>[s(D,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.accessibilityFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(d(),c("div",De,[n("div",null,r(t.lookup("accessibilityoptions",a.value)),1)])):(d(),c("span",Ge,r(a.placeholder),1))]),option:l(a=>[n("div",Ce,[n("div",null,r(t.lookup("accessibilityoptions",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),s(y,{field:"dietary",header:"Dietary Requirements",key:"dietary"},{body:l(({data:e})=>[p(r(t.lookupLoop("dietaryoptions",e.dietary)),1)]),filter:l(({filterModel:e})=>[s(D,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.dietaryFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(d(),c("div",Se,[n("div",null,r(t.lookup("dietaryoptions",a.value)),1)])):(d(),c("span",Ue,r(a.placeholder),1))]),option:l(a=>[n("div",ze,[n("div",null,r(t.lookup("dietaryoptions",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),g.adminView?(d(),U(y,{field:"createdAt",header:"Created:",key:"createdAt",sortable:!0,dataType:"date"},{body:l(({data:e})=>[p(r(t.formatDate(e.createdAt))+",",1),Le,p(r(t.formatTime(e.createdAt)),1)]),filter:l(({filterModel:e})=>[s(F,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):h("",!0),g.adminView?(d(),U(y,{field:"updatedAt",header:"Updated:",key:"updatedAt",sortable:!0,dataType:"date"},{body:l(({data:e})=>[p(r(t.formatDate(e.updatedAt))+",",1),Fe,p(" "+r(t.formatTime(e.updatedAt)),1)]),filter:l(({filterModel:e})=>[s(F,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):h("",!0),!t.isSubmitted()||g.adminView?(d(),U(y,{key:3,exportable:!1,style:{"min-width":"8rem"}},{body:l(e=>[s(_,{icon:"pi pi-pencil",label:"Edit",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:a=>t.editGuest(e.data)},null,8,["onClick"]),s(_,{icon:"pi pi-trash",label:"Delete",class:"p-button-rounded p-button-warning delete-button",onClick:a=>t.confirmDeleteGuest(e.data)},null,8,["onClick"])]),_:1})):h("",!0)]),_:1},8,["value","paginator","filters","loading"])])),n("div",null,[s(C,{visible:t.guestDialog,"onUpdate:visible":o[10]||(o[10]=e=>t.guestDialog=e),style:{width:"450px"},header:"Guest Details",modal:!0,class:"p-fluid"},{footer:l(()=>[s(_,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:t.hideDialog},null,8,["onClick"]),s(_,{label:"Save",icon:"pi pi-check",class:"p-button-text",onClick:t.saveGuest},null,8,["onClick"])]),default:l(()=>[n("div",Ae,[Pe,s(D,{class:I({"p-invalid":t.v$.organization.$error}),id:"organization",modelValue:t.guest.organization,"onUpdate:modelValue":o[4]||(o[4]=e=>t.guest.organization=e),options:t.organizations,optionLabel:"text",optionValue:"value",placeholder:"Select a Organization"},null,8,["class","modelValue","options"]),t.v$.organization.$error?(d(),c("small",Te,"Please select your organization.")):h("",!0)]),n("div",Re,[Ie,s(x,{class:I({"p-invalid":t.v$.firstname.$error}),id:"firstname",modelValue:t.guest.firstname,"onUpdate:modelValue":o[5]||(o[5]=e=>t.guest.firstname=e),modelModifiers:{trim:!0},required:"true",autofocus:""},null,8,["class","modelValue"]),t.v$.firstname.$error?(d(),c("small",Ne,"Please enter guest's first name.")):h("",!0)]),n("div",Be,[qe,s(x,{class:I({"p-invalid":t.v$.lastname.$error}),id:"lastname",modelValue:t.guest.lastname,"onUpdate:modelValue":o[6]||(o[6]=e=>t.guest.lastname=e),modelModifiers:{trim:!0},required:"true",autofocus:""},null,8,["class","modelValue"]),t.v$.lastname.$error?(d(),c("small",Ee,"Please enter guest's last name.")):h("",!0)]),n("div",Oe,[je,s(D,{class:I({"p-invalid":t.v$.attendancetype.$error}),id:"attendancetype",modelValue:t.guest.attendancetype,"onUpdate:modelValue":o[7]||(o[7]=e=>t.guest.attendancetype=e),options:t.attendancetypes,optionLabel:"text",optionValue:"value",placeholder:"Select the type of attendance for this guest"},null,8,["class","modelValue","options"]),t.v$.attendancetype.$error?(d(),c("small",Je,"Please select the attendance type for this guest.")):h("",!0)]),n("div",Ke,[Ye,(d(!0),c(Q,null,W(t.accessibility,e=>(d(),c("div",{key:e.key,class:"field-checkbox"},[s(V,{id:e.key,name:"each",value:e.value,modelValue:t.guest.accessibility,"onUpdate:modelValue":o[8]||(o[8]=a=>t.guest.accessibility=a)},null,8,["id","value","modelValue"]),n("label",{for:e.key},r(e.text),9,He)]))),128))]),n("div",Qe,[We,(d(!0),c(Q,null,W(t.dietary,e=>(d(),c("div",{key:e.key,class:"field-checkbox"},[s(V,{id:e.key,name:"each",value:e.value,modelValue:t.guest.dietary,"onUpdate:modelValue":o[9]||(o[9]=a=>t.guest.dietary=a)},null,8,["id","value","modelValue"]),n("label",{for:e.key},r(e.text),9,Xe)]))),128))])]),_:1},8,["visible"]),s(C,{visible:t.deleteGuestDialog,"onUpdate:visible":o[12]||(o[12]=e=>t.deleteGuestDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:l(()=>[s(_,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o[11]||(o[11]=e=>t.deleteGuestDialog=!1)}),s(_,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t.deleteGuest},null,8,["onClick"])]),default:l(()=>[n("div",Ze,[Me,t.guest?(d(),c("span",$e,[et,n("b",null,r(t.guest.firstname)+" "+r(t.guest.lastname),1),tt])):h("",!0)])]),_:1},8,["visible"])])])}var ct=ie(me,[["render",at],["__scopeId","data-v-6101a834"]]);export{ct as G,X as u};
