import{f as S}from"./settings.services.195ac23d.js";import{I as te}from"./InputFinancial.fccbe10f.js";import{_ as ae,a as J,f as ie,s as O,r as p,u as ne,g as le,h as G,b as g,o,c as h,i as f,w as n,e as m,t as b,j as oe,k as s,d as u,l as y,F as se,m as re,n as de}from"./index.4885a692.js";import{u as Q,a as W}from"./guests.ff712789.js";const ue={props:{adminView:Boolean,detailsView:Boolean,registrationID:String},setup(k){const i=J(),r=ie(),{registrations:t}=O(J()),{guests:R}=O(Q()),{tables:H}=O(W()),L=p(S.get("registrationSelection")||[]),F=p((S.get("organizations")||[]).map(a=>a.value)),_=p(0),T=ne(),x=p();let c=p(!1);const V=p({severity:null,text:""}),z=p(S.get("registrationFilters")||{}),A=()=>{I()},I=()=>{z.value=S.get("registrationFilters")||{}},B=function(a){return a.filter(d=>d.field!=="organization")},v=p(!1),D=async function(){const a=T.getUser;i.$reset,v.value=!0;try{return k.registrationID?await i.fill(k.registrationID):k.adminView?await i.fillAllRegistrations():await i.fill(a.guid)?i.fill(a.guid):[]}catch(d){v.value=!1,console.warn(d),c.value=!0,V.value={severity:"error",text:"Could not fetch registrations."}}finally{v.value=!1,setTimeout(()=>c.value=!1,1500)}},e=()=>{D().then(()=>{t.value.forEach(a=>{a.createdAt=new Date(a.createdAt),a.updatedAt=new Date(a.updatedAt),a.guestCount=Number(a.guests.length)})})};le(()=>{e()});const l=function(){return i.getRegistration.submitted},P=function(a,d){return S.lookup(a,d)},X=async()=>{await W().fillTables(),await Q().fillGuests().then(()=>{t.value.forEach(a=>{a.details={},a.status=0,a.guests.forEach(d=>{a.details[d]=R.value.filter(C=>C._id===d)[0],a.details[d].tabledetails=H.value.filter(C=>C._id===a.details[d].table)[0]})})}).then(()=>{x.value.value.map(a=>{const d={organization:P("organizations",a.organization)},C=[];a.guests.forEach(j=>{const q=R.value.filter(w=>w._id===j).map(w=>w.tabledetails?w.tabledetails:null).map(w=>w?w.tablename:null);q[0]&&C.push(q[0])});const ee=new Set(C);let Y="";ee.forEach(j=>Y+=`${j} `),a=Object.assign(a,d,{tables:Y})})}).then(()=>{x.value.exportCSV()})},Z=a=>new Date(a).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),M=a=>new Date(a).toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),$=function(a){let d=0;return a%10<=5&&a%10!=0&&(d+=.5),a%10>5&&(d+=1),a/10>=1&&(d+=Math.floor(a/10)),d},U=p({}),K=p(!1),N=p(!1),E=p(!1);return{columns:L,organizations:F,registrations:t,settingsStore:r,guests:R,registration:U,isSubmitted:l,submitted:K,registrationDialog:N,deleteRegistrationDialog:E,dataTableRender:_,filters:z,loading:v,message:c,messageText:V,dt:x,clearFilters:A,exportCSV:X,formatDate:Z,formatTime:M,lookup:P,filter:B,editRegistration:a=>{U.value={...a},N.value=!0},confirmDeleteRegistration:a=>{U.value=a,E.value=!0},deleteRegistration:async function(){v.value=!0;try{i.deleteRegistration(U.value._id).then(D()).then(()=>{v.value=!1,c.value=!0,V.value={severity:"success",text:"Successfully deleted registration and all connected guests."}})}catch(a){v.value=!1,console.warn(a),c.value=!0,V.value={severity:"error",text:"Could not delete registration."}}finally{E.value=!1,await new Promise(a=>setTimeout(a,1500)).then(()=>{c.value=!1,k.registrationID?G.push("/admin"):k.adminView?D():G.push("/")})}},hideDialog:()=>{N.value=!1,K.value=!1},loadLazyData:e,tableCount:$,router:G}},components:{InputFinancial:te}},ce={key:2},me={style:{"text-align":"left"},class:"header-buttons"},ge={class:"p-input-icon-left"},fe=s("i",{class:"pi pi-search"},null,-1),be=m(" No registrations found. "),pe=m(" Loading registration data. Please wait. "),_e={key:0},ye={key:1},ve={class:"item"},he=s("br",null,null,-1),we=s("br",null,null,-1),ke=s("br",null,null,-1),Ve={class:"options-buttons"},De={class:"confirmation-content"},Ce=s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),xe={key:0},Se=s("b",null,[m("All guests must be unseated before this registration may be deleted."),s("br"),m("Please remove all guests from their tables.")],-1),Re=[Se],Te={key:1},ze=s("br",null,null,-1),Ie=m(" This will delete all associated guests."),Pe=s("br",null,null,-1),Ue=s("b",null,"This action cannot be undone.",-1),Le={key:0},Fe={key:1};function Ae(k,i,r,t,R,H){const L=g("ProgressSpinner"),F=g("PrimeMessage"),_=g("PrimeButton"),T=g("InputText"),x=g("router-link"),c=g("PrimeColumn"),V=g("DropDown"),z=g("InputNumber"),A=g("TriStateCheckbox"),I=g("PrimeCalendar"),B=g("DataTable"),v=g("InputFinancial"),D=g("PrimeDialog");return o(),h("div",null,[t.loading?(o(),f(L,{key:0})):t.message?(o(),f(F,{key:1,severity:t.messageText.severity,closable:!1},{default:n(()=>[m(b(t.messageText.text),1)]),_:1},8,["severity"])):(o(),h("div",ce,[(o(),f(B,{class:"p-datatable-sm",value:t.registrations,responsiveLayout:"stack",key:t.dataTableRender,paginator:r.adminView&&!r.registrationID,rows:10,ref:"dt",stripedRows:"",exportFilename:"Registration List",filters:t.filters,"onUpdate:filters":i[3]||(i[3]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["organization","branch","primarycontact","primaryemail","financialcontact","clientministry","resp","serviceline","project","guid"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},oe({empty:n(()=>[be]),loading:n(()=>[pe]),default:n(()=>[r.adminView?(o(),f(c,{field:"_id",header:"ID#",key:"_id",class:"_id"},{body:n(({data:e})=>[u(x,{to:`/admin/edit/${e._id}`},{default:n(()=>[m(b(e.registrar),1)]),_:2},1032,["to"])]),_:1})):y("",!0),u(c,{field:"organization",filterField:"organization",header:"Organization",key:"organization"},{body:n(({data:e})=>[m(b(t.lookup("organizations",e.organization)),1)]),filter:n(({filterModel:e})=>[u(V,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,options:t.organizations,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:n(l=>[l.value?(o(),h("div",_e,[s("div",null,b(t.lookup("organizations",l.value)),1)])):(o(),h("span",ye,b(l.placeholder),1))]),option:n(l=>[s("div",ve,[s("div",null,b(t.lookup("organizations",l.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),(o(!0),h(se,null,re(t.filter(t.columns),e=>(o(),f(c,{field:e.field,header:e.text,key:e.field},{filter:n(({filterModel:l})=>[u(T,{type:"text",modelValue:l.value,"onUpdate:modelValue":P=>l.value=P,class:"p-column-filter",placeholder:`Search by ${e.field}`},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["field","header"]))),128)),r.adminView&&!r.registrationID?(o(),f(c,{field:"guestCount",dataType:"numeric",header:"Guest Count:",key:"guestCount",sortable:!0},{body:n(({data:e})=>[s("span",null,b(e.guestCount),1)]),filter:n(({filterModel:e})=>[u(z,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,showButtons:"",buttonLayout:"horizontal",step:1,decrementButtonClass:"p-button-danger",incrementButtonClass:"p-button-success",incrementButtonIcon:"pi pi-plus",decrementButtonIcon:"pi pi-minus"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):y("",!0),u(c,{hidden:!0,field:"tables",header:"Tables",key:"tables"}),r.adminView?(o(),f(c,{field:"submitted",header:"Submitted?",key:"submitted",dataType:"boolean"},{body:n(({data:e})=>[s("span",null,[s("i",{class:de(["pi pi-check-circle",{"true-icon pi-check-circle":e.submitted,"false-icon pi-times-circle":!e.submitted}]),style:{"font-size":"2rem"}},null,2),he,m(b(e.submitted?" Submitted":" Pending"),1)])]),filter:n(({filterModel:e})=>[u(A,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):y("",!0),r.adminView?(o(),f(c,{field:"createdAt",header:"Created:",key:"createdAt",sortable:!0,dataType:"date"},{body:n(({data:e})=>[m(b(t.formatDate(e.createdAt))+",",1),we,m(b(t.formatTime(e.createdAt)),1)]),filter:n(({filterModel:e})=>[u(I,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):y("",!0),r.adminView?(o(),f(c,{field:"updatedAt",header:"Updated:",key:"updatedAt",sortable:!0,dataType:"date"},{body:n(({data:e})=>[m(b(t.formatDate(e.updatedAt))+",",1),ke,m(" "+b(t.formatTime(e.updatedAt)),1)]),filter:n(({filterModel:e})=>[u(I,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):y("",!0),!t.isSubmitted()&&t.settingsStore.getIsSalesOpen||r.adminView?(o(),f(c,{key:5,exportable:!1,style:{"min-width":"8rem"},header:"Options:"},{body:n(e=>[s("div",Ve,[e.data.submitted?y("",!0):(o(),f(_,{key:0,label:"Edit",icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:l=>t.editRegistration(e.data)},null,8,["onClick"])),!e.data.submitted&&(!r.adminView||r.adminView&&r.registrationID)?(o(),f(_,{key:1,icon:"pi pi-trash",label:"Delete",class:"p-button-rounded p-button-warning delete-button",onClick:l=>t.confirmDeleteRegistration(e.data)},null,8,["onClick"])):y("",!0),r.adminView&&!r.registrationID?(o(),f(_,{key:2,icon:"pi pi-arrow-up-right",label:"View",class:"p-button-rounded p-button-info info-button",onClick:l=>t.router.push(`/admin/edit/${e.data.guid}`)},null,8,["onClick"])):y("",!0)])]),_:1})):y("",!0)]),_:2},[r.adminView&&!r.registrationID?{name:"header",fn:n(()=>[s("div",me,[u(_,{icon:"pi pi-external-link",label:"Export",onClick:i[0]||(i[0]=e=>t.exportCSV(e))}),u(_,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:i[1]||(i[1]=e=>t.clearFilters())}),s("span",ge,[fe,u(T,{title:"Search all by keyword",modelValue:t.filters.global.value,"onUpdate:modelValue":i[2]||(i[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])])])}:void 0]),1032,["value","paginator","filters","loading"]))])),s("div",null,[u(D,{visible:t.registrationDialog,"onUpdate:visible":i[4]||(i[4]=e=>t.registrationDialog=e),style:{width:"50rem",margin:"5rem"},header:"Registration Details",modal:!0,class:"p-fluid registration-dialog",onHide:i[5]||(i[5]=()=>t.loadLazyData())},{default:n(()=>[u(v,{registrationID:t.registration.guid,adminView:r.adminView,detailsView:r.detailsView},null,8,["registrationID","adminView","detailsView"])]),_:1},8,["visible"]),u(D,{visible:t.deleteRegistrationDialog,"onUpdate:visible":i[8]||(i[8]=e=>t.deleteRegistrationDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[t.guests.some(e=>e.tabledetails!==void 0)?(o(),h("div",Le,[u(_,{label:"Okay",icon:"pi pi-check",class:"p-button-text",onClick:i[6]||(i[6]=e=>t.deleteRegistrationDialog=!1)})])):(o(),h("div",Fe,[u(_,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:i[7]||(i[7]=e=>t.deleteRegistrationDialog=!1)}),u(_,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t.deleteRegistration},null,8,["onClick"])]))]),default:n(()=>[s("div",De,[Ce,t.guests.some(e=>e.tabledetails!==void 0)?(o(),h("p",xe,Re)):t.registration?(o(),h("p",Te,[m(" Are you sure you want to delete "+b(t.registration.primarycontact)+"'s registration?",1),ze,Ie,Pe,Ue])):y("",!0)])]),_:1},8,["visible"])])])}var Qe=ae(ue,[["render",Ae],["__file","/Users/brysonbest/projects/premiers-awards-attendance/final/pa-app-dev/table-registration/src/components/RegistrationList.vue"]]);export{Qe as R};
