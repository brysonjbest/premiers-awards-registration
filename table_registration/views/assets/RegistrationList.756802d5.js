import{_ as H,a as O,s as K,r as p,f as x,u as Y,g as q,h as B,b as c,o as l,c as V,i as m,w as n,e as b,t as g,j as J,k as r,d as s,l as v,F as Q,m as W,n as X}from"./index.6a100bc4.js";import{I as Z}from"./InputFinancial.1a42017f.js";const M={props:{adminView:Boolean,detailsView:Boolean,registrationID:String},setup(w){const i=O(),{registrations:d}=K(O()),t=p(x.get("registrationSelection")||[]),N=p((x.get("organizations")||[]).map(a=>a.value)),j=p(0),P=Y(),k=p();let u=p(!1);const h=p({severity:null,text:""}),R=p(x.get("registrationFilters")||{}),y=()=>{U()},U=()=>{R.value=x.get("registrationFilters")||{}},_=p(!1),D=async function(){const a=P.getUser;i.$reset,_.value=!0;try{return w.adminView?await i.fillAllRegistrations():w.registrationID?await i.fill(w.registrationID):await i.fill(a.guid)?i.fill(a.guid):[]}catch(f){_.value=!1,console.warn(f),u.value=!0,h.value={severity:"error",text:"Could not fetch registrations."}}finally{_.value=!1,setTimeout(()=>u.value=!1,1500)}},C=()=>{D().then(()=>{d.value.forEach(a=>{a.createdAt=new Date(a.createdAt),a.updatedAt=new Date(a.updatedAt),a.guestCount=Number(a.guests.length)})})};q(()=>{C()});const L=function(){return i.getRegistration.submitted},S=function(a,f){return x.lookup(a,f)},T=()=>{k.value.value.map(a=>a.organization=S("organizations",a.organization)),k.value.exportCSV()},e=a=>new Date(a).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),o=a=>new Date(a).toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),F=function(a){return a.filter(f=>f.field!=="organization")},G=function(a){let f=0;return a%10<=5&&a%10!=0&&(f+=.5),a%10>5&&(f+=1),a/10>=1&&(f+=Math.floor(a/10)),f},z=p({}),E=p(!1),I=p(!1),A=p(!1);return{columns:t,organizations:N,registrations:d,registration:z,isSubmitted:L,submitted:E,registrationDialog:I,deleteRegistrationDialog:A,dataTableRender:j,filters:R,loading:_,message:u,messageText:h,dt:k,clearFilters:y,exportCSV:T,formatDate:e,formatTime:o,lookup:S,filter:F,editRegistration:a=>{z.value={...a},I.value=!0},confirmDeleteRegistration:a=>{z.value=a,A.value=!0},deleteRegistration:async function(){_.value=!0;try{i.deleteRegistration(z.value._id).then(D()).then(()=>{_.value=!1,u.value=!0,h.value={severity:"success",text:"Successfully deleted registration and all connected guests."}})}catch(a){_.value=!1,console.warn(a),u.value=!0,h.value={severity:"error",text:"Could not delete registration."}}finally{A.value=!1,await new Promise(a=>setTimeout(a,1500)).then(()=>{u.value=!1,w.registrationID?B.push("/admin"):w.adminView?D():B.push("/")})}},hideDialog:()=>{I.value=!1,E.value=!1},loadLazyData:C,tableCount:G,router:B}},components:{InputFinancial:Z}},$={key:2},ee={style:{"text-align":"left"},class:"header-buttons"},te={class:"p-input-icon-left"},ae=r("i",{class:"pi pi-search"},null,-1),ie=b(" No registrations found. "),ne=b(" Loading registration data. Please wait. "),oe={key:0},le={key:1},re={class:"item"},se=r("br",null,null,-1),de=r("br",null,null,-1),ue=r("br",null,null,-1),ce={class:"options-buttons"},me={class:"confirmation-content"},ge=r("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),fe={key:0},pe=r("br",null,null,-1),be=b(" This will delete all associated guests."),ye=r("br",null,null,-1),ve=r("b",null,"This action cannot be undone.",-1);function _e(w,i,d,t,N,j){const P=c("ProgressSpinner"),k=c("PrimeMessage"),u=c("PrimeButton"),h=c("InputText"),R=c("router-link"),y=c("PrimeColumn"),U=c("DropDown"),_=c("InputNumber"),D=c("TriStateCheckbox"),C=c("PrimeCalendar"),L=c("DataTable"),S=c("InputFinancial"),T=c("PrimeDialog");return l(),V("div",null,[t.loading?(l(),m(P,{key:0})):t.message?(l(),m(k,{key:1,severity:t.messageText.severity,closable:!1},{default:n(()=>[b(g(t.messageText.text),1)]),_:1},8,["severity"])):(l(),V("div",$,[(l(),m(L,{class:"p-datatable-sm",value:t.registrations,responsiveLayout:"stack",key:t.dataTableRender,paginator:d.adminView,rows:10,ref:"dt",stripedRows:"",exportFilename:"Registration List",filters:t.filters,"onUpdate:filters":i[3]||(i[3]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["organization","branch","primarycontact","primaryemail","financialcontact","clientministry","resp","serviceline","project","guid"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},J({empty:n(()=>[ie]),loading:n(()=>[ne]),default:n(()=>[d.adminView?(l(),m(y,{field:"guid",header:"ID#",key:"guid",class:"guid"},{body:n(({data:e})=>[s(R,{to:`/admin/edit/${e.guid}`},{default:n(()=>[b(g(e.registrar),1)]),_:2},1032,["to"])]),_:1})):v("",!0),s(y,{field:"organization",filterField:"organization",header:"Organization",key:"organization"},{body:n(({data:e})=>[b(g(t.lookup("organizations",e.organization)),1)]),filter:n(({filterModel:e})=>[s(U,{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,options:t.organizations,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:n(o=>[o.value?(l(),V("div",oe,[r("div",null,g(t.lookup("organizations",o.value)),1)])):(l(),V("span",le,g(o.placeholder),1))]),option:n(o=>[r("div",re,[r("div",null,g(t.lookup("organizations",o.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),(l(!0),V(Q,null,W(t.filter(t.columns),e=>(l(),m(y,{field:e.field,header:e.text,key:e.field},{filter:n(({filterModel:o})=>[s(h,{type:"text",modelValue:o.value,"onUpdate:modelValue":F=>o.value=F,class:"p-column-filter",placeholder:`Search by ${e.field}`},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["field","header"]))),128)),d.adminView?(l(),m(y,{field:"guestCount",dataType:"numeric",header:"Guest Count:",key:"guestCount",sortable:!0},{body:n(({data:e})=>[r("span",null,g(e.guestCount),1)]),filter:n(({filterModel:e})=>[s(_,{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,showButtons:"",buttonLayout:"horizontal",step:1,decrementButtonClass:"p-button-danger",incrementButtonClass:"p-button-success",incrementButtonIcon:"pi pi-plus",decrementButtonIcon:"pi pi-minus"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):v("",!0),d.adminView?(l(),m(y,{field:"submitted",header:"Submitted?",key:"submitted",dataType:"boolean"},{body:n(({data:e})=>[r("span",null,[r("i",{class:X(["pi pi-check-circle",{"true-icon pi-check-circle":e.submitted,"false-icon pi-times-circle":!e.submitted}]),style:{"font-size":"2rem"}},null,2),se,b(g(e.submitted?" Submitted":" Pending"),1)])]),filter:n(({filterModel:e})=>[s(D,{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):v("",!0),d.adminView?(l(),m(y,{field:"createdAt",header:"Created:",key:"createdAt",sortable:!0,dataType:"date"},{body:n(({data:e})=>[b(g(t.formatDate(e.createdAt))+",",1),de,b(g(t.formatTime(e.createdAt)),1)]),filter:n(({filterModel:e})=>[s(C,{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):v("",!0),d.adminView?(l(),m(y,{field:"updatedAt",header:"Updated:",key:"updatedAt",sortable:!0,dataType:"date"},{body:n(({data:e})=>[b(g(t.formatDate(e.updatedAt))+",",1),ue,b(" "+g(t.formatTime(e.updatedAt)),1)]),filter:n(({filterModel:e})=>[s(C,{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):v("",!0),!t.isSubmitted()||d.adminView?(l(),m(y,{key:5,exportable:!1,style:{"min-width":"8rem"},header:"Options:"},{body:n(e=>[r("div",ce,[e.data.submitted?v("",!0):(l(),m(u,{key:0,label:"Edit",icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:o=>t.editRegistration(e.data)},null,8,["onClick"])),e.data.submitted?v("",!0):(l(),m(u,{key:1,icon:"pi pi-trash",label:"Delete",class:"p-button-rounded p-button-warning delete-button",onClick:o=>t.confirmDeleteRegistration(e.data)},null,8,["onClick"])),d.adminView?(l(),m(u,{key:2,icon:"pi pi-arrow-up-right",label:"View",class:"p-button-rounded p-button-info info-button",onClick:o=>t.router.push(`/admin/edit/${e.data.guid}`)},null,8,["onClick"])):v("",!0)])]),_:1})):v("",!0)]),_:2},[d.adminView?{name:"header",fn:n(()=>[r("div",ee,[s(u,{icon:"pi pi-external-link",label:"Export",onClick:i[0]||(i[0]=e=>t.exportCSV(e))}),s(u,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:i[1]||(i[1]=e=>t.clearFilters())}),r("span",te,[ae,s(h,{title:"Search all by keyword",modelValue:t.filters.global.value,"onUpdate:modelValue":i[2]||(i[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])])])}:void 0]),1032,["value","paginator","filters","loading"]))])),r("div",null,[s(T,{visible:t.registrationDialog,"onUpdate:visible":i[4]||(i[4]=e=>t.registrationDialog=e),style:{width:"50rem",margin:"5rem"},header:"Registration Details",modal:!0,class:"p-fluid registration-dialog",onHide:i[5]||(i[5]=()=>t.loadLazyData())},{default:n(()=>[s(S,{registrationID:t.registration.guid,adminView:d.adminView,detailsView:d.detailsView},null,8,["registrationID","adminView","detailsView"])]),_:1},8,["visible"]),s(T,{visible:t.deleteRegistrationDialog,"onUpdate:visible":i[7]||(i[7]=e=>t.deleteRegistrationDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[s(u,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:i[6]||(i[6]=e=>t.deleteRegistrationDialog=!1)}),s(u,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t.deleteRegistration},null,8,["onClick"])]),default:n(()=>[r("div",me,[ge,t.registration?(l(),V("p",fe,[b(" Are you sure you want to delete "+g(t.registration.primarycontact)+"'s registration?",1),pe,be,ye,ve])):v("",!0)])]),_:1},8,["visible"])])])}var xe=H(M,[["render",_e]]);export{xe as R};
