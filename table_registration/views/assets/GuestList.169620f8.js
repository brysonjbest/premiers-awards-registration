import{f as V}from"./settings.services.cc8609a3.js";import{u as de,r as O}from"./index.esm.99466269.js";import{_ as ue,f as ce,s as X,r as y,u as me,a as ye,g as fe,h as ge,b as w,o as r,c as m,i as D,w as l,e as f,t as d,d as s,k as i,l as v,j as G,n as P,F as Z,m as M,O as ve,Q as be}from"./index.5a2fb414.js";import{u as $,a as ee,t as pe}from"./guests.d524cdd0.js";const _e={props:{adminView:Boolean,registrationID:String,tableID:String},setup(x){const o=$(),u=ce(),{guests:t}=X($()),B=y(),H=y(V.get("guestSelection")||[]),q=y((V.get("organizations")||[]).map(n=>n.value)),j=y((V.get("attendancetypes")||[]).map(n=>n.value)),h=y((V.get("accessibilityoptions")||[]).map(n=>n.value)),C=y((V.get("dietaryoptions")||[]).map(n=>n.value)),I=y(V.get("organizations")||[]),g=y(V.get("attendancetypes")||[]),U=y(V.get("accessibilityoptions")||[]),E=y(V.get("dietaryoptions")||[]),F=me(),L=y(),b=y(!1);let k=y(!1);const e=y({severity:null,text:""}),a=ye(),te=ee(),z=async function(){const n=F.getUser;o.$reset,b.value=!0;try{B.value=await(await pe.getAllTables()).data,await new Promise(c=>setTimeout(c,1)).then(async()=>x.registrationID?await o.fillGuestsRegistration(x.registrationID):x.adminView?await o.fillGuests():x.tableID?await o.fillGuestsTable(x.tableID):await o.fillGuestsRegistration(n.guid)?o.fillGuestsRegistration(n.guid):[]).then(()=>{t.value.forEach(c=>{c.createdAt=new Date(c.createdAt),c.updatedAt=new Date(c.updatedAt),c.assignedTable=!!c.table,c.tabledetails=B.value.filter(p=>p._id===c.table)[0]})})}catch(c){b.value=!1,console.warn(c),k.value=!0,e.value={severity:"error",text:"Could not fetch registrations."}}finally{b.value=!1,setTimeout(()=>k.value=!1,1500)}},K=async function(){await z()};fe(()=>{K()});const ae=function(){return a.getRegistration.submitted},J=y(V.get("guestFilters")||{}),le=()=>{oe()},oe=()=>{J.value=V.get("guestFilters")||{}},ie=()=>{L.value.value.map(n=>{const c={organization:A("organizations",n.organization)},p={dietary:Q("dietaryoptions",n.dietary)},T={attendancetype:A("attendancetypes",n.attendancetype)},re={accessibility:Q("accessibilityoptions",n.accessibility)};n=Object.assign(n,c,T,p,re)}),L.value.exportCSV()},A=function(n,c){return V.lookup(n,c)},ne=n=>new Date(n).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),se=n=>new Date(n).toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),Q=function(n,c){let p="";for(let T of c)p&&p.length>0?p+=`\r
${A(n,T)}`:p=A(n,T);return p},S=y({}),W=de({organization:{required:O},firstname:{required:O},lastname:{required:O},attendancetype:{required:O}},S),Y=y(!1),N=y(!1),R=y(!1);return{columns:H,settingsStore:u,v$:W,dt:L,filters:J,loading:b,message:k,messageText:e,isSubmitted:ae,exportCSV:ie,clearFilters:le,organizationsFilter:q,attendancetypesFilter:j,accessibilityFilter:h,dietaryFilter:C,organizations:I,attendancetypes:g,accessibility:U,dietary:E,guests:t,guest:S,submitted:Y,guestDialog:N,deleteGuestDialog:R,formatDate:ne,formatTime:se,lookup:A,lookupLoop:Q,editGuest:n=>{S.value={...n},N.value=!0},confirmDeleteGuest:n=>{S.value=n,R.value=!0},deleteGuest:async function(){b.value=!0;try{o.deleteGuest(S.value._id,S.value.registration).then(z()).then(()=>{b.value=!1,k.value=!0,e.value={severity:"success",text:"Successfully deleted guest."}})}catch(n){console.log(n),b.value=!1,console.warn(n),k.value=!0,e.value={severity:"error",text:"Could not delete guest."}}finally{R.value=!1,await new Promise(n=>setTimeout(n,1500)).then(()=>{k.value=!1,z()})}},removeGuest:async function(n){b.value=!0,await te.fillOnlyTable(x.tableID||n);const{table:c}=X(ee()),p=c.value;try{o.removeGuestFromTable(S.value._id,{table:null},p).then(z()).then(()=>{b.value=!1,k.value=!0,e.value={severity:"success",text:"Successfully removed guest."}})}catch(T){console.log(T),b.value=!1,console.warn(T),k.value=!0,e.value={severity:"error",text:"Could not delete guest."}}finally{R.value=!1,await new Promise(T=>setTimeout(T,1500)).then(()=>{k.value=!1,z()})}},hideDialog:()=>{N.value=!1,Y.value=!1},saveGuest:async function(n){n.preventDefault(),Y.value=!0,await W.value.$validate()&&o.updateGuest(S.value._id,S.value).then(()=>{N.value=!1,S.value={}}).then(z()).catch(p=>{console.log(p)}).finally(()=>{K()})},loadLazyData:K,router:ge,userStore:F}}},_=x=>(ve("data-v-85bafdc8"),x=x(),be(),x),he={key:2},ke={style:{"text-align":"left"},class:"header-buttons"},Ve={key:0,class:"p-input-icon-left"},we=_(()=>i("i",{class:"pi pi-search"},null,-1)),xe=f(" No guests found. "),De=f(" Loading guest data. Please wait. "),Se={key:0},Ce={key:1},Te={class:"item"},Ue={key:0},ze={key:1},Ge={class:"item"},Fe={key:0},Le={key:1},Ae={class:"item"},Pe={key:0},Ie={key:1},Ne={class:"item"},Re=_(()=>i("br",null,null,-1)),Oe={key:0},Be={key:1},qe=_(()=>i("br",null,null,-1)),je=_(()=>i("br",null,null,-1)),Ee={class:"options-buttons"},Ke={class:"dropdown"},Qe=_(()=>i("label",{for:"organization"},"Organization:",-1)),Ye={key:0,class:"p-error",id:"organization-help"},He={class:"field-text"},Je=_(()=>i("label",{for:"firstname"},"First Name",-1)),We={key:0,class:"p-error",id:"firstname-help"},Xe={class:"field-text"},Ze=_(()=>i("label",{for:"lastname"},"Last Name",-1)),Me={key:0,class:"p-error",id:"lastname-help"},$e={class:"dropdown"},et=_(()=>i("label",{for:"attendancetype"},"Attendance Type:",-1)),tt={key:0,class:"p-error",id:"attendancetype-help"},at=_(()=>i("label",{for:"accessibility"},"Accessibility Requirements:",-1)),lt={class:"checkbox-group"},ot=["for"],it=_(()=>i("label",{for:"dietary"},"Dietary Requirements:",-1)),nt={class:"checkbox-group"},st=["for"],rt={key:0,class:"field-text"},dt=_(()=>i("label",{for:"guest-notes"},"Notes:",-1)),ut=_(()=>i("small",{class:"p-error",id:"guest-notes-help"},"Notes field visible to admin only.",-1)),ct={class:"confirmation-content"},mt=_(()=>i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),yt={key:0},ft=f("?");function gt(x,o,u,t,B,H){const q=w("ProgressSpinner"),j=w("PrimeMessage"),h=w("PrimeButton"),C=w("InputText"),I=w("router-link"),g=w("PrimeColumn"),U=w("DropDown"),E=w("TriStateCheckbox"),F=w("PrimeCalendar"),L=w("DataTable"),b=w("CheckBox"),k=w("PrimeDialog");return r(),m("div",null,[t.loading?(r(),D(q,{key:0})):t.message?(r(),D(j,{key:1,severity:t.messageText.severity,closable:!1},{default:l(()=>[f(d(t.messageText.text),1)]),_:1},8,["severity"])):(r(),m("div",he,[s(L,{class:"p-datatable-sm guests-datatable",value:t.guests,exportFilename:u.registrationID?`${u.registrationID} Guest List`:"Guest List",responsiveLayout:"stack",paginator:u.adminView,rows:10,ref:"dt",stripedRows:"",filters:t.filters,"onUpdate:filters":o[3]||(o[3]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["firstname","lastname","attendancetype","accessibility","dietary","registration"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},{header:l(()=>[i("div",ke,[s(h,{icon:"pi pi-external-link",label:"Export",onClick:o[0]||(o[0]=e=>t.exportCSV(e))}),s(h,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:o[1]||(o[1]=e=>t.clearFilters())}),u.adminView?(r(),m("span",Ve,[we,s(C,{title:"Search all by keyword.",modelValue:t.filters.global.value,"onUpdate:modelValue":o[2]||(o[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])):v("",!0)])]),empty:l(()=>[xe]),loading:l(()=>[De]),default:l(()=>[t.userStore.getUser.role==="super-administrator"?(r(),D(g,{field:"registration",header:"Registration",key:"registration",class:"guid"},{body:l(({data:e})=>[s(I,{to:`/admin/edit/${e.registration}`,class:"registration-link"},{default:l(()=>[f(d(e.registration),1)]),_:2},1032,["to"])]),filter:l(({filterModel:e})=>[s(C,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by registration"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):v("",!0),s(g,{field:"organization",header:"Organization",key:"organization"},G({body:l(({data:e})=>[f(d(t.lookup("organizations",e.organization)),1)]),_:2},[u.adminView?{name:"filter",fn:l(({filterModel:e})=>[s(U,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.organizationsFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(r(),m("div",Se,[i("div",null,d(t.lookup("organizations",a.value)),1)])):(r(),m("span",Ce,d(a.placeholder),1))]),option:l(a=>[i("div",Te,[i("div",null,d(t.lookup("organizations",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])])}:void 0]),1024),s(g,{field:"firstname",header:"First Name",key:"firstname"},G({body:l(({data:e})=>[f(d(e.firstname),1)]),_:2},[u.adminView?{name:"filter",fn:l(({filterModel:e})=>[s(C,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by First Name"},null,8,["modelValue","onUpdate:modelValue"])])}:void 0]),1024),s(g,{field:"lastname",header:"Last Name",key:"lastname"},G({body:l(({data:e})=>[f(d(e.lastname),1)]),_:2},[u.adminView?{name:"filter",fn:l(({filterModel:e})=>[s(C,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by Last Name"},null,8,["modelValue","onUpdate:modelValue"])])}:void 0]),1024),s(g,{field:"attendancetype",header:"Attendance Type",key:"attendancetype"},G({body:l(({data:e})=>[f(d(t.lookup("attendancetypes",e.attendancetype)),1)]),_:2},[u.adminView?{name:"filter",fn:l(({filterModel:e})=>[s(U,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.attendancetypesFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(r(),m("div",Ue,[i("div",null,d(t.lookup("attendancetypes",a.value)),1)])):(r(),m("span",ze,d(a.placeholder),1))]),option:l(a=>[i("div",Ge,[i("div",null,d(t.lookup("attendancetypes",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])])}:void 0]),1024),s(g,{field:"accessibility",header:"Accessibility Requirements",key:"accessibility"},G({body:l(({data:e})=>[f(d(t.lookupLoop("accessibilityoptions",e.accessibility)),1)]),_:2},[u.adminView?{name:"filter",fn:l(({filterModel:e})=>[s(U,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.accessibilityFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(r(),m("div",Fe,[i("div",null,d(t.lookup("accessibilityoptions",a.value)),1)])):(r(),m("span",Le,d(a.placeholder),1))]),option:l(a=>[i("div",Ae,[i("div",null,d(t.lookup("accessibilityoptions",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])])}:void 0]),1024),s(g,{field:"dietary",header:"Dietary Requirements",key:"dietary"},G({body:l(({data:e})=>[f(d(t.lookupLoop("dietaryoptions",e.dietary)),1)]),_:2},[u.adminView?{name:"filter",fn:l(({filterModel:e})=>[s(U,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.dietaryFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(r(),m("div",Pe,[i("div",null,d(t.lookup("dietaryoptions",a.value)),1)])):(r(),m("span",Ie,d(a.placeholder),1))]),option:l(a=>[i("div",Ne,[i("div",null,d(t.lookup("dietaryoptions",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])])}:void 0]),1024),u.adminView?(r(),D(g,{field:"notes",header:"Notes:",key:"notes"},{body:l(({data:e})=>[f(d(e.notes),1)]),_:1})):v("",!0),u.adminView?(r(),D(g,{field:"tabledetails.tablename",header:"Table",key:"tabledetails.tablename",dataType:"boolean",filterField:"assignedTable",sortable:""},{body:l(({data:e})=>[i("span",null,[i("i",{class:P({"true-icon":e.assignedTable,"false-icon pi pi-times-circle":!e.assignedTable}),style:{"font-size":"2rem"}},null,2),Re,e.assignedTable?(r(),m("div",Oe,[s(I,{to:`/admin/table/${e.table}`},{default:l(()=>[f(d(e.tabledetails.tablename),1)]),_:2},1032,["to"])])):(r(),m("div",Be,"Pending"))])]),filter:l(({filterModel:e})=>[s(E,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):v("",!0),u.adminView?(r(),D(g,{field:"createdAt",header:"Created:",key:"createdAt",sortable:!0,dataType:"date"},{body:l(({data:e})=>[f(d(t.formatDate(e.createdAt))+",",1),qe,f(d(t.formatTime(e.createdAt)),1)]),filter:l(({filterModel:e})=>[s(F,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):v("",!0),u.adminView?(r(),D(g,{field:"updatedAt",header:"Updated:",key:"updatedAt",sortable:!0,dataType:"date"},{body:l(({data:e})=>[f(d(t.formatDate(e.updatedAt))+",",1),je,f(" "+d(t.formatTime(e.updatedAt)),1)]),filter:l(({filterModel:e})=>[s(F,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):v("",!0),!t.isSubmitted()&&t.settingsStore.getIsSalesOpen||u.adminView||u.tableID?(r(),D(g,{key:5,exportable:!1,style:{"min-width":"8rem"},header:"Options:"},{body:l(e=>[i("div",Ee,[s(h,{icon:"pi pi-pencil",label:"Edit",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:a=>t.editGuest(e.data)},null,8,["onClick"]),s(h,{icon:"pi pi-trash",label:e.data.table||u.tableID?"Remove from Table":"Delete",class:"p-button-rounded p-button-warning delete-button",onClick:a=>t.confirmDeleteGuest(e.data)},null,8,["label","onClick"]),u.adminView&&!u.registrationID?(r(),D(h,{key:0,icon:"pi pi-arrow-up-right",label:"View",class:"p-button-rounded p-button-info info-button",onClick:a=>t.router.push(`/admin/edit/${e.data.registration}`)},null,8,["onClick"])):v("",!0)])]),_:1})):v("",!0)]),_:1},8,["value","exportFilename","paginator","filters","loading"])])),i("div",null,[s(k,{visible:t.guestDialog,"onUpdate:visible":o[11]||(o[11]=e=>t.guestDialog=e),style:{width:"50rem",margin:"5rem"},header:"Guest Details",modal:!0,class:"p-fluid"},{footer:l(()=>[s(h,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:t.hideDialog},null,8,["onClick"]),s(h,{label:"Save",icon:"pi pi-check",class:"p-button-text",onClick:t.saveGuest},null,8,["onClick"])]),default:l(()=>[i("div",Ke,[Qe,s(U,{class:P({"p-invalid":t.v$.organization.$error}),id:"organization",modelValue:t.guest.organization,"onUpdate:modelValue":o[4]||(o[4]=e=>t.guest.organization=e),options:t.organizations,optionLabel:"text",optionValue:"value",name:"organization",title:"Organization",placeholder:"Select an Organization"},null,8,["class","modelValue","options"]),t.v$.organization.$error?(r(),m("small",Ye,"Please select your organization.")):v("",!0)]),i("div",He,[Je,s(C,{class:P({"p-invalid":t.v$.firstname.$error}),id:"firstname",modelValue:t.guest.firstname,"onUpdate:modelValue":o[5]||(o[5]=e=>t.guest.firstname=e),modelModifiers:{trim:!0},required:"true",name:"firstname",title:"First Name",autofocus:""},null,8,["class","modelValue"]),t.v$.firstname.$error?(r(),m("small",We,"Please enter guest's first name.")):v("",!0)]),i("div",Xe,[Ze,s(C,{class:P({"p-invalid":t.v$.lastname.$error}),id:"lastname",modelValue:t.guest.lastname,"onUpdate:modelValue":o[6]||(o[6]=e=>t.guest.lastname=e),modelModifiers:{trim:!0},required:"true",name:"lastname",title:"Last Name",autofocus:""},null,8,["class","modelValue"]),t.v$.lastname.$error?(r(),m("small",Me,"Please enter guest's last name.")):v("",!0)]),i("div",$e,[et,s(U,{class:P({"p-invalid":t.v$.attendancetype.$error}),id:"attendancetype",modelValue:t.guest.attendancetype,"onUpdate:modelValue":o[7]||(o[7]=e=>t.guest.attendancetype=e),options:t.attendancetypes,optionLabel:"text",optionValue:"value",name:"attendancetype",title:"Attendance Type",placeholder:"Select the type of attendance for this guest"},null,8,["class","modelValue","options"]),t.v$.attendancetype.$error?(r(),m("small",tt,"Please select the attendance type for this guest.")):v("",!0)]),at,i("div",lt,[(r(!0),m(Z,null,M(t.accessibility,e=>(r(),m("div",{key:e.key,name:"accessibility",class:"field-checkbox"},[s(b,{id:e.key,name:"accessibility",value:e.value,modelValue:t.guest.accessibility,"onUpdate:modelValue":o[8]||(o[8]=a=>t.guest.accessibility=a)},null,8,["id","value","modelValue"]),i("label",{for:e.key},d(e.text),9,ot)]))),128))]),it,i("div",nt,[(r(!0),m(Z,null,M(t.dietary,e=>(r(),m("div",{key:e.key,class:"field-checkbox",name:"dietary"},[s(b,{id:e.key,name:"dietary",value:e.value,modelValue:t.guest.dietary,"onUpdate:modelValue":o[9]||(o[9]=a=>t.guest.dietary=a)},null,8,["id","value","modelValue"]),i("label",{for:e.key},d(e.text),9,st)]))),128))]),u.adminView?(r(),m("div",rt,[dt,s(C,{id:"lastname",modelValue:t.guest.notes,"onUpdate:modelValue":o[10]||(o[10]=e=>t.guest.notes=e),modelModifiers:{trim:!0},name:"guestnotes",title:"Notes",autofocus:""},null,8,["modelValue"]),ut])):v("",!0)]),_:1},8,["visible"]),s(k,{visible:t.deleteGuestDialog,"onUpdate:visible":o[14]||(o[14]=e=>t.deleteGuestDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:l(()=>[s(h,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o[12]||(o[12]=e=>t.deleteGuestDialog=!1)}),!u.tableID&&!t.guest.table?(r(),D(h,{key:0,label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t.deleteGuest},null,8,["onClick"])):(r(),D(h,{key:1,icon:"pi pi-trash",label:"Remove from Table",class:"p-button-rounded p-button-warning delete-button",onClick:o[13]||(o[13]=e=>t.removeGuest(t.guest.table))}))]),default:l(()=>[i("div",ct,[mt,t.guest?(r(),m("span",yt,[f("Are you sure you want to "+d(!u.tableID&&!t.guest.table?"delete":"remove")+" ",1),i("b",null,d(t.guest.firstname)+" "+d(t.guest.lastname),1),ft])):v("",!0)])]),_:1},8,["visible"])])])}var Ct=ue(_e,[["render",gt],["__scopeId","data-v-85bafdc8"]]);export{Ct as G};
