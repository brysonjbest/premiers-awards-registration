import{_ as $,z as K,o as i,c as _,k as d,n as j,b as v,R as ie,F as re,m as de,S as ue,d as l,w as o,e as k,t as u,a as H,s as E,r,g as te,i as P,l as Q,O as ce,Q as be,u as pe,P as me}from"./index.bd233f80.js";import{a as J,u as ee}from"./guests.3cd50ea9.js";import{N as ge}from"./NavMenu.9d576eac.js";import{f as A}from"./settings.services.3d73a8a6.js";import{u as fe,r as ve}from"./index.esm.55d45502.js";const _e={props:{table:Object},setup(T){const s="pi pi-circle-fill full-table",g="pi pi-circle-fill half-table",t="pi pi-circle empty-table",S="pi pi-circle-fill default-table";return{tableClass:K(()=>T.table.status==="full-table"?s:T.table.status==="half-table"?g:T.table.status==="empty-table"?t:S)}}},ye={class:"table-icon"};function he(T,s,g,t,S,w){return i(),_("div",ye,[d("i",{class:j(t.tableClass)},null,2)])}var ke=$(_e,[["render",he],["__file","/Users/brysonbest/projects/premiers-awards-attendance/final/pa-app-dev/table-registration/src/components/icons/TableIcon.vue"]]);const Te={props:{tables:Array},components:{TableIcon:ke}},xe={class:"table-display"},we={class:"table-name"},Ve={class:"table-seats-taken"},Se={class:"table-free-seats"};function ze(T,s,g,t,S,w){const f=v("TableIcon"),x=v("router-link"),c=ie("tooltip");return i(),_("div",xe,[(i(!0),_(re,null,de(g.tables,p=>(i(),_("div",{class:"table-details",key:p},[ue(l(f,{table:p},null,8,["table"]),[[c,`${p.registrationOrganizations?p.registrationOrganizations:"No Guests"}`,void 0,{top:!0,hover:!0}]]),d("div",we,[l(x,{to:`/admin/table/${p.guid}`},{default:o(()=>[k(u(p.tablename),1)]),_:2},1032,["to"])]),d("div",Ve,u(p.guests.length)+" / "+u(p.tablecapacity)+" Seats Taken ",1),d("div",Se,u(p.tablecapacity-p.guests.length)+" Seats Free ",1)]))),128))])}var Ce=$(Te,[["render",ze],["__scopeId","data-v-8b58d610"],["__file","/Users/brysonbest/projects/premiers-awards-attendance/final/pa-app-dev/table-registration/src/components/common/TableDisplay.vue"]]);const De={props:{key:Number},emits:["loadedTables"],setup(T,{emit:s}){const g=H(),{registrations:t}=E(H()),S=function(e,a){return A.lookup(e,a)},w=J(),{tables:f}=E(J()),x=r([]),c=r([]),p=K(()=>f.value.sort((e,a)=>e.tablename-a.tablename)),m=r(A.get("tableSelection")||[]),L=r((A.get("organizations")||[]).map(e=>e.value));let b=r(!1);const z=r({severity:null,text:""}),y=r(!1),D=async function(){g.$reset,w.$reset,y.value=!0;try{return await w.fillTables().then(()=>{g.fillAllRegistrations()})}catch(e){y.value=!1,console.warn(e),b.value=!0,z.value={severity:"error",text:"Could not fetch tables and/or registrations."}}finally{await new Promise(e=>setTimeout(e,1)).then(()=>{y.value=!1,b.value=!1,s("loadedTables")})}},R=()=>{D().then(()=>{f.value.forEach(e=>{e.status=K(()=>e.guests.length>=e.tablecapacity?"full-table":e.guests.length>0?"half-table":"empty-table"),e.registrationOrganizations=K(()=>{const a=e.organizations.map(I=>I.organization),F=new Set(a);return Array.from(F).map(I=>I?S("organizations",I):"").join(`\r
`)})})}).then(()=>{f.value.sort((e,a)=>{const F=e.tablename[0],N=e.tablename[1],B=a.tablename[0],I=a.tablename[1];return N===I&&F>=B?1:F>B&&N<I?-1:0}),f.value.forEach(e=>{e.tablename.length>2?x.value.push(e):c.value.push(e)})})};return te(()=>{R()}),{fillList:D,loadLazyData:R,tables:f,specialTables:x,standardTables:c,registrations:t,organizations:L,message:b,loading:y,messageText:z,tableStore:w,columns:m,computedTables:p}},components:{TableDisplay:Ce}},ae=T=>(ce("data-v-247158a4"),T=T(),be(),T),Pe={key:2,id:"visual-table-list"},Le={key:0,id:"special-tables-section"},Ie=ae(()=>d("h4",null,"Named/Specialty Tables",-1)),Ae={id:"standard-tables-section"},Re=ae(()=>d("h4",null,"Standard Table Layout",-1));function Ue(T,s,g,t,S,w){const f=v("ProgressSpinner"),x=v("PrimeMessage"),c=v("TableDisplay");return i(),_("div",null,[t.loading?(i(),P(f,{key:0})):t.message?(i(),P(x,{key:1,severity:t.messageText.severity,closable:!1},{default:o(()=>[k(u(t.messageText.text),1)]),_:1},8,["severity"])):(i(),_("div",Pe,[t.specialTables.length>0?(i(),_("div",Le,[Ie,(i(),P(c,{tables:t.specialTables,key:g.key},null,8,["tables"]))])):Q("",!0),d("div",Ae,[Re,(i(),P(c,{tables:t.standardTables,key:g.key},null,8,["tables"]))])]))])}var Fe=$(De,[["render",Ue],["__scopeId","data-v-247158a4"],["__file","/Users/brysonbest/projects/premiers-awards-attendance/final/pa-app-dev/table-registration/src/components/TableVisual.vue"]]);const Ge={emits:["addGuest"],setup(T,{emit:s}){const g=H(),t=ee(),{registrations:S}=E(H()),{guests:w}=E(ee()),{tables:f}=E(J()),x=r(),c=r(0),p=r([]),m=r(A.get("tableSelection")||[]),L=r((A.get("organizations")||[]).map(n=>n.value));let b=r(!1);const z=r({severity:null,text:""}),y=r(!1),D=r(!1),R=async function(){g.$reset,t.$reset,y.value=!0;try{await t.fillGuests().then(async()=>{await g.fillAllRegistrations().then(()=>{S.value.forEach(n=>{n.details={},n.status=0,n.guests.forEach(h=>{n.details[h]=w.value.filter(V=>V._id===h)[0],n.details[h].tabledetails=f.value.filter(V=>V._id===n.details[h].table)[0],n.details[h].table&&(n.status+=1)}),n.allAssigned=n.status>=n.guests.length,n.guestList=n.guests.length})})})}catch(n){y.value=!1,console.warn(n),b.value=!0,z.value={severity:"error",text:"Could not fetch registrations."}}finally{y.value=!1,setTimeout(()=>b.value=!1,1500)}},e=async function(){await R()};te(()=>{e()});const a=function(n,h){return A.lookup(n,h)},F=function(n,h){let V="";for(let G of h)V.length>0?V+=`, ${a(n,G)}`:V=a(n,G);return V},N=()=>{x.value.value.map(n=>n.organization=a("organizations",n.organization)),x.value.exportCSV()},B=r(A.get("registrationFilters")||{}),I=()=>{X()},X=()=>{B.value=A.get("registrationFilters")||{}},M=r(!1),q=r(!1),C=r({}),W=r({}),le=n=>{C.value={...n},M.value=!0},se=n=>{W.value={...n},q.value=!0},ne=()=>{M.value=!1,q.value=!1},Y=fe({table:{required:ve}},C),Z=async()=>{if(!await Y.value.$validate())return;const h=C.value.table,V=C.value._id,G={_id:h};try{y.value=!0,C.value.tabledetails!=null&&await t.removeGuestFromTable(V,{table:null,organization:C.value.organization},{_id:C.value.tabledetails._id}),await t.addGuestToTable(V,{table:h,organization:C.value.organization},G).then(()=>{y.value=!1,b.value=!0,z.value={severity:"success",text:"Successfully updated guest and table."}})}catch(O){y.value=!1,console.warn(O),b.value=!0,z.value={severity:"error",text:"Guest and table could not be updated."}}finally{await new Promise(O=>setTimeout(O,1500)).then(()=>{b.value=!1,M.value=!1,s("addGuest")}).then(()=>{e()})}};return{fillList:R,dt:x,dataTableRender:c,expandedRows:p,lookup:a,lookupLoop:F,exportCSV:N,filters:B,clearFilters:I,initFilters:X,loadLazyData:e,registrations:S,guests:w,tables:f,organizations:L,message:b,loading:y,messageText:z,columns:m,tableDetailsDialog:M,guest:C,editGuestTable:le,hideDialog:ne,v$:Y,editTable:Z,multiTableDialog:q,editRegistrationTable:se,registration:W,multiSeat:async n=>{const h=W.value.details,V=Object.keys(h),G=f.value.filter(U=>U._id===n)[0],O=G.tablecapacity-G.guests.length;try{D.value=!0;let U=0;for(let oe of V)U<O&&(C.value=h[oe],C.value.table=n,await Z(),U++);D.value=!1,b.value=!0,z.value={severity:"success",text:"Successfully updated guests and table."}}catch(U){D.value=!1,console.warn(U),b.value=!0,z.value={severity:"error",text:"Bulk guests and table could not be updated."}}finally{await new Promise(U=>setTimeout(U,1500)).then(()=>{b.value=!1,q.value=!1,s("addGuest")}).then(()=>{e()})}},multiloading:D}}},Be={key:2,class:"registrations-visual"},Ne={style:{"text-align":"left"}},Oe={class:"p-input-icon-left"},je=d("i",{class:"pi pi-search"},null,-1),Ee=k(" No registrations found. "),$e=k(" Loading registration data. Please wait. "),Me={key:0},qe={key:1},Ke={class:"item"},He=d("br",null,null,-1),Qe=d("br",null,null,-1),Je={class:"orders-subtable"},We={key:1},Xe={key:0},Ye={key:1},Ze={class:"dropdown"},et=d("label",{for:"table"},"Table",-1),tt={key:0,class:"p-error",id:"table-help"},at={class:"dropdown"},lt=d("label",{for:"table"},"Table",-1),st={key:0,class:"p-error",id:"table-help"};function nt(T,s,g,t,S,w){const f=v("ProgressSpinner"),x=v("PrimeMessage"),c=v("PrimeButton"),p=v("InputText"),m=v("PrimeColumn"),L=v("router-link"),b=v("DropDown"),z=v("InputNumber"),y=v("TriStateCheckbox"),D=v("PrimeDialog"),R=v("DataTable");return i(),_("div",null,[t.loading||t.multiloading?(i(),P(f,{key:0})):t.message?(i(),P(x,{key:1,severity:t.messageText.severity,closable:!1},{default:o(()=>[k(u(t.messageText.text),1)]),_:1},8,["severity"])):(i(),_("div",Be,[(i(),P(R,{class:"p-datatable-sm",exportFilename:"Event List",value:t.registrations,responsiveLayout:"stack",breakpoint:"780px",key:t.dataTableRender,expandedRows:t.expandedRows,"onUpdate:expandedRows":s[10]||(s[10]=e=>t.expandedRows=e),rows:10,paginator:!0,ref:"dt",stripedRows:"",sortField:"organization",sortOrder:1,filters:t.filters,"onUpdate:filters":s[11]||(s[11]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["organization","guid"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},{header:o(()=>[d("div",Ne,[l(c,{icon:"pi pi-external-link",label:"Export",onClick:s[0]||(s[0]=e=>t.exportCSV(e))}),l(c,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:s[1]||(s[1]=e=>t.clearFilters())}),d("span",Oe,[je,l(p,{title:"Search all by keyword",modelValue:t.filters.global.value,"onUpdate:modelValue":s[2]||(s[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])])]),empty:o(()=>[Ee]),loading:o(()=>[$e]),expansion:o(e=>[d("div",Je,[d("h5",null,"Guests for "+u(e.data.registrar),1),l(R,{value:Object.values(e.data.details),responsiveLayout:"scroll"},{default:o(()=>[l(m,{field:"organization",header:"Organization",sortable:""},{body:o(({data:a})=>[k(u(t.lookup("organizations",a.organization)),1)]),_:1}),l(m,{field:"name",header:"Name"},{body:o(({data:a})=>[k(u(a.firstname)+" "+u(a.lastname),1)]),_:1}),l(m,{field:"attendancetype",header:"Attendee Type",sortable:""},{body:o(({data:a})=>[k(u(t.lookup("attendancetypes",a.attendancetype)),1)]),_:1}),l(m,{field:"accessibility",header:"Accessibility Accomodations Required",sortable:""},{body:o(({data:a})=>[k(u(t.lookupLoop("accessibilityoptions",a.accessibility)),1)]),_:1}),l(m,{field:"tabledetails.tablename",header:"Seated?",sortable:""},{body:o(({data:a})=>[a.table?(i(),P(L,{key:0,to:`/admin/table/${a.table}`},{default:o(()=>[k(u(a.tabledetails.tablename),1)]),_:2},1032,["to"])):(i(),_("span",We,"Pending"))]),_:1}),l(m,{field:"table",header:"Edit Table"},{body:o(({data:a})=>[e.data.submitted===!1?(i(),_("span",Xe,"Must Submit Registration")):(i(),_("span",Ye,[l(c,{icon:"pi pi-pencil",label:a.tabledetails?"Edit Table":"Add Table",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:F=>t.editGuestTable(a)},null,8,["label","onClick"])]))]),_:2},1024),l(D,{visible:t.tableDetailsDialog,"onUpdate:visible":s[5]||(s[5]=a=>t.tableDetailsDialog=a),style:{width:"50rem",margin:"5rem"},header:"Table Details",modal:!0,class:"p-fluid registration-dialog"},{footer:o(()=>[l(c,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:s[4]||(s[4]=a=>t.tableDetailsDialog=!1)}),l(c,{label:"Confirm Table",icon:"pi pi-check",class:"p-button-text",onClick:t.editTable},null,8,["onClick"])]),default:o(()=>[d("div",Ze,[et,l(b,{class:j({"p-invalid":t.v$.table.$error}),id:"table",modelValue:t.guest.table,"onUpdate:modelValue":s[3]||(s[3]=a=>t.guest.table=a),options:t.tables.filter(a=>a.tablecapacity>a.guests.length),name:"table",optionLabel:"tablename",optionValue:"_id",placeholder:"Select the table."},null,8,["class","modelValue","options"]),t.v$.table.$error?(i(),_("small",tt,"Please select the table.")):Q("",!0)])]),_:1},8,["visible"])]),_:2},1032,["value"])])]),default:o(()=>[l(m,{header:"Guests",expander:!0,headerStyle:"width: 3rem"}),l(m,{field:"guid",header:"ID#",key:"guid",class:"guid"},{body:o(({data:e})=>[l(L,{to:`/admin/edit/${e.guid}`},{default:o(()=>[k(u(e.registrar),1)]),_:2},1032,["to"])]),_:1}),l(m,{field:"organization",filterField:"organization",header:"Organization",key:"organization",sortable:!0},{body:o(({data:e})=>[k(u(t.lookup("organizations",e.organization)),1)]),filter:o(({filterModel:e})=>[l(b,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.organizations,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:o(a=>[a.value?(i(),_("div",Me,[d("div",null,u(t.lookup("organizations",a.value)),1)])):(i(),_("span",qe,u(a.placeholder),1))]),option:o(a=>[d("div",Ke,[d("div",null,u(t.lookup("organizations",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),l(m,{field:"guestList",header:"Guest List",key:"guestList",filterField:"guestList",sortable:""},{body:o(({data:e})=>[k(u(e.guests.length),1)]),filter:o(({filterModel:e})=>[l(z,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,showButtons:"",buttonLayout:"horizontal",step:1,decrementButtonClass:"p-button-danger",incrementButtonClass:"p-button-success",incrementButtonIcon:"pi pi-plus",decrementButtonIcon:"pi pi-minus"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{field:"submitted",header:"Submitted?",key:"submitted",dataType:"boolean"},{body:o(({data:e})=>[d("span",null,[d("i",{class:j(["pi pi-check-circle",{"true-icon pi-check-circle":e.submitted,"false-icon pi-times-circle":!e.submitted}]),style:{"font-size":"2rem"}},null,2),He,k(u(e.submitted?" Submitted":" Pending"),1)])]),filter:o(({filterModel:e})=>[l(y,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{field:"seated",header:"All Guests Seated?",key:"seated",filterField:"allAssigned",dataType:"boolean"},{body:o(({data:e})=>[d("span",null,[d("i",{class:j(["pi pi-check-circle",{"true-icon pi-check-circle":e.status===e.guests.length,"false-icon pi-times-circle":e.status!==e.guests.length}]),style:{"font-size":"2rem"}},null,2),Qe,k(" "+u(e.status)+" of "+u(e.guests.length)+" Guests Seated",1)])]),filter:o(({filterModel:e})=>[l(y,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{header:"Options"},{body:o(({data:e})=>[l(c,{icon:"pi pi-pencil",label:"Bulk Seat Registration",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:a=>t.editRegistrationTable(e)},null,8,["onClick"])]),_:1}),l(D,{visible:t.multiTableDialog,"onUpdate:visible":s[9]||(s[9]=e=>t.multiTableDialog=e),style:{width:"50rem",margin:"5rem"},header:"Table Details",modal:!0,class:"p-fluid registration-dialog"},{footer:o(()=>[l(c,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:s[7]||(s[7]=e=>t.multiTableDialog=!1)}),l(c,{label:"Confirm Table",icon:"pi pi-check",class:"p-button-text",onClick:s[8]||(s[8]=e=>t.multiSeat(t.registration.table))})]),default:o(()=>[d("div",at,[lt,l(b,{class:j({"p-invalid":t.v$.table.$error}),id:"table",modelValue:t.registration.table,"onUpdate:modelValue":s[6]||(s[6]=e=>t.registration.table=e),options:t.tables.filter(e=>e.tablecapacity>e.guests.length),name:"table",optionLabel:"tablename",optionValue:"_id",placeholder:"Select the table."},null,8,["class","modelValue","options"]),t.v$.table.$error?(i(),_("small",st,"Please select the table.")):Q("",!0)])]),_:1},8,["visible"])]),_:1},8,["value","expandedRows","filters","loading"]))]))])}var ot=$(Ge,[["render",nt],["__file","/Users/brysonbest/projects/premiers-awards-attendance/final/pa-app-dev/table-registration/src/components/RegistrationVisual.vue"]]);const it={__name:"AdminVisualTableView",setup(T){const s=pe(),g=r(!1),t=()=>g.value=!0,S=r(A.get("navItems")||[]),w=()=>String(J().getTablesCount),f=r(!1),x=()=>{f.value=!0},c=r(0),p=()=>c.value++;return s.login(),(m,L)=>{const b=v("PrimeButton");return i(),_("main",null,[l(me,{title:"Event Planning",subtitle:"Visually Organize PA Event"}),l(b,{label:"Table Count: ",type:"button",icon:"pi pi-ticket",class:"p-button-warning",badge:w(),onClick:L[0]||(L[0]=z=>x()),badgeClass:"p-badge-danger"},null,8,["badge"]),l(ge,{title:"",menuitems:S.value},null,8,["menuitems"]),(i(),P(Fe,{onLoadedTables:t,key:c.value})),g.value?(i(),P(ot,{key:0,onAddGuest:p,class:"registrations-visual-box"})):Q("",!0)])}}};var gt=$(it,[["__scopeId","data-v-30ebfe1e"],["__file","/Users/brysonbest/projects/premiers-awards-attendance/final/pa-app-dev/table-registration/src/views/AdminVisualTableView.vue"]]);export{gt as default};
