import{f as C}from"./settings.services.3d73a8a6.js";import{u as G,r as O}from"./index.esm.55d45502.js";import{_ as j,u as H,r as f,s as q,b as c,o as p,c as h,i as S,w as l,e as b,t as m,k as i,d as o,n as E,l as L,a as K,g as Q,j as Y,h as J,O as W,Q as X}from"./index.bd233f80.js";import{a as B}from"./guests.3cd50ea9.js";const Z={props:{tableID:String,adminView:Boolean,detailsView:Boolean},setup(v){const n=H(),u=B(),t=f(C.get("tabletypes")||[]),{table:D}=q(B()),k=G({tabletype:{required:O},tablecapacity:{required:O}},D);let _=f(!1),r=f(!1);const y=f({severity:null,text:""}),T=async function(w){if(w.preventDefault(),!!await this.v$.$validate())try{_.value=!0,u.registerTableHandler(this.table).then(()=>{this.$forceUpdate,_.value=!1,r.value=!0,y.value={severity:"success",text:"Table Updated!"}}).then(()=>{u.addTable})}catch(x){_.value=!1,console.warn(x),r.value=!0,y.value={severity:"error",text:"Table could not be updated."}}finally{setTimeout(()=>r.value=!1,1500)}};return async function(){const w=n.getUser;return u.$reset,v.tableID?await u.fillOnlyTable(v.tableID):v.adminView?await u.fillTables():await u.fillTable(w.guid)?u.fillTable(w.guid):[]}(),{loading:_,message:r,messageText:y,table:D,v$:k,tabletypes:t,onSubmit:T}}},M={class:"text-field"},$=i("label",{for:"tablename"},"Name of Table:",-1),ee={class:"dropdown"},te=i("label",{for:"tabletype"},"Type of Table:",-1),ae={key:0,class:"p-error",id:"tabletype-help"},le={class:"number-field"},oe=i("label",{for:"tablecapacity"},"Table Capacity:",-1),ne={key:0,class:"p-error",id:"tablecapacity-help"},se=b("Submit");function ie(v,n,u,t,D,P){const k=c("ProgressSpinner"),_=c("PrimeMessage"),r=c("InputText"),y=c("DropDown"),T=c("PrimeButton");return p(),h("div",null,[t.loading?(p(),S(k,{key:0})):t.message?(p(),S(_,{key:1,severity:t.messageText.severity,closable:!1},{default:l(()=>[b(m(t.messageText.text),1)]),_:1},8,["severity"])):(p(),h("form",{key:2,onSubmit:n[3]||(n[3]=(...d)=>t.onSubmit&&t.onSubmit(...d))},[i("div",M,[$,o(r,{id:"tablename",type:"tablename","aria-describedby":"tablename-help",modelValue:t.table.tablename,"onUpdate:modelValue":n[0]||(n[0]=d=>t.table.tablename=d),placeholder:"Enter Table Name (Leave Blank for Default Next Available Table)"},null,8,["modelValue"])]),i("div",ee,[te,o(y,{class:E({"p-invalid":t.v$.tabletype.$error}),id:"tabletype",modelValue:t.table.tabletype,"onUpdate:modelValue":n[1]||(n[1]=d=>t.table.tabletype=d),options:t.tabletypes,optionLabel:"text",optionValue:"value",placeholder:"Select the type of table."},null,8,["class","modelValue","options"]),t.v$.tabletype.$error?(p(),h("small",ae,"Please select the type of table.")):L("",!0)]),i("div",le,[oe,o(r,{class:E({"p-invalid":t.v$.tablecapacity.$error}),id:"tablecapacity",type:"tablecapacity","aria-describedby":"tablecapacity-help",modelValue:t.table.tablecapacity,"onUpdate:modelValue":n[2]||(n[2]=d=>t.table.tablecapacity=d),min:1,max:99,"aria-placeholder":"1-2 digit number",placeholder:"Required Table Capacity",useGrouping:!1},null,8,["class","modelValue"]),t.v$.tablecapacity.$error?(p(),h("small",ne,"Please enter the required table capacity.")):L("",!0)]),o(T,{type:"submit",label:"primary",class:"p-button-raised"},{default:l(()=>[se]),_:1})],32))])}var re=j(Z,[["render",ie],["__file","/Users/brysonbest/projects/premiers-awards-attendance/final/pa-app-dev/table-registration/src/components/inputs/InputTable.vue"]]);const de={props:{data:Array,detailsView:Boolean,tableID:String},setup(v){const n=K(),u=B(),{tables:t}=q(B()),D=f(C.get("tableSelection")||[]),P=f((C.get("organizations")||[]).map(s=>s.value)),k=f(0),_=f();let r=f(!1);const y=f({severity:null,text:""}),T=f(C.get("tableFilters")||{}),d=()=>{w()},w=()=>{T.value=C.get("tableFilters")||{}},g=f(!1),x=async function(){n.$reset,g.value=!0;try{return v.tableID?await u.fillTable(v.tableID):await u.fillTables()}catch(s){g.value=!1,console.warn(s),r.value=!0,y.value={severity:"error",text:"Could not fetch tables."}}finally{g.value=!1,setTimeout(()=>r.value=!1,1500)}},U=()=>{x().then(()=>{t.value.forEach(s=>{s.createdAt=new Date(s.createdAt),s.updatedAt=new Date(s.updatedAt),s.guestCount=Number(s.guests.length),s.tableStatus=s.guests.length<s.tablecapacity})})};Q(()=>{U()});const z=function(s,R){return C.lookup(s,R)},A=()=>{_.value.exportCSV()},I=s=>new Date(s).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),e=s=>new Date(s).toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),a=f({}),N=f(!1),F=f(!1);return{columns:D,organizations:P,table:a,tableDialog:N,deleteTableDialog:F,dataTableRender:k,filters:T,loading:g,message:r,messageText:y,dt:_,clearFilters:d,exportCSV:A,formatDate:I,formatTime:e,lookup:z,editTable:s=>{a.value={...s},N.value=!0},confirmDeleteTable:s=>{a.value=s,F.value=!0},deleteTable:async function(){g.value=!0;try{u.deleteTable(a.value._id).then(x()).then(()=>{g.value=!1,r.value=!0,y.value={severity:"success",text:"Successfully deleted table and reset all connected guests."}})}catch(s){g.value=!1,console.warn(s),r.value=!0,y.value={severity:"error",text:"Could not delete table."}}finally{F.value=!1,await new Promise(s=>setTimeout(s,1500)).then(()=>{r.value=!1,v.detailsView?J.push("/admin/tables"):x()})}},hideDialog:()=>{N.value=!1},loadLazyData:U,tables:t}},components:{InputTable:re}},V=v=>(W("data-v-98fdc8e8"),v=v(),X(),v),ue={key:2},ce={style:{"text-align":"left"}},be={class:"p-input-icon-left"},me=V(()=>i("i",{class:"pi pi-search"},null,-1)),pe=b(" No tables found. "),fe=b(" Loading table data. Please wait. "),ye={key:1},ve={key:0},_e={key:1},ge={class:"item"},he=V(()=>i("br",null,null,-1)),Te=V(()=>i("br",null,null,-1)),we=V(()=>i("br",null,null,-1)),Ve={class:"confirmation-content"},ke=V(()=>i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),xe={key:0},Se=b("Are you sure you want to delete table # "),De=b("?"),Ce=V(()=>i("br",null,null,-1)),Ue=b(" This will reset all associated guests."),Pe=V(()=>i("br",null,null,-1)),Ie=V(()=>i("b",null,"This action cannot be undone.",-1));function Le(v,n,u,t,D,P){const k=c("ProgressSpinner"),_=c("PrimeMessage"),r=c("PrimeButton"),y=c("InputText"),T=c("router-link"),d=c("PrimeColumn"),w=c("DropDown"),g=c("InputNumber"),x=c("TriStateCheckbox"),U=c("PrimeCalendar"),z=c("DataTable"),A=c("InputTable"),I=c("PrimeDialog");return p(),h("div",null,[t.loading?(p(),S(k,{key:0})):t.message?(p(),S(_,{key:1,severity:t.messageText.severity,closable:!1},{default:l(()=>[b(m(t.messageText.text),1)]),_:1},8,["severity"])):(p(),h("div",ue,[(p(),S(z,{class:"p-datatable-sm table-data-view",value:t.tables,responsiveLayout:"stack",key:t.dataTableRender,paginator:!u.detailsView,rows:10,ref:"dt",stripedRows:"",filters:t.filters,"onUpdate:filters":n[3]||(n[3]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["tablename","tabletype","tablecapacity","tableguestcount","tablefull","organizations"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},Y({empty:l(()=>[pe]),loading:l(()=>[fe]),default:l(()=>[o(d,{field:"tablename",header:"Table Name",key:"tablename",class:"tablename"},{body:l(({data:e})=>[u.detailsView?(p(),h("span",ye,m(e.tablename),1)):(p(),S(T,{key:0,to:`/admin/table/${e.guid}`},{default:l(()=>[b(m(e.tablename),1)]),_:2},1032,["to"]))]),filter:l(({filterModel:e})=>[o(y,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by Table Name"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(d,{field:"tabletype",header:"Type of Table",key:"tabletype",class:"tabletype"},{body:l(({data:e})=>[b(m(e.tabletype),1)]),filter:l(({filterModel:e})=>[o(w,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:["Standard","Reserved"],optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(p(),h("div",ve,[i("div",null,m(a.value),1)])):(p(),h("span",_e,m(a.placeholder),1))]),option:l(a=>[i("div",ge,[i("div",null,m(a.option),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),o(d,{field:"tablecapacity",header:"Table Capacity",key:"tablecapacity",class:"tablecapacity"},{body:l(({data:e})=>[b(m(e.tablecapacity),1)]),filter:l(({filterModel:e})=>[o(g,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,showButtons:"",buttonLayout:"horizontal",step:1,decrementButtonClass:"p-button-danger",incrementButtonClass:"p-button-success",incrementButtonIcon:"pi pi-plus",decrementButtonIcon:"pi pi-minus"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),u.detailsView?L("",!0):(p(),S(d,{field:"guestCount",header:"Number of Guests",key:"guestCount",class:"guestCount"},{body:l(({data:e})=>[b(m(e.guestCount||0),1)]),filter:l(({filterModel:e})=>[o(g,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,showButtons:"",buttonLayout:"horizontal",step:1,decrementButtonClass:"p-button-danger",incrementButtonClass:"p-button-success",incrementButtonIcon:"pi pi-plus",decrementButtonIcon:"pi pi-minus"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})),o(d,{field:"tableStatus",header:"Table Status",key:"guests",class:"tableStatus",datatype:"boolean"},{body:l(({data:e})=>[i("span",null,[i("i",{class:E(["pi",{"true-icon pi-plus-circle":e.tableStatus,"false-icon pi-ban":!e.tableStatus}]),style:{"font-size":"2rem"}},null,2),he,b(m(e.tableStatus?" Space Available":" Full"),1)])]),filter:l(({filterModel:e})=>[o(x,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(d,{field:"organizations",header:"Organizations",key:"organizations",class:"organizations"},{body:l(({data:e})=>[b(m([...new Set(e.organizations.map(a=>a=t.lookup("organizations",a.organization)))].join(`\r
`)),1)]),filter:l(({filterModel:e})=>[o(y,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by Organization"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(d,{field:"createdAt",header:"Created:",key:"createdAt",sortable:!0,dataType:"date"},{body:l(({data:e})=>[b(m(t.formatDate(e.createdAt))+",",1),Te,b(m(t.formatTime(e.createdAt)),1)]),filter:l(({filterModel:e})=>[o(U,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(d,{field:"updatedAt",header:"Updated:",key:"updatedAt",sortable:!0,dataType:"date"},{body:l(({data:e})=>[b(m(t.formatDate(e.updatedAt))+",",1),we,b(" "+m(t.formatTime(e.updatedAt)),1)]),filter:l(({filterModel:e})=>[o(U,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(d,{exportable:!1,style:{"min-width":"8rem"}},{body:l(e=>[o(r,{label:"Edit",icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:a=>t.editTable(e.data)},null,8,["onClick"]),o(r,{icon:"pi pi-trash",label:"Delete",class:"p-button-rounded p-button-warning delete-button",onClick:a=>t.confirmDeleteTable(e.data)},null,8,["onClick"])]),_:1})]),_:2},[u.detailsView?void 0:{name:"header",fn:l(()=>[i("div",ce,[o(r,{icon:"pi pi-external-link",label:"Export",onClick:n[0]||(n[0]=e=>t.exportCSV(e))}),o(r,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:n[1]||(n[1]=e=>t.clearFilters())}),i("span",be,[me,o(y,{modelValue:t.filters.global.value,"onUpdate:modelValue":n[2]||(n[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])])])}]),1032,["value","paginator","filters","loading"]))])),i("div",null,[o(I,{visible:t.tableDialog,"onUpdate:visible":n[4]||(n[4]=e=>t.tableDialog=e),style:{width:"450px"},header:"Table Details",modal:!0,class:"p-fluid",onHide:n[5]||(n[5]=()=>t.loadLazyData())},{default:l(()=>[o(A,{tableID:t.table.guid,detailsView:u.detailsView},null,8,["tableID","detailsView"])]),_:1},8,["visible"]),o(I,{visible:t.deleteTableDialog,"onUpdate:visible":n[7]||(n[7]=e=>t.deleteTableDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:l(()=>[o(r,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:n[6]||(n[6]=e=>t.deleteTableDialog=!1)}),o(r,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t.deleteTable},null,8,["onClick"])]),default:l(()=>[i("div",Ve,[ke,t.table?(p(),h("span",xe,[Se,i("b",null,m(t.table.tablename),1),De,Ce,Ue,Pe,Ie])):L("",!0)])]),_:1},8,["visible"])])])}var je=j(de,[["render",Le],["__scopeId","data-v-98fdc8e8"],["__file","/Users/brysonbest/projects/premiers-awards-attendance/final/pa-app-dev/table-registration/src/components/TableList.vue"]]);export{re as I,je as T};
