import{f as x}from"./settings.services.952672c3.js";import{u as ce,r as B}from"./index.esm.61dc1975.js";import{_ as me,f as ge,s as Z,r as g,u as ye,a as fe,g as ve,h as pe,b as h,o as r,c as m,i as C,w as i,e as y,t as d,d as s,k as n,l as p,j as F,n as I,F as M,m as $,O as be,Q as _e}from"./index.2f0c1db2.js";import{u as ee,a as te,t as he}from"./guests.c66f4470.js";const ke={props:{adminView:Boolean,registrationID:String,tableID:String},setup(D){const l=ee(),c=ge(),{guests:t}=Z(ee()),j=g(),H=g(x.get("guestSelection")||[]),E=g((x.get("organizations")||[]).map(o=>o.value)),K=g((x.get("attendancetypes")||[]).map(o=>o.value)),V=g((x.get("accessibilityoptions")||[]).map(o=>o.value)),S=g((x.get("dietaryoptions")||[]).map(o=>o.value)),U=g(x.get("organizations")||[]),f=g(x.get("attendancetypes")||[]),T=g(x.get("accessibilityoptions")||[]),Q=g(x.get("dietaryoptions")||[]),G=g(),N=ye(),A=g(),b=g(!1);let w=g(!1);const e=g({severity:null,text:""}),a=fe(),ae=te(),le=o=>{setTimeout(()=>{o.query.trim().length?G.value=U.value.filter(u=>u.text.toLowerCase().startsWith(o.query.toLowerCase())):G.value=U.value},100)},L=async function(){const o=N.getUser;l.$reset,b.value=!0;try{j.value=await(await he.getAllTables()).data,await new Promise(u=>setTimeout(u,1)).then(async()=>D.registrationID?await l.fillGuestsRegistration(D.registrationID):D.adminView?await l.fillGuests():D.tableID?await l.fillGuestsTable(D.tableID):await l.fillGuestsRegistration(o.guid)?l.fillGuestsRegistration(o.guid):[]).then(()=>{t.value.forEach(u=>{u.createdAt=new Date(u.createdAt),u.updatedAt=new Date(u.updatedAt),u.assignedTable=!!u.table,u.tabledetails=j.value.filter(_=>_._id===u.table)[0]})})}catch(u){b.value=!1,console.warn(u),w.value=!0,e.value={severity:"error",text:"Could not fetch registrations."}}finally{b.value=!1,setTimeout(()=>w.value=!1,1500)}},R=async function(){await L()};ve(()=>{R()});const oe=function(){return a.getRegistration.submitted},J=g(x.get("guestFilters")||{}),ie=()=>{ne()},ne=()=>{J.value=x.get("guestFilters")||{}},se=()=>{A.value.value.map(o=>{const u={organization:P("organizations",o.organization)||o.organization},_={dietary:W("dietaryoptions",o.dietary)},z={attendancetype:P("attendancetypes",o.attendancetype)},ue={accessibility:W("accessibilityoptions",o.accessibility)};o=Object.assign(o,u,z,_,ue)}),A.value.exportCSV(),R()},P=function(o,u){return x.lookup(o,u)},re=o=>new Date(o).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),de=o=>new Date(o).toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),W=function(o,u){let _="";for(let z of u)_&&_.length>0?_+=`\r
${P(o,z)}`:_=P(o,z);return _},v=g({}),X=ce({organization:{required:B},firstname:{required:B},lastname:{required:B},attendancetype:{required:B}},v),Y=g(!1),O=g(!1),q=g(!1);return{columns:H,settingsStore:c,v$:X,dt:A,filters:J,loading:b,message:w,messageText:e,isSubmitted:oe,exportCSV:se,clearFilters:ie,organizationsFilter:E,attendancetypesFilter:K,accessibilityFilter:V,dietaryFilter:S,organizations:U,attendancetypes:f,accessibility:T,dietary:Q,guests:t,guest:v,submitted:Y,guestDialog:O,deleteGuestDialog:q,formatDate:re,formatTime:de,lookup:P,lookupLoop:W,editGuest:o=>{v.value={...o},O.value=!0},confirmDeleteGuest:o=>{v.value=o,q.value=!0},deleteGuest:async function(){b.value=!0;try{l.deleteGuest(v.value._id,v.value.registration).then(L()).then(()=>{b.value=!1,w.value=!0,e.value={severity:"success",text:"Successfully deleted guest."}})}catch(o){console.log(o),b.value=!1,console.warn(o),w.value=!0,e.value={severity:"error",text:"Could not delete guest."}}finally{q.value=!1,await new Promise(o=>setTimeout(o,1500)).then(()=>{w.value=!1,L()})}},removeGuest:async function(o){b.value=!0,await ae.fillOnlyTable(D.tableID||o);const{table:u}=Z(te()),_=u.value;try{l.removeGuestFromTable(v.value._id,{table:null},_).then(L()).then(()=>{b.value=!1,w.value=!0,e.value={severity:"success",text:"Successfully removed guest."}})}catch(z){console.log(z),b.value=!1,console.warn(z),w.value=!0,e.value={severity:"error",text:"Could not delete guest."}}finally{q.value=!1,await new Promise(z=>setTimeout(z,1500)).then(()=>{w.value=!1,L()})}},hideDialog:()=>{O.value=!1,Y.value=!1},saveGuest:async function(o){o.preventDefault(),Y.value=!0,await X.value.$validate()&&(v.value.organization=typeof v.value.organization=="string"?v.value.organization:v.value.organization.value,l.updateGuest(v.value._id,v.value).then(()=>{O.value=!1,v.value={}}).then(L()).catch(_=>{console.log(_)}).finally(()=>{R()}))},loadLazyData:R,router:pe,userStore:N,filteredOrganizations:G,searchOrganization:le}}},k=D=>(be("data-v-8ef8228e"),D=D(),_e(),D),Ve={key:2},we={style:{"text-align":"left"},class:"header-buttons"},xe={key:0,class:"p-input-icon-left"},De=k(()=>n("i",{class:"pi pi-search"},null,-1)),Ce=y(" No guests found. "),Se=y(" Loading guest data. Please wait. "),ze={key:0},Te={key:1},Ue={class:"item"},Ge={key:0},Le={key:1},Fe={class:"item"},Ae={key:0},Pe={key:1},Ie={class:"item"},Ne={key:0},Re={key:1},Oe={class:"item"},qe=k(()=>n("br",null,null,-1)),Be={key:0},je={key:1},Ee=k(()=>n("br",null,null,-1)),Ke=k(()=>n("br",null,null,-1)),Qe={class:"options-buttons"},We={class:"dropdown"},Ye=k(()=>n("label",{for:"organization"},"Organization:",-1)),He={key:0,class:"p-error",id:"organization-help"},Je={class:"field-text"},Xe=k(()=>n("label",{for:"firstname"},"First Name",-1)),Ze={key:0,class:"p-error",id:"firstname-help"},Me={class:"field-text"},$e=k(()=>n("label",{for:"lastname"},"Last Name",-1)),et={key:0,class:"p-error",id:"lastname-help"},tt={class:"dropdown"},at=k(()=>n("label",{for:"attendancetype"},"Attendance Type:",-1)),lt={key:0,class:"p-error",id:"attendancetype-help"},ot=k(()=>n("label",{for:"accessibility"},"Accessibility Requirements:",-1)),it={class:"checkbox-group"},nt=["for"],st=k(()=>n("label",{for:"dietary"},"Dietary Requirements:",-1)),rt={class:"checkbox-group"},dt=["for"],ut={key:0,class:"field-text"},ct=k(()=>n("label",{for:"guest-notes"},"Notes:",-1)),mt=k(()=>n("small",{class:"p-error",id:"guest-notes-help"},"Notes field visible to admin only.",-1)),gt={class:"confirmation-content"},yt=k(()=>n("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),ft={key:0},vt=y("?");function pt(D,l,c,t,j,H){const E=h("ProgressSpinner"),K=h("PrimeMessage"),V=h("PrimeButton"),S=h("InputText"),U=h("router-link"),f=h("PrimeColumn"),T=h("DropDown"),Q=h("TriStateCheckbox"),G=h("PrimeCalendar"),N=h("DataTable"),A=h("AutoComplete"),b=h("CheckBox"),w=h("PrimeDialog");return r(),m("div",null,[t.loading?(r(),C(E,{key:0})):t.message?(r(),C(K,{key:1,severity:t.messageText.severity,closable:!1},{default:i(()=>[y(d(t.messageText.text),1)]),_:1},8,["severity"])):(r(),m("div",Ve,[s(N,{class:"p-datatable-sm guests-datatable",value:t.guests,exportFilename:c.registrationID?`${c.registrationID} Guest List`:"Guest List",responsiveLayout:"stack",paginator:c.adminView,rows:10,ref:"dt",stripedRows:"",filters:t.filters,"onUpdate:filters":l[3]||(l[3]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["firstname","lastname","attendancetype","accessibility","dietary","registration"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},{header:i(()=>[n("div",we,[s(V,{icon:"pi pi-external-link",label:"Export",onClick:l[0]||(l[0]=e=>t.exportCSV(e))}),s(V,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:l[1]||(l[1]=e=>t.clearFilters())}),c.adminView?(r(),m("span",xe,[De,s(S,{title:"Search all by keyword.",modelValue:t.filters.global.value,"onUpdate:modelValue":l[2]||(l[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])):p("",!0)])]),empty:i(()=>[Ce]),loading:i(()=>[Se]),default:i(()=>[t.userStore.getUser.role==="super-administrator"?(r(),C(f,{field:"registration",header:"Registration",key:"registration",class:"guid"},{body:i(({data:e})=>[s(U,{to:`/admin/edit/${e.registration}`,class:"registration-link"},{default:i(()=>[y(d(e.registration),1)]),_:2},1032,["to"])]),filter:i(({filterModel:e})=>[s(S,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by registration"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):p("",!0),s(f,{field:"organization",header:"Organization",key:"organization"},F({body:i(({data:e})=>[y(d(t.lookup("organizations",e.organization)||e.organization),1)]),_:2},[c.adminView?{name:"filter",fn:i(({filterModel:e})=>[s(T,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.organizationsFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:i(a=>[a.value?(r(),m("div",ze,[n("div",null,d(t.lookup("organizations",a.value)),1)])):(r(),m("span",Te,d(a.placeholder),1))]),option:i(a=>[n("div",Ue,[n("div",null,d(t.lookup("organizations",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])])}:void 0]),1024),s(f,{field:"firstname",header:"First Name",key:"firstname"},F({body:i(({data:e})=>[y(d(e.firstname),1)]),_:2},[c.adminView?{name:"filter",fn:i(({filterModel:e})=>[s(S,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by First Name"},null,8,["modelValue","onUpdate:modelValue"])])}:void 0]),1024),s(f,{field:"lastname",header:"Last Name",key:"lastname"},F({body:i(({data:e})=>[y(d(e.lastname),1)]),_:2},[c.adminView?{name:"filter",fn:i(({filterModel:e})=>[s(S,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by Last Name"},null,8,["modelValue","onUpdate:modelValue"])])}:void 0]),1024),s(f,{field:"attendancetype",header:"Attendance Type",key:"attendancetype"},F({body:i(({data:e})=>[y(d(t.lookup("attendancetypes",e.attendancetype)),1)]),_:2},[c.adminView?{name:"filter",fn:i(({filterModel:e})=>[s(T,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.attendancetypesFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:i(a=>[a.value?(r(),m("div",Ge,[n("div",null,d(t.lookup("attendancetypes",a.value)),1)])):(r(),m("span",Le,d(a.placeholder),1))]),option:i(a=>[n("div",Fe,[n("div",null,d(t.lookup("attendancetypes",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])])}:void 0]),1024),s(f,{field:"accessibility",header:"Accessibility Requirements",key:"accessibility"},F({body:i(({data:e})=>[y(d(t.lookupLoop("accessibilityoptions",e.accessibility)),1)]),_:2},[c.adminView?{name:"filter",fn:i(({filterModel:e})=>[s(T,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.accessibilityFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:i(a=>[a.value?(r(),m("div",Ae,[n("div",null,d(t.lookup("accessibilityoptions",a.value)),1)])):(r(),m("span",Pe,d(a.placeholder),1))]),option:i(a=>[n("div",Ie,[n("div",null,d(t.lookup("accessibilityoptions",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])])}:void 0]),1024),s(f,{field:"dietary",header:"Dietary Requirements",key:"dietary"},F({body:i(({data:e})=>[y(d(t.lookupLoop("dietaryoptions",e.dietary)),1)]),_:2},[c.adminView?{name:"filter",fn:i(({filterModel:e})=>[s(T,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.dietaryFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:i(a=>[a.value?(r(),m("div",Ne,[n("div",null,d(t.lookup("dietaryoptions",a.value)),1)])):(r(),m("span",Re,d(a.placeholder),1))]),option:i(a=>[n("div",Oe,[n("div",null,d(t.lookup("dietaryoptions",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])])}:void 0]),1024),c.adminView?(r(),C(f,{field:"notes",header:"Notes:",key:"notes"},{body:i(({data:e})=>[y(d(e.notes),1)]),_:1})):p("",!0),c.adminView?(r(),C(f,{field:"tabledetails.tablename",header:"Table",key:"tabledetails.tablename",dataType:"boolean",filterField:"assignedTable",sortable:""},{body:i(({data:e})=>[n("span",null,[n("i",{class:I({"true-icon":e.assignedTable,"false-icon pi pi-times-circle":!e.assignedTable}),style:{"font-size":"2rem"}},null,2),qe,e.assignedTable?(r(),m("div",Be,[s(U,{to:`/admin/table/${e.table}`},{default:i(()=>[y(d(e.tabledetails.tablename),1)]),_:2},1032,["to"])])):(r(),m("div",je,"Pending"))])]),filter:i(({filterModel:e})=>[s(Q,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):p("",!0),c.adminView?(r(),C(f,{field:"createdAt",header:"Created:",key:"createdAt",sortable:!0,dataType:"date"},{body:i(({data:e})=>[y(d(t.formatDate(e.createdAt))+",",1),Ee,y(d(t.formatTime(e.createdAt)),1)]),filter:i(({filterModel:e})=>[s(G,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):p("",!0),c.adminView?(r(),C(f,{field:"updatedAt",header:"Updated:",key:"updatedAt",sortable:!0,dataType:"date"},{body:i(({data:e})=>[y(d(t.formatDate(e.updatedAt))+",",1),Ke,y(" "+d(t.formatTime(e.updatedAt)),1)]),filter:i(({filterModel:e})=>[s(G,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):p("",!0),!t.isSubmitted()&&t.settingsStore.getIsSalesOpen||c.adminView||c.tableID?(r(),C(f,{key:5,exportable:!1,style:{"min-width":"8rem"},header:"Options:"},{body:i(e=>[n("div",Qe,[s(V,{icon:"pi pi-pencil",label:"Edit",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:a=>t.editGuest(e.data)},null,8,["onClick"]),s(V,{icon:"pi pi-trash",label:e.data.table||c.tableID?"Remove from Table":"Delete",class:"p-button-rounded p-button-warning delete-button",onClick:a=>t.confirmDeleteGuest(e.data)},null,8,["label","onClick"]),c.adminView&&!c.registrationID?(r(),C(V,{key:0,icon:"pi pi-arrow-up-right",label:"View",class:"p-button-rounded p-button-info info-button",onClick:a=>t.router.push(`/admin/edit/${e.data.registration}`)},null,8,["onClick"])):p("",!0)])]),_:1})):p("",!0)]),_:1},8,["value","exportFilename","paginator","filters","loading"])])),n("div",null,[s(w,{visible:t.guestDialog,"onUpdate:visible":l[12]||(l[12]=e=>t.guestDialog=e),style:{width:"50rem",margin:"5rem"},header:"Guest Details",modal:!0,class:"p-fluid",onShow:l[13]||(l[13]=()=>t.guest.organization=t.lookup("organizations",t.guest.organization))},{footer:i(()=>[s(V,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:t.hideDialog},null,8,["onClick"]),s(V,{label:"Save",icon:"pi pi-check",class:"p-button-text",onClick:t.saveGuest},null,8,["onClick"])]),default:i(()=>[n("div",We,[Ye,s(A,{class:I({"p-invalid":t.v$.organization.$error}),modelValue:t.guest.organization,"onUpdate:modelValue":l[4]||(l[4]=e=>t.guest.organization=e),dropdown:!0,suggestions:t.filteredOrganizations,onComplete:l[5]||(l[5]=e=>t.searchOrganization(e)),placeholder:"Select an organization or enter manually",optionLabel:"text",field:"text"},{option:i(e=>[n("div",null,d(e.option.text),1)]),_:1},8,["class","modelValue","suggestions"]),t.v$.organization.$error?(r(),m("small",He,"Please select your organization.")):p("",!0)]),n("div",Je,[Xe,s(S,{class:I({"p-invalid":t.v$.firstname.$error}),id:"firstname",modelValue:t.guest.firstname,"onUpdate:modelValue":l[6]||(l[6]=e=>t.guest.firstname=e),modelModifiers:{trim:!0},required:"true",name:"firstname",title:"First Name",autofocus:""},null,8,["class","modelValue"]),t.v$.firstname.$error?(r(),m("small",Ze,"Please enter guest's first name.")):p("",!0)]),n("div",Me,[$e,s(S,{class:I({"p-invalid":t.v$.lastname.$error}),id:"lastname",modelValue:t.guest.lastname,"onUpdate:modelValue":l[7]||(l[7]=e=>t.guest.lastname=e),modelModifiers:{trim:!0},required:"true",name:"lastname",title:"Last Name",autofocus:""},null,8,["class","modelValue"]),t.v$.lastname.$error?(r(),m("small",et,"Please enter guest's last name.")):p("",!0)]),n("div",tt,[at,s(T,{class:I({"p-invalid":t.v$.attendancetype.$error}),id:"attendancetype",modelValue:t.guest.attendancetype,"onUpdate:modelValue":l[8]||(l[8]=e=>t.guest.attendancetype=e),options:t.attendancetypes,optionLabel:"text",optionValue:"value",name:"attendancetype",title:"Attendance Type",placeholder:"Select the type of attendance for this guest"},null,8,["class","modelValue","options"]),t.v$.attendancetype.$error?(r(),m("small",lt,"Please select the attendance type for this guest.")):p("",!0)]),ot,n("div",it,[(r(!0),m(M,null,$(t.accessibility,e=>(r(),m("div",{key:e.key,name:"accessibility",class:"field-checkbox"},[s(b,{id:e.key,name:"accessibility",value:e.value,modelValue:t.guest.accessibility,"onUpdate:modelValue":l[9]||(l[9]=a=>t.guest.accessibility=a)},null,8,["id","value","modelValue"]),n("label",{for:e.key},d(e.text),9,nt)]))),128))]),st,n("div",rt,[(r(!0),m(M,null,$(t.dietary,e=>(r(),m("div",{key:e.key,class:"field-checkbox",name:"dietary"},[s(b,{id:e.key,name:"dietary",value:e.value,modelValue:t.guest.dietary,"onUpdate:modelValue":l[10]||(l[10]=a=>t.guest.dietary=a)},null,8,["id","value","modelValue"]),n("label",{for:e.key},d(e.text),9,dt)]))),128))]),c.adminView?(r(),m("div",ut,[ct,s(S,{id:"lastname",modelValue:t.guest.notes,"onUpdate:modelValue":l[11]||(l[11]=e=>t.guest.notes=e),modelModifiers:{trim:!0},name:"guestnotes",title:"Notes",autofocus:""},null,8,["modelValue"]),mt])):p("",!0)]),_:1},8,["visible"]),s(w,{visible:t.deleteGuestDialog,"onUpdate:visible":l[16]||(l[16]=e=>t.deleteGuestDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:i(()=>[s(V,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:l[14]||(l[14]=e=>t.deleteGuestDialog=!1)}),!c.tableID&&!t.guest.table?(r(),C(V,{key:0,label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t.deleteGuest},null,8,["onClick"])):(r(),C(V,{key:1,icon:"pi pi-trash",label:"Remove from Table",class:"p-button-rounded p-button-warning delete-button",onClick:l[15]||(l[15]=e=>t.removeGuest(t.guest.table))}))]),default:i(()=>[n("div",gt,[yt,t.guest?(r(),m("span",ft,[y("Are you sure you want to "+d(!c.tableID&&!t.guest.table?"delete":"remove")+" ",1),n("b",null,d(t.guest.firstname)+" "+d(t.guest.lastname),1),vt])):p("",!0)])]),_:1},8,["visible"])])])}var Tt=me(ke,[["render",pt],["__scopeId","data-v-8ef8228e"]]);export{Tt as G};
