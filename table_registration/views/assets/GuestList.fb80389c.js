import{J as le,K as T,a as O,_ as se,s as ne,r as g,f as v,u as re,g as de,h as ue,b,o as r,c as m,i as S,w as l,e as p,t as d,d as n,k as s,l as f,n as B,F as W,m as X,L as ce,M as me}from"./index.27555801.js";import{u as ge,r as q}from"./index.esm.b1da9b0d.js";const Z=le({id:"guestsStore",state:()=>({guest:{registration:"",firstname:"",lastname:"",attendancetype:"",organization:"",accessibility:[],dietary:[],notes:""},guests:[]}),getters:{getGuestsCount(){return this.guests.length}},actions:{async fillGuestsRegistration(u){const o=await(await T.getGuestsByRegistration(u)).data[0];this.guests=o.guests||[]},async fillGuests(){this.guests=await(await T.getAllGuests()).data},async addRegistrationData(){console.log("registrationdata add");const u=O();this.guest.registration=await u.getId},async addGuestList(){const{registration:u="",guid:o="",firstname:c="",lastname:t="",attendancetype:P="",organization:R="",accessibility:L=[],dietary:F=[]}=this.guest||{};await this.guests.push({registration:u,guid:o,firstname:c,lastname:t,attendancetype:P,organization:R,accessibility:L,dietary:F})},async updateGuest(u,o){await T.updateGuest(u,o)},async deleteGuest(u,o){const c=O();await T.deleteGuest(u).then(()=>{c.registerFinancialInformation({$pull:{guests:u}},o)})},async registerGuest(u){const o=O(),c=await T.createGuest(u),t=c.data._id;return await o.registerFinancialInformation({$push:{guests:t}}),this.guest.guid=c.data.guid,this.guest},async registerAllGuests(){for(let u of this.guests)this.registerGuest(u)}}});const pe={props:{adminView:Boolean,registrationID:String},setup(u){const o=Z(),{guests:c}=ne(Z()),t=g(v.get("guestSelection")||[]),P=g((v.get("organizations")||[]).map(i=>i.value)),R=g((v.get("attendancetypes")||[]).map(i=>i.value)),L=g((v.get("accessibilityoptions")||[]).map(i=>i.value)),F=g((v.get("dietaryoptions")||[]).map(i=>i.value)),_=g(v.get("organizations")||[]),V=g(v.get("attendancetypes")||[]),E=g(v.get("accessibilityoptions")||[]),y=g(v.get("dietaryoptions")||[]),w=re(),U=g(),x=g(!1);let D=g(!1);const z=g({severity:null,text:""}),e=O(),a=async function(){const i=w.getUser;o.$reset,x.value=!0;try{return u.adminView?await o.fillGuests():u.registrationID?await o.fillGuestsRegistration(u.registrationID):await o.fillGuestsRegistration(i.guid)?o.fillGuestsRegistration(i.guid):[]}catch(k){x.value=!1,console.warn(k),D.value=!0,z.value={severity:"error",text:"Could not fetch registrations."}}finally{x.value=!1,setTimeout(()=>D.value=!1,1500)}},j=()=>{a().then(()=>{c.value.forEach(i=>{i.createdAt=new Date(i.createdAt),i.updatedAt=new Date(i.updatedAt)})})};de(()=>{j()});const M=function(){return e.getRegistration.submitted},H=g(v.get("guestFilters")||{}),$=()=>{ee()},ee=()=>{H.value=v.get("guestFilters")||{}},te=()=>{U.value.value.map(i=>{const k={organization:A("organizations",i.organization)},C={dietary:K("dietaryoptions",i.dietary)},I={attendancetype:A("attendancetypes",i.attendancetype)},ie={accessibility:K("accessibilityoptions",i.accessibility)};i=Object.assign(i,k,I,C,ie)}),U.value.exportCSV()},A=function(i,k){return v.lookup(i,k)},ae=i=>new Date(i).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),oe=i=>new Date(i).toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),K=function(i,k){let C="";for(let I of k)C&&C.length>0?C+=`\r
${A(i,I)}`:C=A(i,I);return C},G=g({}),Q=ge({organization:{required:q},firstname:{required:q},lastname:{required:q},attendancetype:{required:q}},G),J=g(!1),N=g(!1),Y=g(!1);return{columns:t,v$:Q,dt:U,filters:H,loading:x,message:D,messageText:z,isSubmitted:M,exportCSV:te,clearFilters:$,organizationsFilter:P,attendancetypesFilter:R,accessibilityFilter:L,dietaryFilter:F,organizations:_,attendancetypes:V,accessibility:E,dietary:y,guests:c,guest:G,submitted:J,guestDialog:N,deleteGuestDialog:Y,formatDate:ae,formatTime:oe,lookup:A,lookupLoop:K,editGuest:i=>{G.value={...i},N.value=!0},confirmDeleteGuest:i=>{G.value=i,Y.value=!0},deleteGuest:async function(){x.value=!0;try{o.deleteGuest(G.value._id,G.value.registration).then(a()).then(()=>{x.value=!1,D.value=!0,z.value={severity:"success",text:"Successfully deleted guest."}})}catch(i){console.log(i),x.value=!1,console.warn(i),D.value=!0,z.value={severity:"error",text:"Could not delete guest."}}finally{Y.value=!1,await new Promise(i=>setTimeout(i,1500)).then(()=>{D.value=!1,a()})}},hideDialog:()=>{N.value=!1,J.value=!1},saveGuest:async function(i){i.preventDefault(),J.value=!0,await Q.value.$validate()&&o.updateGuest(G.value._id,G.value).then(()=>{N.value=!1,G.value={}}).then(a()).catch(C=>{console.log(C)}).finally(()=>{j()})},loadLazyData:j,router:ue,userStore:w}}},h=u=>(ce("data-v-7aa88ce3"),u=u(),me(),u),ye={key:2},fe={style:{"text-align":"left"},class:"header-buttons"},ve={key:0,class:"p-input-icon-left"},_e=h(()=>s("i",{class:"pi pi-search"},null,-1)),be=p(" No guests found. "),he=p(" Loading guest data. Please wait. "),ke={key:0},Ve={key:1},we={class:"item"},xe={key:0},De={key:1},Ge={class:"item"},Ce={key:0},Se={key:1},ze={class:"item"},Ue={key:0},Le={key:1},Fe={class:"item"},Ae=h(()=>s("br",null,null,-1)),Te=h(()=>s("br",null,null,-1)),Pe={class:"options-buttons"},Re={class:"dropdown"},Ne=h(()=>s("label",{for:"organization"},"Organization:",-1)),Ie={key:0,class:"p-error",id:"organization-help"},Be={class:"field-text"},qe=h(()=>s("label",{for:"firstname"},"First Name",-1)),Oe={key:0,class:"p-error",id:"firstname-help"},Ee={class:"field-text"},je=h(()=>s("label",{for:"lastname"},"Last Name",-1)),Ke={key:0,class:"p-error",id:"lastname-help"},Je={class:"dropdown"},Ye=h(()=>s("label",{for:"attendancetype"},"Attendance Type:",-1)),He={key:0,class:"p-error",id:"attendancetype-help"},Qe=h(()=>s("label",{for:"accessibility"},"Accessibility Requirements:",-1)),We={class:"checkbox-group"},Xe=["for"],Ze=h(()=>s("label",{for:"dietary"},"Dietary Requirements:",-1)),Me={class:"checkbox-group"},$e=["for"],et={key:0,class:"field-text"},tt=h(()=>s("label",{for:"guest-notes"},"Notes:",-1)),at={class:"confirmation-content"},ot=h(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),it={key:0},lt=p("Are you sure you want to delete "),st=p("?");function nt(u,o,c,t,P,R){const L=b("ProgressSpinner"),F=b("PrimeMessage"),_=b("PrimeButton"),V=b("InputText"),E=b("router-link"),y=b("PrimeColumn"),w=b("DropDown"),U=b("PrimeCalendar"),x=b("DataTable"),D=b("CheckBox"),z=b("PrimeDialog");return r(),m("div",null,[t.loading?(r(),S(L,{key:0})):t.message?(r(),S(F,{key:1,severity:t.messageText.severity,closable:!1},{default:l(()=>[p(d(t.messageText.text),1)]),_:1},8,["severity"])):(r(),m("div",ye,[n(x,{class:"p-datatable-sm guests-datatable",value:t.guests,exportFilename:c.registrationID?`${c.registrationID} Guest List`:"Guest List",responsiveLayout:"stack",paginator:c.adminView,rows:10,ref:"dt",stripedRows:"",filters:t.filters,"onUpdate:filters":o[3]||(o[3]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["firstname","lastname","attendancetype","accessibility","dietary","registration"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},{header:l(()=>[s("div",fe,[n(_,{icon:"pi pi-external-link",label:"Export",onClick:o[0]||(o[0]=e=>t.exportCSV(e))}),n(_,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:o[1]||(o[1]=e=>t.clearFilters())}),c.adminView?(r(),m("span",ve,[_e,n(V,{title:"Search all by keyword.",modelValue:t.filters.global.value,"onUpdate:modelValue":o[2]||(o[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])):f("",!0)])]),empty:l(()=>[be]),loading:l(()=>[he]),default:l(()=>[t.userStore.getUser.role==="super-administrator"?(r(),S(y,{field:"registration",header:"Registration",key:"registration",class:"guid"},{body:l(({data:e})=>[n(E,{to:`/admin/edit/${e.registration}`,class:"registration-link"},{default:l(()=>[p(d(e.registration),1)]),_:2},1032,["to"])]),filter:l(({filterModel:e})=>[n(V,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by registration"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):f("",!0),n(y,{field:"organization",header:"Organization",key:"organization"},{body:l(({data:e})=>[p(d(t.lookup("organizations",e.organization)),1)]),filter:l(({filterModel:e})=>[n(w,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.organizationsFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(r(),m("div",ke,[s("div",null,d(t.lookup("organizations",a.value)),1)])):(r(),m("span",Ve,d(a.placeholder),1))]),option:l(a=>[s("div",we,[s("div",null,d(t.lookup("organizations",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),n(y,{field:"firstname",header:"First Name",key:"firstname"},{body:l(({data:e})=>[p(d(e.firstname),1)]),filter:l(({filterModel:e})=>[n(V,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by First Name"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(y,{field:"lastname",header:"Last Name",key:"lastname"},{body:l(({data:e})=>[p(d(e.lastname),1)]),filter:l(({filterModel:e})=>[n(V,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"p-column-filter",placeholder:"Search by Last Name"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(y,{field:"attendancetype",header:"Attendance Type",key:"attendancetype"},{body:l(({data:e})=>[p(d(t.lookup("attendancetypes",e.attendancetype)),1)]),filter:l(({filterModel:e})=>[n(w,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.attendancetypesFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(r(),m("div",xe,[s("div",null,d(t.lookup("attendancetypes",a.value)),1)])):(r(),m("span",De,d(a.placeholder),1))]),option:l(a=>[s("div",Ge,[s("div",null,d(t.lookup("attendancetypes",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),n(y,{field:"accessibility",header:"Accessibility Requirements",key:"accessibility"},{body:l(({data:e})=>[p(d(t.lookupLoop("accessibilityoptions",e.accessibility)),1)]),filter:l(({filterModel:e})=>[n(w,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.accessibilityFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(r(),m("div",Ce,[s("div",null,d(t.lookup("accessibilityoptions",a.value)),1)])):(r(),m("span",Se,d(a.placeholder),1))]),option:l(a=>[s("div",ze,[s("div",null,d(t.lookup("accessibilityoptions",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),n(y,{field:"dietary",header:"Dietary Requirements",key:"dietary"},{body:l(({data:e})=>[p(d(t.lookupLoop("dietaryoptions",e.dietary)),1)]),filter:l(({filterModel:e})=>[n(w,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:t.dietaryFilter,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:l(a=>[a.value?(r(),m("div",Ue,[s("div",null,d(t.lookup("dietaryoptions",a.value)),1)])):(r(),m("span",Le,d(a.placeholder),1))]),option:l(a=>[s("div",Fe,[s("div",null,d(t.lookup("dietaryoptions",a.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:1}),c.adminView?(r(),S(y,{field:"notes",header:"Notes:",key:"notes"},{body:l(({data:e})=>[p(d(e.notes),1)]),_:1})):f("",!0),c.adminView?(r(),S(y,{field:"createdAt",header:"Created:",key:"createdAt",sortable:!0,dataType:"date"},{body:l(({data:e})=>[p(d(t.formatDate(e.createdAt))+",",1),Ae,p(d(t.formatTime(e.createdAt)),1)]),filter:l(({filterModel:e})=>[n(U,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):f("",!0),c.adminView?(r(),S(y,{field:"updatedAt",header:"Updated:",key:"updatedAt",sortable:!0,dataType:"date"},{body:l(({data:e})=>[p(d(t.formatDate(e.updatedAt))+",",1),Te,p(" "+d(t.formatTime(e.updatedAt)),1)]),filter:l(({filterModel:e})=>[n(U,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):f("",!0),!t.isSubmitted()||c.adminView?(r(),S(y,{key:4,exportable:!1,style:{"min-width":"8rem"},header:"Options:"},{body:l(e=>[s("div",Pe,[n(_,{icon:"pi pi-pencil",label:"Edit",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:a=>t.editGuest(e.data)},null,8,["onClick"]),n(_,{icon:"pi pi-trash",label:"Delete",class:"p-button-rounded p-button-warning delete-button",onClick:a=>t.confirmDeleteGuest(e.data)},null,8,["onClick"]),c.adminView&&!c.registrationID?(r(),S(_,{key:0,icon:"pi pi-arrow-up-right",label:"View",class:"p-button-rounded p-button-info info-button",onClick:a=>t.router.push(`/admin/edit/${e.data.registration}`)},null,8,["onClick"])):f("",!0)])]),_:1})):f("",!0)]),_:1},8,["value","exportFilename","paginator","filters","loading"])])),s("div",null,[n(z,{visible:t.guestDialog,"onUpdate:visible":o[11]||(o[11]=e=>t.guestDialog=e),style:{width:"50rem",margin:"5rem"},header:"Guest Details",modal:!0,class:"p-fluid"},{footer:l(()=>[n(_,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:t.hideDialog},null,8,["onClick"]),n(_,{label:"Save",icon:"pi pi-check",class:"p-button-text",onClick:t.saveGuest},null,8,["onClick"])]),default:l(()=>[s("div",Re,[Ne,n(w,{class:B({"p-invalid":t.v$.organization.$error}),id:"organization",modelValue:t.guest.organization,"onUpdate:modelValue":o[4]||(o[4]=e=>t.guest.organization=e),options:t.organizations,optionLabel:"text",optionValue:"value",name:"organization",title:"Organization",placeholder:"Select an Organization"},null,8,["class","modelValue","options"]),t.v$.organization.$error?(r(),m("small",Ie,"Please select your organization.")):f("",!0)]),s("div",Be,[qe,n(V,{class:B({"p-invalid":t.v$.firstname.$error}),id:"firstname",modelValue:t.guest.firstname,"onUpdate:modelValue":o[5]||(o[5]=e=>t.guest.firstname=e),modelModifiers:{trim:!0},required:"true",name:"firstname",title:"First Name",autofocus:""},null,8,["class","modelValue"]),t.v$.firstname.$error?(r(),m("small",Oe,"Please enter guest's first name.")):f("",!0)]),s("div",Ee,[je,n(V,{class:B({"p-invalid":t.v$.lastname.$error}),id:"lastname",modelValue:t.guest.lastname,"onUpdate:modelValue":o[6]||(o[6]=e=>t.guest.lastname=e),modelModifiers:{trim:!0},required:"true",name:"lastname",title:"Last Name",autofocus:""},null,8,["class","modelValue"]),t.v$.lastname.$error?(r(),m("small",Ke,"Please enter guest's last name.")):f("",!0)]),s("div",Je,[Ye,n(w,{class:B({"p-invalid":t.v$.attendancetype.$error}),id:"attendancetype",modelValue:t.guest.attendancetype,"onUpdate:modelValue":o[7]||(o[7]=e=>t.guest.attendancetype=e),options:t.attendancetypes,optionLabel:"text",optionValue:"value",name:"attendancetype",title:"Attendance Type",placeholder:"Select the type of attendance for this guest"},null,8,["class","modelValue","options"]),t.v$.attendancetype.$error?(r(),m("small",He,"Please select the attendance type for this guest.")):f("",!0)]),Qe,s("div",We,[(r(!0),m(W,null,X(t.accessibility,e=>(r(),m("div",{key:e.key,name:"accessibility",class:"field-checkbox"},[n(D,{id:e.key,name:"accessibility",value:e.value,modelValue:t.guest.accessibility,"onUpdate:modelValue":o[8]||(o[8]=a=>t.guest.accessibility=a)},null,8,["id","value","modelValue"]),s("label",{for:e.key},d(e.text),9,Xe)]))),128))]),Ze,s("div",Me,[(r(!0),m(W,null,X(t.dietary,e=>(r(),m("div",{key:e.key,class:"field-checkbox",name:"dietary"},[n(D,{id:e.key,name:"dietary",value:e.value,modelValue:t.guest.dietary,"onUpdate:modelValue":o[9]||(o[9]=a=>t.guest.dietary=a)},null,8,["id","value","modelValue"]),s("label",{for:e.key},d(e.text),9,$e)]))),128))]),c.adminView?(r(),m("div",et,[tt,n(V,{id:"lastname",modelValue:t.guest.notes,"onUpdate:modelValue":o[10]||(o[10]=e=>t.guest.notes=e),modelModifiers:{trim:!0},name:"guestnotes",title:"Notes",autofocus:""},null,8,["modelValue"])])):f("",!0)]),_:1},8,["visible"]),n(z,{visible:t.deleteGuestDialog,"onUpdate:visible":o[13]||(o[13]=e=>t.deleteGuestDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:l(()=>[n(_,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o[12]||(o[12]=e=>t.deleteGuestDialog=!1)}),n(_,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t.deleteGuest},null,8,["onClick"])]),default:l(()=>[s("div",at,[ot,t.guest?(r(),m("span",it,[lt,s("b",null,d(t.guest.firstname)+" "+d(t.guest.lastname),1),st])):f("",!0)])]),_:1},8,["visible"])])])}var ft=se(pe,[["render",nt],["__scopeId","data-v-7aa88ce3"]]);export{ft as G,Z as u};
