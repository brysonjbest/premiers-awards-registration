import{u as B,G as O}from"./GuestList.519a6de8.js";import{R as E}from"./RegistrationList.756802d5.js";import{_ as H,a as A,s as T,r as m,b as c,o as n,c as r,i as h,w as f,e as l,t as p,k as i,d as a,n as R,l as b,F as N,m as F,f as P,I as q,u as W,P as Y}from"./index.6a100bc4.js";import{u as J,r as V}from"./index.esm.75f81e13.js";import"./InputFinancial.1a42017f.js";const K={props:{registrationID:String},setup(k){const t=B(),y=A(),{guest:e}=T(B()),_={organization:{required:V},firstname:{required:V},lastname:{required:V},attendancetype:{required:V}},x=J(_,e),v=m(P.get("organizations")||[]),u=m(P.get("attendancetypes")||[]),S=m(P.get("accessibilityoptions")||[]),C=m(P.get("dietaryoptions")||[]);k.registrationID&&y.fill(k.registrationID);let d=m(!1),g=m(!1);const s=m({severity:null,text:""});return{loading:d,message:g,messageText:s,guest:e,guestData:t,v$:x,organizations:v,dietary:C,accessibility:S,attendancetypes:u,rules:_,onSubmit:async function(o){if(o.preventDefault(),!!await this.v$.$validate()){this.guest.registration=y.getId;try{d.value=!0,t.registerGuest(this.guest).then(w=>t.addGuestList(w)).then(()=>{delete this.guest.guid,this.guest.organization="",this.guest.firstname="",this.guest.lastname="",this.guest.attendancetype="",this.guest.dietary=[],this.guest.accessibility=[],this.$forceUpdate,this.v$.$reset(),d.value=!1,g.value=!0,s.value={severity:"success",text:"Guest Updated!"}})}catch(w){d.value=!1,console.warn(w),g.value=!0,s.value={severity:"error",text:"Guest could not be updated."}}finally{setTimeout(()=>g.value=!1,1500)}}},onReset:function(o){o.preventDefault(),delete this.guest.guid,this.guest.organization="",this.guest.firstname="",this.guest.lastname="",this.guest.attendancetype="",this.guest.dietary=[],this.guest.accessibility=[]}}}},Q={class:"guest-registration-selections"},X={class:"dropdown"},Z=i("label",{for:"organization"},"Organization:",-1),$={key:0,class:"p-error",id:"organization-help"},ee={class:"text-field"},te=i("label",{for:"firstname"},"First Name:",-1),se={key:0,class:"p-error",id:"firstname-help"},ie={class:"text-field"},ne=i("label",{for:"lastname"},"Last Name:",-1),oe={key:0,class:"p-error",id:"lastname-help"},ae={class:"dropdown"},re=i("label",{for:"attendancetype"},"Attendance Type:",-1),le={key:0,class:"p-error",id:"attendancetype-help"},de=i("label",{for:"accessibility"},"Accessibility Requirements:",-1),ue={class:"checkbox-group"},ge=["for"],ce=i("label",{for:"dietary"},"Dietary Requirements:",-1),me={class:"checkbox-group"},be=["for"],fe=l("Add Guest"),pe=l("Reset");function ye(k,t,y,e,_,x){const v=c("ProgressSpinner"),u=c("PrimeMessage"),S=c("DropDown"),C=c("InputText"),d=c("CheckBox"),g=c("PrimeButton");return n(),r("div",null,[e.loading?(n(),h(v,{key:0})):e.message?(n(),h(u,{key:1,severity:e.messageText.severity,closable:!1},{default:f(()=>[l(p(e.messageText.text),1)]),_:1},8,["severity"])):(n(),r("form",{key:2,class:"guest-registration-form",onSubmit:t[6]||(t[6]=(...s)=>e.onSubmit&&e.onSubmit(...s)),onReset:t[7]||(t[7]=(...s)=>e.onReset&&e.onReset(...s))},[i("div",Q,[i("div",X,[Z,a(S,{class:R({"p-invalid":e.v$.organization.$error}),id:"organization",modelValue:e.guest.organization,"onUpdate:modelValue":t[0]||(t[0]=s=>e.guest.organization=s),options:e.organizations,optionLabel:"text",optionValue:"value",placeholder:"Select an Organization"},null,8,["class","modelValue","options"]),e.v$.organization.$error?(n(),r("small",$,"Please select your organization.")):b("",!0)]),i("div",ee,[te,a(C,{class:R({"p-invalid":e.v$.firstname.$error}),id:"firstname",type:"firstname","aria-describedby":"firstname-help",modelValue:e.guest.firstname,"onUpdate:modelValue":t[1]||(t[1]=s=>e.guest.firstname=s),placeholder:"First Name"},null,8,["class","modelValue"]),e.v$.firstname.$error?(n(),r("small",se,"Please enter guest's first name.")):b("",!0)]),i("div",ie,[ne,a(C,{class:R({"p-invalid":e.v$.lastname.$error}),id:"lastname",type:"lastname","aria-describedby":"lastname-help",modelValue:e.guest.lastname,"onUpdate:modelValue":t[2]||(t[2]=s=>e.guest.lastname=s),placeholder:"Last Name"},null,8,["class","modelValue"]),e.v$.lastname.$error?(n(),r("small",oe,"Please enter guest's last name.")):b("",!0)]),i("div",ae,[re,a(S,{class:R({"p-invalid":e.v$.attendancetype.$error}),id:"attendancetype",modelValue:e.guest.attendancetype,"onUpdate:modelValue":t[3]||(t[3]=s=>e.guest.attendancetype=s),options:e.attendancetypes,optionLabel:"text",optionValue:"value",placeholder:"Select the type of attendance for this guest"},null,8,["class","modelValue","options"]),e.v$.attendancetype.$error?(n(),r("small",le,"Please select the attendance type for this guest.")):b("",!0)]),de,i("div",ue,[(n(!0),r(N,null,F(e.accessibility,s=>(n(),r("div",{key:s.key,class:"field-checkbox"},[a(d,{id:s.key,name:"each",value:s.value,modelValue:e.guest.accessibility,"onUpdate:modelValue":t[4]||(t[4]=D=>e.guest.accessibility=D)},null,8,["id","value","modelValue"]),i("label",{for:s.key},p(s.text),9,ge)]))),128))]),ce,i("div",me,[(n(!0),r(N,null,F(e.dietary,s=>(n(),r("div",{key:s.key,class:"field-checkbox"},[a(d,{id:s.key,name:"each",value:s.value,modelValue:e.guest.dietary,"onUpdate:modelValue":t[5]||(t[5]=D=>e.guest.dietary=D)},null,8,["id","value","modelValue"]),i("label",{for:s.key},p(s.text),9,be)]))),128))])]),a(g,{type:"submit",label:"primary",class:"p-button-raised"},{default:f(()=>[fe]),_:1}),a(g,{type:"reset",label:"danger",class:"p-button-raised p-button-danger"},{default:f(()=>[pe]),_:1})],32))])}var _e=H(K,[["render",ye]]);const ve={props:{id:String},setup(k){const t=q(),{message:y}=T(q()),{registration:e}=T(A()),_=m(!1),x=m(!1),v=W();v.login();const u=A();u.fill(k.id);const S=()=>String(u.getTableCount),C=()=>String(u.getGuestCount),d=()=>u.getRegistrar,g=()=>u.getRegistration.submitted,s=()=>u.getCompleted,D=()=>new Date(u.getRegistration.updatedAt).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),I=()=>v.isAdmin,o=async()=>{let z=!g(),M=z?"submitted":"re-opened";x.value=!0;try{_.value=!0,u.registerFinancialInformation({submitted:z,registration:k.id}).then(()=>{x.value=!1,t.setMessage({text:`Successfully ${M} registration!`,type:"success"})}).then(()=>u.fill(k.id))}catch(j){x.value=!1,console.warn(j),_.value=!0,t.setMessage({text:`Registration could not be ${M}.`,type:"error"})}},G=m(!1),w=m(!1),U=m(!1),L=m(!1);return{userStore:v,financialStore:u,registration:e,tableCount:S,guestCount:C,getRegistrar:d,isSubmitted:g,isAdmin:I,toggleRegistration:o,addGuestDialog:G,tableInfoDialog:w,guestInfoDialog:U,submissionDialog:L,addGuest:()=>{G.value=!0},tableInfo:()=>{w.value=!0},guestInfo:()=>{U.value=!0},submitRegistration:()=>{_.value=!1,L.value=!0},dateSubmitted:D,activeMessage:_,message:y,loading:x,isCompleted:s}},components:{GuestList:O,RegistrationList:E,InputGuest:_e,PageHeader:Y}},he={class:"personal-registration"},ke={key:0},xe={key:1},Se={key:0},Ce=l(" Please ensure that the registration information on this page is complete prior to submitting your registration for the event. If you cannot complete the registration at this time, your current progress will remain saved here until you are ready to complete your submission. "),De={key:2,class:"page-body"},we={class:"registration-buttons"},Ie=l("Warning regarding table charges:"),Re=i("br",null,null,-1),Pe=l(" Please be aware that half tables may not be able to be accomodated, and you may be charged the full table amount. "),Ve=i("br",null,null,-1),Ge={key:0},ze=i("p",null,[l(" There are currently missing fields on your registration. "),i("br"),l(" Please update the registration details and ensure that all fields are completed. ")],-1),Ae=[ze],Te={key:1},Ue=i("p",null,[l(" Are you sure you wish to submit your event-registration?"),i("br"),l(" You will not be able to revise your submission once completed. ")],-1),Le=l(" Please be aware that half tables may not be able to be accomodated, and you may be charged the full table amount."),Me=i("br",null,null,-1),Be=i("br",null,null,-1),Ne={key:2},Fe=i("p",null,[l(" Are you sure you wish to reverse submission of this event-registration?"),i("br"),l(" This will re-open this submission for editing, and remove the current submission date. ")],-1),qe=[Fe],He={class:"submission-buttons"};function je(k,t,y,e,_,x){const v=c("PageHeader"),u=c("PrimeCard"),S=c("ProgressSpinner"),C=c("RegistrationList"),d=c("PrimeButton"),g=c("PrimeDialog"),s=c("PrimeMessage"),D=c("InputGuest"),I=c("GuestList");return n(),r("main",he,[a(v,{class:"pageheader",footer:`Registration # ${e.registration._id} `},{default:f(()=>[e.isSubmitted()?(n(),r("span",ke,"Submitted "+p(e.dateSubmitted())+" by",1)):(n(),r("span",xe,"In-progress registration for")),l(" "+p(e.getRegistrar()),1)]),_:1},8,["footer"]),!e.isAdmin()&!e.isSubmitted()?(n(),r("div",Se,[i("div",null,[a(u,{id:"registration-info"},{content:f(()=>[Ce]),_:1})])])):b("",!0),e.loading?(n(),h(S,{key:1})):(n(),r("div",De,[a(C,{id:"personal-registration-table",registrationID:y.id,detailsView:!1},null,8,["registrationID"]),i("div",we,[a(d,{type:"button",label:"Tables",icon:"pi pi-ticket",class:"p-button-warning",badge:e.tableCount(),onClick:t[0]||(t[0]=o=>e.tableInfo()),badgeClass:"p-badge-danger"},null,8,["badge"]),a(d,{type:"button",label:"Total Guests",icon:"pi pi-users",class:"p-button-warning",badge:e.guestCount(),onClick:t[1]||(t[1]=o=>e.guestInfo()),badgeClass:"p-badge-danger"},null,8,["badge"]),e.isSubmitted()?b("",!0):(n(),h(d,{key:0,label:"Add Guests",icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:t[2]||(t[2]=o=>e.addGuest())}))]),a(g,{visible:e.tableInfoDialog,"onUpdate:visible":t[3]||(t[3]=o=>e.tableInfoDialog=o),header:"Table Information",modal:!0,class:"p-fluid"},{default:f(()=>[Ie,Re,Pe,Ve,l(" Current table count: "+p(e.tableCount()),1)]),_:1},8,["visible"]),a(g,{visible:e.guestInfoDialog,"onUpdate:visible":t[4]||(t[4]=o=>e.guestInfoDialog=o),header:"Guest Information",modal:!0,class:"p-fluid"},{default:f(()=>[l("Total Number of Guests: "+p(e.guestCount())+". ",1)]),_:1},8,["visible"]),a(g,{visible:e.submissionDialog,"onUpdate:visible":t[7]||(t[7]=o=>e.submissionDialog=o),header:"Confirm Submission",modal:!0,class:"p-fluid"},{default:f(()=>[!e.isCompleted()&&!e.isAdmin()?(n(),r("div",Ge,Ae)):!e.isSubmitted()&&!e.activeMessage?(n(),r("div",Te,[Ue,i("p",null,[Le,Me,l(" Guests submitted on this registration: "+p(e.guestCount())+".",1),Be,l(" Total tables required for this number of guests: "+p(e.tableCount()),1)])])):e.isSubmitted()&&e.isAdmin()&&!e.activeMessage?(n(),r("div",Ne,qe)):b("",!0),!e.isSubmitted()&&!e.activeMessage&&(e.isCompleted()||e.isAdmin())?(n(),h(d,{key:3,type:"button",label:"Confirm submit registration",icon:"pi pi-ticket",class:"p-button-warning",onClick:t[5]||(t[5]=o=>e.toggleRegistration()),badgeClass:"p-badge-danger"})):b("",!0),e.isSubmitted()&&e.isAdmin()&&!e.activeMessage?(n(),h(d,{key:4,type:"button",label:"Re-open registration",icon:"pi pi-ticket",class:"p-button-warning",onClick:t[6]||(t[6]=o=>e.toggleRegistration()),badgeClass:"p-badge-danger"})):b("",!0),e.activeMessage?(n(),h(s,{key:5,show:"",variant:e.message.type,closable:!1},{default:f(()=>[i("p",null,p(e.message.text),1)]),_:1},8,["variant"])):b("",!0)]),_:1},8,["visible"]),a(g,{visible:e.addGuestDialog,"onUpdate:visible":t[8]||(t[8]=o=>e.addGuestDialog=o),style:{width:"50rem",margin:"5rem"},header:"Add a new Guest",modal:!0,class:"p-fluid"},{default:f(()=>[a(D,{registrationID:y.id},null,8,["registrationID"])]),_:1},8,["visible"]),a(I,{id:"personal-registration-guests-table",adminView:!1,registrationID:y.id},null,8,["registrationID"]),i("div",He,[!e.isSubmitted()&&(e.guestCount()>=5||e.isAdmin())?(n(),h(d,{key:0,type:"button",label:"Submit Registration",icon:"pi pi-ticket",class:"p-button-warning",onClick:t[9]||(t[9]=o=>e.submitRegistration()),badgeClass:"p-badge-danger"})):b("",!0),e.isSubmitted()&&e.isAdmin()?(n(),h(d,{key:1,type:"button",label:"Unsubmit Registration",icon:"pi pi-ticket",class:"p-button-warning",onClick:t[10]||(t[10]=o=>e.submitRegistration()),badgeClass:"p-badge-danger"})):b("",!0)])]))])}var $e=H(ve,[["render",je]]);export{$e as default};
