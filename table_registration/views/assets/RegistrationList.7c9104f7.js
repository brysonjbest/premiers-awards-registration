import{_ as O,a as I,s as G,r as c,u as H,f as K,b as V,o as u,c as U,g,h as y,i as Y,w as o,d as l,e as r,t as m,j as v,F as q,k as J,l as _}from"./index.4facfd7c.js";import{I as Q}from"./InputFinancial.32e2c01f.js";const W={props:{adminView:Boolean,detailsView:Boolean,registrationID:String},setup(b){const i=I(),{registrations:T}=G(I()),t=c(_.get("registrationSelection")||[]),L=c(_.get("organizations")||[]),F=c(0),f=H(),p=b.detailsView||!1,C=b.adminView||!1;b.registrationID;const s=c(),D=c(_.get("registrationFilters")||{}),x=()=>{k()},k=()=>{D.value=_.get("registrationFilters")||{}},e=c(!0),n=async function(){const a=f.getUser;return i.$reset,e.value=!1,b.adminView?await i.fillAllRegistrations():b.registrationID?await i.fill(b.registrationID):await i.fill(a.guid)?i.fill(a.guid):[]},h=()=>{console.log("this is data load"),n()};K(()=>{h()});const P=function(a,d){return _.lookup(a,d)},A=()=>{s.value.exportCSV()},B=a=>new Date(a).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),N=a=>new Date(a).toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),j=function(a){return a.filter(d=>d.field!=="organization")},E=function(a){let d=0;return a%10<=5&&a%10!=0&&(d+=.5),a%10>5&&(d+=1),a/10>=1&&(d+=Math.floor(a/10)),d},w=c({}),z=c(!1),R=c(!1),S=c(!1);return{columns:t,organizations:L,registrations:T,registration:w,submitted:z,detailsView:p,adminView:C,registrationDialog:R,deleteRegistrationDialog:S,dataTableRender:F,filters:D,loading:e,dt:s,clearFilters:x,exportCSV:A,formatDate:B,formatTime:N,lookup:P,filter:j,editRegistration:a=>{w.value={...a},R.value=!0},confirmDeleteRegistration:a=>{w.value=a,S.value=!0},deleteRegistration:async function(){i.deleteRegistration(w.value._id).then(()=>{}).then(n()).catch(a=>{console.log(a)}).finally(()=>{S.value=!1,w.value={},h()})},hideDialog:()=>{R.value=!1,z.value=!1},loadLazyData:h,tableCount:E}},components:{InputFinancial:Q}},X={style:{"text-align":"left"}},Z={class:"p-input-icon-left"},M=g("i",{class:"pi pi-search"},null,-1),$=r(" No registrations found. "),ee=r(" Loading registration data. Please wait. "),te=g("br",null,null,-1),ie=g("br",null,null,-1),ae={class:"confirmation-content"},oe=g("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),le={key:0},ne=r("Are you sure you want to delete registration # ");function re(b,i,T,t,L,F){const f=V("Button"),p=V("InputText"),C=V("router-link"),s=V("Column"),D=V("DataTable"),x=V("InputFinancial"),k=V("Dialog");return u(),U("div",null,[g("div",null,[(u(),y(D,{class:"p-datatable-sm",value:t.registrations,responsiveLayout:"stack",key:t.dataTableRender,paginator:t.adminView,rows:10,ref:"dt",stripedRows:"",filters:t.filters,"onUpdate:filters":i[3]||(i[3]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["organization","branch","primarycontact","primaryemail","financialcontact","clientministry","resp","serviceline","project","guid"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},Y({empty:o(()=>[$]),loading:o(()=>[ee]),default:o(()=>[t.adminView?(u(),y(s,{field:"guid",header:"ID#",key:"guid",class:"guid"},{body:o(({data:e})=>[l(C,{to:`/admin/edit/${e.guid}`},{default:o(()=>[r(m(e.registrar),1)]),_:2},1032,["to"])]),_:1})):v("",!0),l(s,{field:"organization",header:"Organization",key:"organization"},{body:o(({data:e})=>[r(m(t.lookup("organizations",e.organization)),1)]),filter:o(({filterModel:e})=>[l(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,class:"p-column-filter",placeholder:"Search by organization"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),(u(!0),U(q,null,J(t.filter(t.columns),e=>(u(),y(s,{field:e.field,header:e.text,key:e.field},{filter:o(({filterModel:n})=>[l(p,{type:"text",modelValue:n.value,"onUpdate:modelValue":h=>n.value=h,class:"p-column-filter",placeholder:"`Search by ${col.field}`"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["field","header"]))),128)),t.adminView?(u(),y(s,{field:"createdAt",header:"Created:",key:"createdAt",sortable:!0},{body:o(({data:e})=>[r(m(t.formatDate(e.createdAt))+",",1),te,r(m(t.formatTime(e.createdAt)),1)]),filter:o(({filterModel:e})=>[l(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,class:"p-column-filter",placeholder:"Search by Date Created"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):v("",!0),t.adminView?(u(),y(s,{field:"tables",header:"Table Count:",key:"tables",sortable:!0},{body:o(({data:e})=>[r(m(t.tableCount(e.guests.length)),1)]),filter:o(({filterModel:e})=>[l(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,class:"p-column-filter",placeholder:"Search by Date Created"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):v("",!0),t.adminView?(u(),y(s,{field:"updatedAt",header:"Updated:",key:"updatedAt",sortable:!0},{body:o(({data:e})=>[r(m(t.formatDate(e.updatedAt))+",",1),ie,r(" "+m(t.formatTime(e.updatedAt)),1)]),filter:o(({filterModel:e})=>[l(p,{type:"text",modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,class:"p-column-filter",placeholder:"Search by Date Updated"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):v("",!0),t.detailsView?v("",!0):(u(),y(s,{key:4,exportable:!1,style:{"min-width":"8rem"}},{body:o(e=>[l(f,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:n=>t.editRegistration(e.data)},null,8,["onClick"]),l(f,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning",onClick:n=>t.confirmDeleteRegistration(e.data)},null,8,["onClick"])]),_:1}))]),_:2},[t.adminView?{name:"header",fn:o(()=>[g("div",X,[l(f,{icon:"pi pi-external-link",label:"Export",onClick:i[0]||(i[0]=e=>t.exportCSV(e))}),l(f,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:i[1]||(i[1]=e=>t.clearFilters())}),g("span",Z,[M,l(p,{modelValue:t.filters.global.value,"onUpdate:modelValue":i[2]||(i[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])])])}:void 0]),1032,["value","paginator","filters","loading"]))]),g("div",null,[l(k,{visible:t.registrationDialog,"onUpdate:visible":i[4]||(i[4]=e=>t.registrationDialog=e),style:{width:"450px"},header:"Registration Details",modal:!0,class:"p-fluid",onHide:i[5]||(i[5]=()=>t.loadLazyData())},{default:o(()=>[l(x,{registrationID:t.registration.guid,adminView:t.adminView,detailsView:t.detailsView},null,8,["registrationID","adminView","detailsView"])]),_:1},8,["visible"]),l(k,{visible:t.deleteRegistrationDialog,"onUpdate:visible":i[7]||(i[7]=e=>t.deleteRegistrationDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:o(()=>[l(f,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:i[6]||(i[6]=e=>t.deleteRegistrationDialog=!1)}),l(f,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t.deleteRegistration},null,8,["onClick"])]),default:o(()=>[g("div",ae,[oe,t.registration?(u(),U("span",le,[ne,g("b",null,m(t.registration.guid),1),r(" for contact "+m(t.registration.primarycontact)+"? This will delete all associated guests.",1)])):v("",!0)])]),_:1},8,["visible"])])])}var fe=O(W,[["render",re]]);export{fe as R};
