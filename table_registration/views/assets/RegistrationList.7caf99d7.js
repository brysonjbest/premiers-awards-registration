import{f as S}from"./settings.services.952672c3.js";import{I as ae}from"./InputFinancial.fc073bbd.js";import{_ as ie,a as Q,f as ne,s as j,r as p,u as le,g as oe,h as G,b as g,o as s,c as h,i as f,w as n,e as m,t as b,j as H,k as r,d as u,l as y,F as se,m as re,n as de}from"./index.2f0c1db2.js";import{u as W,a as X}from"./guests.c66f4470.js";const ue={props:{adminView:Boolean,detailsView:Boolean,registrationID:String},setup(k){const i=Q(),o=ne(),{registrations:t}=j(Q()),{guests:T}=j(W()),{tables:K}=j(X()),L=p(S.get("registrationSelection")||[]),F=p((S.get("organizations")||[]).map(a=>a.value)),_=p(0),R=le(),x=p();let c=p(!1);const V=p({severity:null,text:""}),z=p(S.get("registrationFilters")||{}),A=()=>{I()},I=()=>{z.value=S.get("registrationFilters")||{}},B=function(a){return a.filter(d=>d.field!=="organization")},v=p(!1),D=async function(){const a=R.getUser;i.$reset,v.value=!0;try{return k.registrationID?await i.fill(k.registrationID):k.adminView?await i.fillAllRegistrations():await i.fill(a.guid)?i.fill(a.guid):[]}catch(d){v.value=!1,console.warn(d),c.value=!0,V.value={severity:"error",text:"Could not fetch registrations."}}finally{v.value=!1,setTimeout(()=>c.value=!1,1500)}},e=()=>{D().then(()=>{t.value.forEach(a=>{a.createdAt=new Date(a.createdAt),a.updatedAt=new Date(a.updatedAt),a.guestCount=Number(a.guests.length)})})};oe(()=>{e()});const l=function(){return i.getRegistration.submitted},P=function(a,d){return S.lookup(a,d)},Z=async()=>{await X().fillTables(),await W().fillGuests().then(()=>{t.value.forEach(a=>{a.details={},a.status=0,a.guests.forEach(d=>{a.details[d]=T.value.filter(C=>C._id===d)[0],a.details[d].tabledetails=K.value.filter(C=>C._id===a.details[d].table)[0]})})}).then(()=>{x.value.value.map(a=>{const d={organization:P("organizations",a.organization)},C=[];a.guests.forEach(O=>{const J=T.value.filter(w=>w._id===O).map(w=>w.tabledetails?w.tabledetails:null).map(w=>w?w.tablename:null);J[0]&&C.push(J[0])});const te=new Set(C);let q="";te.forEach(O=>q+=`${O} `),a=Object.assign(a,d,{tables:q})})}).then(()=>{x.value.exportCSV()})},M=a=>new Date(a).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),$=a=>new Date(a).toLocaleTimeString("en-US",{hour12:!0,hour:"2-digit",minute:"2-digit"}),ee=function(a){let d=0;return a%10<=5&&a%10!=0&&(d+=.5),a%10>5&&(d+=1),a/10>=1&&(d+=Math.floor(a/10)),d},U=p({}),Y=p(!1),N=p(!1),E=p(!1);return{columns:L,organizations:F,registrations:t,settingsStore:o,guests:T,registration:U,isSubmitted:l,submitted:Y,registrationDialog:N,deleteRegistrationDialog:E,dataTableRender:_,filters:z,loading:v,message:c,messageText:V,dt:x,clearFilters:A,exportCSV:Z,formatDate:M,formatTime:$,lookup:P,filter:B,editRegistration:a=>{U.value={...a},N.value=!0},confirmDeleteRegistration:a=>{U.value=a,E.value=!0},deleteRegistration:async function(){v.value=!0;try{i.deleteRegistration(U.value._id).then(D()).then(()=>{v.value=!1,c.value=!0,V.value={severity:"success",text:"Successfully deleted registration and all connected guests."}})}catch(a){v.value=!1,console.warn(a),c.value=!0,V.value={severity:"error",text:"Could not delete registration."}}finally{E.value=!1,await new Promise(a=>setTimeout(a,1500)).then(()=>{c.value=!1,k.registrationID?G.push("/admin"):k.adminView?D():G.push("/")})}},hideDialog:()=>{N.value=!1,Y.value=!1},loadLazyData:e,tableCount:ee,router:G}},components:{InputFinancial:ae}},ce={key:2},me={style:{"text-align":"left"},class:"header-buttons"},ge={class:"p-input-icon-left"},fe=r("i",{class:"pi pi-search"},null,-1),be=m(" No registrations found. "),pe=m(" Loading registration data. Please wait. "),_e={key:0},ye={key:1},ve={class:"item"},he=r("br",null,null,-1),we=r("br",null,null,-1),ke=r("br",null,null,-1),Ve={class:"options-buttons"},De={class:"confirmation-content"},Ce=r("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),xe={key:0},Se=r("b",null,[m("All guests must be unseated before this registration may be deleted."),r("br"),m("Please remove all guests from their tables.")],-1),Te=[Se],Re={key:1},ze=r("br",null,null,-1),Ie=m(" This will delete all associated guests."),Pe=r("br",null,null,-1),Ue=r("b",null,"This action cannot be undone.",-1),Le={key:0},Fe={key:1};function Ae(k,i,o,t,T,K){const L=g("ProgressSpinner"),F=g("PrimeMessage"),_=g("PrimeButton"),R=g("InputText"),x=g("router-link"),c=g("PrimeColumn"),V=g("DropDown"),z=g("InputNumber"),A=g("TriStateCheckbox"),I=g("PrimeCalendar"),B=g("DataTable"),v=g("InputFinancial"),D=g("PrimeDialog");return s(),h("div",null,[t.loading?(s(),f(L,{key:0})):t.message?(s(),f(F,{key:1,severity:t.messageText.severity,closable:!1},{default:n(()=>[m(b(t.messageText.text),1)]),_:1},8,["severity"])):(s(),h("div",ce,[(s(),f(B,{class:"p-datatable-sm",value:t.registrations,responsiveLayout:"stack",key:t.dataTableRender,paginator:o.adminView&&!o.registrationID,rows:10,ref:"dt",stripedRows:"",exportFilename:"Registration List",filters:t.filters,"onUpdate:filters":i[3]||(i[3]=e=>t.filters=e),filterDisplay:"menu",globalFilterFields:["organization","branch","primarycontact","primaryemail","financialcontact","clientministry","resp","serviceline","project","guid"],loading:t.loading,showGridlines:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},H({empty:n(()=>[be]),loading:n(()=>[pe]),default:n(()=>[o.adminView?(s(),f(c,{field:"_id",header:"ID#",key:"_id",class:"_id"},{body:n(({data:e})=>[u(x,{to:`/admin/edit/${e._id}`},{default:n(()=>[m(b(e.registrar),1)]),_:2},1032,["to"])]),_:1})):y("",!0),u(c,{field:"organization",filterField:"organization",header:"Organization",key:"organization"},H({body:n(({data:e})=>[m(b(t.lookup("organizations",e.organization)),1)]),_:2},[o.adminView?{name:"filter",fn:n(({filterModel:e})=>[u(V,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,options:t.organizations,optionLabel:"text",placeholder:"Any",class:"p-column-filter",showClear:!0},{value:n(l=>[l.value?(s(),h("div",_e,[r("div",null,b(t.lookup("organizations",l.value)),1)])):(s(),h("span",ye,b(l.placeholder),1))]),option:n(l=>[r("div",ve,[r("div",null,b(t.lookup("organizations",l.option)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","options"])])}:void 0]),1024),(s(!0),h(se,null,re(t.filter(t.columns),e=>(s(),f(c,{field:e.field,header:e.text,key:e.field},H({_:2},[o.adminView?{name:"filter",fn:n(({filterModel:l})=>[u(R,{type:"text",modelValue:l.value,"onUpdate:modelValue":P=>l.value=P,class:"p-column-filter",placeholder:`Search by ${e.field}`},null,8,["modelValue","onUpdate:modelValue","placeholder"])])}:void 0]),1032,["field","header"]))),128)),o.adminView&&!o.registrationID?(s(),f(c,{field:"guestCount",dataType:"numeric",header:"Guest Count:",key:"guestCount",sortable:!0},{body:n(({data:e})=>[r("span",null,b(e.guestCount),1)]),filter:n(({filterModel:e})=>[u(z,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,showButtons:"",buttonLayout:"horizontal",step:1,decrementButtonClass:"p-button-danger",incrementButtonClass:"p-button-success",incrementButtonIcon:"pi pi-plus",decrementButtonIcon:"pi pi-minus"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):y("",!0),u(c,{hidden:!0,field:"tables",header:"Tables",key:"tables"}),o.adminView?(s(),f(c,{field:"submitted",header:"Submitted?",key:"submitted",dataType:"boolean"},{body:n(({data:e})=>[r("span",null,[r("i",{class:de(["pi pi-check-circle",{"true-icon pi-check-circle":e.submitted,"false-icon pi-times-circle":!e.submitted}]),style:{"font-size":"2rem"}},null,2),he,m(b(e.submitted?" Submitted":" Pending"),1)])]),filter:n(({filterModel:e})=>[u(A,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):y("",!0),o.adminView?(s(),f(c,{field:"createdAt",header:"Created:",key:"createdAt",sortable:!0,dataType:"date"},{body:n(({data:e})=>[m(b(t.formatDate(e.createdAt))+",",1),we,m(b(t.formatTime(e.createdAt)),1)]),filter:n(({filterModel:e})=>[u(I,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):y("",!0),o.adminView?(s(),f(c,{field:"updatedAt",header:"Updated:",key:"updatedAt",sortable:!0,dataType:"date"},{body:n(({data:e})=>[m(b(t.formatDate(e.updatedAt))+",",1),ke,m(" "+b(t.formatTime(e.updatedAt)),1)]),filter:n(({filterModel:e})=>[u(I,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,dateFormat:"mm/dd/yy",placeholder:"mm/dd/yyyy"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})):y("",!0),!t.isSubmitted()&&t.settingsStore.getIsSalesOpen||o.adminView?(s(),f(c,{key:5,exportable:!1,style:{"min-width":"8rem"},header:"Options:"},{body:n(e=>[r("div",Ve,[e.data.submitted?y("",!0):(s(),f(_,{key:0,label:"Edit",icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2 edit-button",onClick:l=>t.editRegistration(e.data)},null,8,["onClick"])),!e.data.submitted&&(!o.adminView||o.adminView&&o.registrationID)?(s(),f(_,{key:1,icon:"pi pi-trash",label:"Delete",class:"p-button-rounded p-button-warning delete-button",onClick:l=>t.confirmDeleteRegistration(e.data)},null,8,["onClick"])):y("",!0),o.adminView&&!o.registrationID?(s(),f(_,{key:2,icon:"pi pi-arrow-up-right",label:"View",class:"p-button-rounded p-button-info info-button",onClick:l=>t.router.push(`/admin/edit/${e.data.guid}`)},null,8,["onClick"])):y("",!0)])]),_:1})):y("",!0)]),_:2},[o.adminView&&!o.registrationID?{name:"header",fn:n(()=>[r("div",me,[u(_,{icon:"pi pi-external-link",label:"Export",onClick:i[0]||(i[0]=e=>t.exportCSV(e))}),u(_,{type:"button",icon:"pi pi-filter-slash",label:"Clear",class:"p-button-outlined",onClick:i[1]||(i[1]=e=>t.clearFilters())}),r("span",ge,[fe,u(R,{title:"Search all by keyword",modelValue:t.filters.global.value,"onUpdate:modelValue":i[2]||(i[2]=e=>t.filters.global.value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])])])}:void 0]),1032,["value","paginator","filters","loading"]))])),r("div",null,[u(D,{visible:t.registrationDialog,"onUpdate:visible":i[4]||(i[4]=e=>t.registrationDialog=e),style:{width:"50rem",margin:"5rem"},header:"Registration Details",modal:!0,class:"p-fluid registration-dialog",onHide:i[5]||(i[5]=()=>t.loadLazyData())},{default:n(()=>[u(v,{registrationID:t.registration.guid,adminView:o.adminView,detailsView:o.detailsView},null,8,["registrationID","adminView","detailsView"])]),_:1},8,["visible"]),u(D,{visible:t.deleteRegistrationDialog,"onUpdate:visible":i[8]||(i[8]=e=>t.deleteRegistrationDialog=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[t.guests.some(e=>e.tabledetails!==void 0)?(s(),h("div",Le,[u(_,{label:"Okay",icon:"pi pi-check",class:"p-button-text",onClick:i[6]||(i[6]=e=>t.deleteRegistrationDialog=!1)})])):(s(),h("div",Fe,[u(_,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:i[7]||(i[7]=e=>t.deleteRegistrationDialog=!1)}),u(_,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:t.deleteRegistration},null,8,["onClick"])]))]),default:n(()=>[r("div",De,[Ce,t.guests.some(e=>e.tabledetails!==void 0)?(s(),h("p",xe,Te)):t.registration?(s(),h("p",Re,[m(" Are you sure you want to delete "+b(t.registration.primarycontact)+"'s registration?",1),ze,Ie,Pe,Ue])):y("",!0)])]),_:1},8,["visible"])])])}var Qe=ie(ue,[["render",Ae]]);export{Qe as R};
